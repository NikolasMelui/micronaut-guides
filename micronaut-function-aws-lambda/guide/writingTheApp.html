<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>5 Writing the App null</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Micronaut Functions deployed in AWS Lambda
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/gettingStarted.html"><strong>1</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/writingTheLambda.html"><strong>2</strong><span>Writing the Function</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/sam.html"><strong>3</strong><span>Test with SAM CLI</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/awslambda.html"><strong>4</strong><span>Deploy to AWS Lambda</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/writingTheApp.html"><strong>5</strong><span>Writing the App</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/runningTheApp.html"><strong>6</strong><span>Running the app</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/awsApiGateway.html"><strong>7</strong><span>AWS API Gateway</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/graal.html"><strong>8</strong><span>Running the Function on Graal Native Image</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/nextSteps.html"><strong>9</strong><span>Next Steps</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/awslambda.html">&lt;&lt; <strong>4</strong><span>Deploy to AWS Lambda</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/runningTheApp.html"><strong>6</strong><span>Running the app</span> >></a></div>
                


                <div class="project">
                    <h1>5 Writing the App</h1>

                    <p><strong>Version:</strong> null</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#pojos"><strong>5.1</strong><span>POJOs</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#functionclient"><strong>5.2</strong><span>Call the Function</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#controller"><strong>5.3</strong><span>Controller</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#tests"><strong>5.4</strong><span>Tests</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="writingTheApp">5 Writing the App</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Now, it is time to consume the AWS Lambda function from another micronaut Microservice:</p>
</div>
<div class="paragraph">
<p>Create the microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">mn create-app example.micronaut.invoice</code></pre>
</div>
</div>


<h2 id="pojos">5.1 POJOs</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheApp/pojos.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We expect to get an incoming JSON payload such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json" data-lang="json">{
"vatNumber": "B86412491",
"countryCode": "es",
"lines": [
    {
        "count": 2,
        "productId": "1491950358",
        "price": 19.99
    },
    {
        "count": 1,
        "productId": "1680502395",
        "price": 15
    },
]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We create two POJOs to map it.</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/Invoice.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.core.annotation.Introspected;

import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotEmpty;
import javax.validation.constraints.NotNull;
import java.util.List;
import java.util.Objects;

@Introspected
public class Invoice {

    @NotNull
    @NotBlank
    private String vatNumber;

    @NotNull
    @NotBlank
    private String countryCode;

    @NotEmpty
    private List&lt;InvoiceLine&gt; lines;

    public Invoice() {
    }

    public Invoice(@NotNull @NotBlank String vatNumber,
                   @NotNull @NotBlank String countryCode,
                   @NotEmpty List&lt;InvoiceLine&gt; lines) {
        this.vatNumber = vatNumber;
        this.countryCode = countryCode;
        this.lines = lines;
    }

    public String getVatNumber() {
        return vatNumber;
    }

    public void setVatNumber(String vatNumber) {
        this.vatNumber = vatNumber;
    }

    public String getCountryCode() {
        return countryCode;
    }

    public void setCountryCode(String countryCode) {
        this.countryCode = countryCode;
    }

    public List&lt;InvoiceLine&gt; getLines() {
        return lines;
    }

    public void setLines(List&lt;InvoiceLine&gt; lines) {
        this.lines = lines;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        Invoice invoice = (Invoice) o;
        return Objects.equals(vatNumber, invoice.vatNumber) &amp;&amp;
                Objects.equals(countryCode, invoice.countryCode) &amp;&amp;
                Objects.equals(lines, invoice.lines);
    }

    @Override
    public int hashCode() {
        return Objects.hash(vatNumber, countryCode, lines);
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/InvoiceLine.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.core.annotation.Introspected;

import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;
import javax.validation.constraints.Positive;
import java.math.BigDecimal;
import java.util.Objects;

@Introspected
public class InvoiceLine {
    @NotNull
    @NotBlank
    private String productId;

    @Positive
    private Integer count;

    @NotNull
    @Positive
    private BigDecimal price;

    public InvoiceLine() {
    }

    public InvoiceLine(String productId, Integer count, BigDecimal price) {
        this.productId = productId;
        this.count = count;
        this.price = price;
    }

    public BigDecimal vatPrice(BigDecimal vatPercentage) {
        return getPrice().multiply(BigDecimal.valueOf(getCount()).multiply(vatPercentage));
    }

    public String getProductId() {
        return productId;
    }

    public void setProductId(String productId) {
        this.productId = productId;
    }

    public Integer getCount() {
        return count;
    }

    public void setCount(Integer count) {
        this.count = count;
    }

    public BigDecimal getPrice() {
        return price;
    }

    public void setPrice(BigDecimal price) {
        this.price = price;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        InvoiceLine that = (InvoiceLine) o;
        return Objects.equals(productId, that.productId) &amp;&amp;
                Objects.equals(count, that.count) &amp;&amp;
                Objects.equals(price, that.price);
    }

    @Override
    public int hashCode() {
        return Objects.hash(productId, count, price);
    }
}</code></pre>
</div>
</div>


<h2 id="functionclient">5.2 Call the Function</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheApp/functionclient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create an interface to abstract the collaboration with the function:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/VatValidator.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.http.annotation.Body;
import io.reactivex.Single;

public interface VatValidator {

    Single&lt;VatValidation&gt; validateVat(@Body VatValidationRequest req);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create two POJOs which are used by the previous interface:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/VatValidationRequest.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.core.annotation.Introspected;

import java.io.Serializable;

@Introspected
public class VatValidationRequest implements Serializable {
    private String memberStateCode;
    private String vatNumber;

    public VatValidationRequest() {
    }

    public VatValidationRequest(String memberStateCode, String vatNumber) {
        this.memberStateCode = memberStateCode;
        this.vatNumber = vatNumber;
    }

    public String getMemberStateCode() {
        return memberStateCode;
    }

    public void setMemberStateCode(String memberStateCode) {
        this.memberStateCode = memberStateCode;
    }

    public String getVatNumber() {
        return vatNumber;
    }

    public void setVatNumber(String vatNumber) {
        this.vatNumber = vatNumber;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/VatValidation.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.core.annotation.Introspected;

import java.io.Serializable;

@Introspected
public class VatValidation extends VatValidationRequest implements Serializable {

    private Boolean valid;

    public VatValidation() {

    }

    public VatValidation(String memberStateCode, String vatNumber, Boolean valid) {
        super(memberStateCode, vatNumber);
        this.valid = valid;
    }

    public Boolean getValid() {
        return valid;
    }

    public void setValid(Boolean valid) {
        this.valid = valid;
    }

    public Boolean isValid() {
        return valid;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Modify <code>build.gradle</code> to add <code>function-client</code> and <code>com.amazonaws:aws-java-sdk-lambda</code> dependencies:</p>
</div>
<div class="listingblock">
<div class="title">invoice/build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">implementation "io.micronaut:micronaut-function-client"
runtime 'com.amazonaws:aws-java-sdk-lambda:1.11.285'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also modify <code>src/main/resources/application.yml</code> and the define a function with the same name <code>vies-vat-validator</code> as the one we deployed to AWS Lambda:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">aws:
  lambda:
    functions:
      vat:
        functionName: vies-vat-validator
        qualifer: vat
    region: eu-west-3 # Paris Region</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the next configuration properties which we will use shortly:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/resources/application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">vat:
  percentage: 0.21
  scale: 2
  retry:
    attempts: 5
    delay: 5s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create <code>VatClient</code> to invoke our function:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/VatClient.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.context.annotation.Requires;
import io.micronaut.context.env.Environment;
import io.micronaut.function.client.FunctionClient;
import io.micronaut.http.annotation.Body;
import io.micronaut.retry.annotation.Retryable;
import io.reactivex.Single;

import javax.inject.Named;

@FunctionClient <i class="conum" data-value="1"></i><b>(1)</b>
@Requires(notEnv = Environment.TEST) <i class="conum" data-value="2"></i><b>(2)</b>
public interface VatClient extends VatValidator {

    @Override
    @Named("vies-vat-validator") <i class="conum" data-value="3"></i><b>(3)</b>
    @Retryable(attempts = "${vat.retry.attempts:3}", delay = "${vat.retry.delay:1s}") <i class="conum" data-value="4"></i><b>(4)</b>
    Single&lt;VatValidation&gt; validateVat(@Body VatValidationRequest req);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The FunctionClient annotation allows applying introduction advise to an interface such that methods defined by the interface become invokers of remote functions configured by the application.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can remove a bean from the test classpath easily.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the function name <code>vies-vat-validator</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>AWS Lambda functions may take time to warm up. Thus, failure is something you have to plan for and it is pretty common to want to attempt to retry an operation if it fails.
With <a href="https://docs.micronaut.io/snapshot/guide/index.html#retry">Micronaut Retry</a> you can try again easily.</td>
</tr>
</table>
</div>


<h2 id="controller">5.3 Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheApp/controller.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut&#8217;s validation is built on with the standard framework – JSR 380, also known as Bean Validation 2.0.</p>
</div>
<div class="paragraph">
<p>Hibernate Validator is a reference implementation of the validation API. Starting with Micronaut 1.2, Micronaut
<a href="https://docs.micronaut.io/latest/guide/index.html#beanValidation">has built-in support for validation beans</a> that
are annotated with <code>javax.validation</code> annotations.</p>
</div>
<div class="paragraph">
<p>Add the next snippet to <code>build.gradle</code></p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">implementation "io.micronaut:micronaut-validation"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">invoice/src/main/java/example/micronaut/InvoiceController.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.context.annotation.Value;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Post;
import io.reactivex.Single;

import javax.validation.Valid;
import java.math.BigDecimal;

@Controller("/invoice") <i class="conum" data-value="1"></i><b>(1)</b>
public class InvoiceController {

    private final BigDecimal vatPercentage;

    private final VatValidator vatValidator;

    private final int scale;

    public InvoiceController(@Value("${vat.percentage}") BigDecimal vatPercentage, <i class="conum" data-value="2"></i><b>(2)</b>
                             @Value("${vat.scale}") int scale,
                             VatValidator vatValidator) { <i class="conum" data-value="3"></i><b>(3)</b>
        this.vatPercentage = vatPercentage;
        this.scale = scale;
        this.vatValidator = vatValidator;
    }

    @Post("/vat") <i class="conum" data-value="4"></i><b>(4)</b>
    Single&lt;Taxes&gt; calculateVat(@Valid @Body Invoice invoice) {  <i class="conum" data-value="5"></i><b>(5)</b>
        return vatValidator.validateVat(new VatValidationRequest(invoice.getCountryCode(), invoice.getVatNumber())) <i class="conum" data-value="6"></i><b>(6)</b>
                .map(vatValidation -&gt; {
                        BigDecimal percentage = vatValidation.isValid() ? vatPercentage : new BigDecimal("0");
                    return new Taxes(invoice.getLines().stream()
                            .map(line -&gt; line.vatPrice(percentage))
                            .reduce(BigDecimal.ZERO, BigDecimal::add)
                            .setScale(scale, BigDecimal.ROUND_HALF_EVEN));
                        });
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <code>@Controller</code> annotation mapped to the path <code>/invoice</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Constructor injection of a configuration property.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Constructor injection of a bean.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>@Post</code> annotation is used to map the <code>calculateVat</code> method to all requests to <code>/invoice/vat</code> that use an HTTP POST.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Add <code>@Valid</code> to any method parameter which requires validation. Use a POGO supplied as a JSON payload in the request to populate the invoice.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>This invokes the function in AWS Lambda.</td>
</tr>
</table>
</div>


<h2 id="tests">5.4 Tests</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-function-aws-lambda/edit/master/src/main/docs/guide/writingTheApp/tests.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We don&#8217;t want the real AWS Lambda function executed in our tests.</p>
</div>
<div class="paragraph">
<p>Thus, create a bean to provide an implementation of <code>VatValidator</code> in the test phase:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/test/java/example/micronaut/VatValidatorMock.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.context.annotation.Requires;
import io.micronaut.context.env.Environment;
import io.reactivex.Single;

import javax.inject.Singleton;
import java.util.Collections;
import java.util.List;

@Requires(env = Environment.TEST)
@Singleton
public class VatValidatorMock implements VatValidator {

    @Override
    public Single&lt;VatValidation&gt; validateVat(VatValidationRequest request) {
        String memberStateCode = request.getMemberStateCode();
        String vatNumber = request.getVatNumber();
        List&lt;String&gt; validVatNumbers = Collections.singletonList("B84965375");
        return Single.just(new VatValidation(memberStateCode,
                vatNumber,
                validVatNumbers.contains(vatNumber)));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a JUnit test which verifies the logic:</p>
</div>
<div class="listingblock">
<div class="title">invoice/src/test/java/example/micronaut/InvoiceControllerTest.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.http.HttpRequest;
import io.micronaut.http.client.RxHttpClient;
import io.micronaut.http.client.annotation.Client;
import io.micronaut.runtime.server.EmbeddedServer;
import io.micronaut.test.annotation.MicronautTest;
import org.junit.jupiter.api.Test;

import javax.inject.Inject;
import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.List;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

@MicronautTest <i class="conum" data-value="1"></i><b>(1)</b>
public class InvoiceControllerTest {

    @Inject
    @Client("/")
    RxHttpClient rxHttpClient; <i class="conum" data-value="2"></i><b>(2)</b>

    @Inject
    EmbeddedServer server; <i class="conum" data-value="3"></i><b>(3)</b>

    @Test
    public void testInvoiceController() {

        VatValidator bean = server.getApplicationContext().getBean(VatValidator.class);
        assertTrue(bean instanceof VatValidatorMock); <i class="conum" data-value="4"></i><b>(4)</b>

        List&lt;InvoiceLine&gt; lines = new ArrayList&lt;InvoiceLine&gt;();
        lines.add(new InvoiceLine("1491950358", 2, new BigDecimal(19.99)));
        lines.add(new InvoiceLine("1680502395", 1, new BigDecimal(15)));
        Invoice invoice = new Invoice("B84965375", "es", lines);
        HttpRequest request = HttpRequest.POST("/invoice/vat", invoice);
        Taxes rsp = rxHttpClient.toBlocking().retrieve(request, Taxes.class);
        BigDecimal expected = new BigDecimal("11.55");
        assertEquals(expected, rsp.getVat());

        invoice.setVatNumber("B99999999");
        rsp = rxHttpClient.toBlocking().retrieve(request, Taxes.class);
        expected = new BigDecimal("0.00");
        assertEquals(expected, rsp.getVat());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@MicronautTest</code> to let Micronaut starts the embedded server and inject the beans. More info: <a href="https://micronaut-projects.github.io/micronaut-test/latest/guide/index.html">https://micronaut-projects.github.io/micronaut-test/latest/guide/index.html</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject the <code>RxHttpClient</code> bean in the application context.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Inject the <code>EmbeddedServer</code> bean.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Verify the bean for interface <code>VatValidator</code> is <code>VatValidatorMock</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are curious about how the 11.55 is calculated.
Given a 21% VAT.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Price</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Line VAT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">19,99</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8,3958</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3,15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total VAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11,55</p></td>
</tr>
</tbody>
</table>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/awslambda.html">&lt;&lt; <strong>4</strong><span>Deploy to AWS Lambda</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/runningTheApp.html"><strong>6</strong><span>Running the app</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing. 
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
