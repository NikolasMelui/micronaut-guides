<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Adding Commit Info to your Grails Application</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/guide.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />        
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>

        <link rel="stylesheet" type="text/css" href="../css/font-awesome.min.css" />        
        <link rel="stylesheet" type="text/css" href="../css/navbar.css" />
        <link rel="stylesheet" type="text/css" href="../css/stMenu.css" />      

    </head>

    <body class="body" onload="addJsClass();">

    <a href="https://github.com/grails/grails-core" target="_blank">
      <div id="fork-me">
        <p>Fork me on Github</p>
      </div>
    </a>
    <div id="st-container" class="st-container st-effect-9">
      <nav class="st-menu st-effect-9" id="menu-12">
        <h2 class="icon icon-lab">Socialize</h2>
        <ul>
          <li><a href="http://grails.org/mailing-lists.html" class="icon"><span class="fa fa-envelope"></span> Discuss on the Mailing List</a></li>
          <li><a href="http://slack-signup.grails.org" class="icon"><span class="fa fa-slack"></span> Discuss on Slack</a></li>
          <li><a href="https://twitter.com/grailsframework" class="icon"><span class="fa fa-twitter"></span> Grails on Twitter</a></li>
          <li><a href="http://grails.org/events.html" class="icon"><span class="fa fa-calendar"></span> Events and conferences</a></li>
          <li><a href="https://github.com/grails/grails-core" class="icon"><span class="fa fa-github"></span> Source code on GitHub</a></li>
          <li><a href="http://grails.org/contribute.html#reporting-issues" class="icon"><span class="fa fa-bug"></span> Report issues on Github</a></li>
          <li><a href="http://stackoverflow.com/questions/tagged/grails" class="icon"><span class="fa fa-stack-overflow"></span> Stack Overflow questions</a></li>
        </ul>
      </nav>
      <div class="st-pusher">
        <div class="st-content">
          <div class="st-content">
            <div class="grailsnavbar grailsnavbar-default">
              <div class="grailsnavbar-container">
                <div class="grailsnavbar-header">
                  <a class="grailsnavbar-brand" href="index.html"><i class="fa grails-icon"><img src="../img/grails-cupsonly-logo-white.svg"></i> Grails</a>
                </div>
                <a id="nav-icon" href="javascript:toggleNavIcon();">
                  <span></span>
                  <span></span>
                  <span></span>
                </a>
                <div class="grailsnavbar-collapse collapse">
                  <ul id="grailsnavbar-nav" class="grailsnavbar-nav grailsnavbar-right closemobile">
                    <li><a href="http://grails.org/learn.html">Learn</a></li>
                    <li><a href="http://guides.grails.org">Guides</a></li>
                    <li><a href="http://grails.org/documentation.html">Documentation</a></li>
                    <li><a href="http://grails.org/download.html">Download</a></li>
                    <li><a href="http://plugins.grails.org">Plugins</a></li>
                    <li><a href="http://grails.org/community.html">Community</a></li>
                    <li><a href="http://grails.org/support.html">Support</a></li>
                    <li><a data-effect="st-effect-9" class="st-trigger" href="#">Socialize</a></li>
                    <li><a href="http://grails.org/search.html"><i class="fa fa-search"></i></a></li>
                  </ul>
                </div>
              </div>
            </div>
            <!-- CONTENT -->
<table id="colset" border="0" cellpadding="0" cellspacing="0">
                                <tr>
                                    <td id="col1">
                                        <div id="main" class="corner-all">

                                            <div class="project">
                                                <h1>Adding Commit Info to your Grails Application</h1>
                                                <p></p>
                                                <p>Knowing the exact version of code that your application is running is important</p>
                                                <p><strong>Authors:</strong> Colin Harrington</p>
                                                <p><strong>Grails Version:</strong> 3.3.0</p>

                                            </div>

                                            

<h1 id="gettingStarted">1 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this guide we are going to add git commit info to your grails build artifacts and running application.
There are many benefits of keeping your commit info handy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Commit info is encapsulated within the built artifacts</p>
</li>
<li>
<p>Fast authoritative means of identifying what specific code is running in an environment</p>
</li>
<li>
<p>This solution doesn&#8217;t rely on external tracking mechanisms</p>
</li>
<li>
<p>Transparency and reproducibility when investigating issues</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you prefer the summary checkout <a href="#tldr">tl;dr</a>
</td>
</tr>
</table>
</div>


<h2 id="requirements">1.1 What you will need</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/requirements.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.7 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
</ul>
</div>


<h2 id="howto">1.2 How to complete the guide</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/howto.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/grails-guides/adding-commit-info/archive/master.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the <a href="https://git-scm.com/">Git</a> repository:<br>
<code>git clone <a href="https://github.com/grails-guides/adding-commit-info.git" class="bare">https://github.com/grails-guides/adding-commit-info.git</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Grails guides repositories contain two folders:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initial</code>  Initial project. Often a simple Grails app with additional some code to give you a head-start.</p>
</li>
<li>
<p><code>complete</code> A completed example. It is the result of working through the steps presented by the guide and applying those changes to the <code>initial</code> folder.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To complete the guide, go to the <code>initial</code> folder</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cd</code> into <code>grails-guides/adding-commit-info/initial</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and follow the instructions in the next sections.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can go right to the <strong>completed example</strong> if you <code>cd</code> into <code>grails-guides/adding-commit-info/complete</code>
</td>
</tr>
</table>
</div>


<h1 id="history">2 History</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/history.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>There have been several different approaches to accomplish this task in the past that are worth mentioning.</p>
</div>


<h2 id="earlyDays">2.1 Early approaches</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/earlyDays.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In the earlier days of Grails there were approaches that tapped into the build events such as <code>eventCompileStart</code> in <code>scripts/_Events.groovy</code>
to capture the git-sha (<code>"git rev-parse HEAD".execute().text</code>) and include it within the application as described by
<a href="http://refactr.com/blog/2012/05/grails-tips-deployment-tricks/">this post</a>.</p>
</div>


<h2 id="applicationProperties">2.2 application.properties</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/applicationProperties.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 2.x and below has an <code>application.properties</code> that can be utilized to store commit properties.
This is the same place that Grails used to store its application name and version.</p>
</div>
<div class="paragraph">
<p>In this example some mechanism needs to be in place to append/update the commit info to the <code>application.properties</code>
It could be the build system that appends git commit info as a build step before producing a war.</p>
</div>
<div class="paragraph">
<p>After the commit info is added to <code>application.properties</code> We can access that metadata in several ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GrailsApplication via <code>grailsApplication.metadata['git.sha']</code></p>
</li>
<li>
<p>Utilizing the taglib <code>&lt;g:meta name='git.sha'/&gt;</code> in a view.</p>
</li>
</ul>
</div>


<h2 id="buildInfoPlugin">2.3 Build Info Plugin</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/buildInfoPlugin.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Another popular approach that was popular with Grails 2.x was to utilize the <a href="https://grails.org/plugin/build-info">Build Info Plugin</a>
The build-info plugin works by utilizing the environment variables available via a build system like Jenkins.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>BUILD_NUMBER</p>
</li>
<li>
<p>BUILD_ID</p>
</li>
<li>
<p>BUILD_TAG</p>
</li>
<li>
<p>SVN_REVISION</p>
</li>
<li>
<p>GIT_COMMIT</p>
</li>
<li>
<p>GIT_BRANCH</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These values would then be available by accessing the <code>/buildInfo</code> endpoint.</p>
</div>


<h1 id="writingTheApp">3 Writing the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>There are two basic steps</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding the <a href="#gradlePlugin">gradle-git-properties plugin</a></p>
</li>
<li>
<p>Enabling the <a href="#actuator"><code>/info</code> endpoint</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s get started!</p>
</div>


<h2 id="gradlePlugin">3.1 Gradle Plugin</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/gradlePlugin.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>One of the features of Grails 3.x is that the applications come packaged with Gradle as a build tool.</p>
</div>
<div class="paragraph">
<p>Rather than implementing our own mechanism to capture git commit information we can leverage the <a href="https://plugins.gradle.org/plugin/com.gorylenko.gradle-git-properties">gradle-git-properties</a> plugin.
The goal of this plugin is to capture the commit information and store it in a file called <code>git.properties</code></p>
</div>
<div class="paragraph">
<p>Adding a Gradle plugin is fairly straight forward.  This involves a few steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Adding the dependency to the <code>buildscript { &#8230;&#8203; }</code> block in <code>build.gradle</code>. This means that you are adding the dependency to the build and not your deliverable application.</p>
</li>
<li>
<p>Ensuring the build script dependency will be resolved via the appropriate maven repositories</p>
</li>
<li>
<p>Applying the plugin</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">/complete/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    repositories {
        maven { url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://plugins.gradle.org/m2/</span><span class="delimiter">&quot;</span></span> }
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">gradle.plugin.com.gorylenko.gradle-git-properties:gradle-git-properties:1.4.17</span><span class="delimiter">&quot;</span></span>
    }
}
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">com.gorylenko.gradle-git-properties</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p>Now every time the application is compiled or run (specifically the <a href="https://github.com/n0mer/gradle-git-properties/blob/master/src/main/groovy/com/gorylenko/GitPropertiesPlugin.groovy#L55">JavaPlugin&#8217;s <code>classes</code> task</a>), you&#8217;ll find that git.properties has been generated.
When running the app locally, this file may be found at <code>/build/resources/main/git.properties</code>.
When packaged as a war or standalone jar you&#8217;ll find <code>git.properties</code> included in <code>WEB-INF/classes</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ unzip -l ./build/libs/complete-0.1.war | grep git.properties
      276  2017-02-02 11:53   WEB-INF/classes/git.properties</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p>Inspecting <code>git.properties</code> reveals the commit information that was captured</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">git.branch=master
git.commit.id=777d70650bb055862436fc59071072aae8cd0ddd
git.commit.id.abbrev=777d706
git.commit.user.name=Colin Harrington
git.commit.user.email=colin.harrington@gmail.com
git.commit.message.short=Adding gradle-git-properties plugin
git.commit.message.full=Adding gradle-git-properties plugin

git.commit.time=1487262171</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is possible to configure/influence how git.properties is generated by configuring the gradle task (in <code>build.gradle</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gitProperties {
    dateFormat = <span class="string"><span class="delimiter">&quot;</span><span class="content">yyyy-MM-dd'T'HH:mmZ</span><span class="delimiter">&quot;</span></span>
    dateFormatTimeZone = <span class="string"><span class="delimiter">&quot;</span><span class="content">CST</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>


<h2 id="actuator">3.2 Spring Boot Actuator endpoints</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/actuator.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Now that we have the git commit info captured and included in our application via a <code>git.properties</code> file, it is time to utilize it.</p>
</div>
<div class="paragraph">
<p>Grails 3.x is based on Spring Boot and we can leverage some of the underlying tools already included in the application.</p>
</div>
<div class="quoteblock">
<blockquote>
Spring Boot includes a number of additional features to help you monitor and manage your application when it’s pushed to production. You can choose to manage and monitor your application using HTTP endpoints, with JMX or even by remote shell (SSH or Telnet). Auditing, health and metrics gathering can be automatically applied to your application.
that has some production ready features already built into it.
</blockquote>
<div class="attribution">
&#8212; Documentation for Spring Boot Actuator<br>
<cite><a href="http://docs.spring.io/spring-boot/docs/current/reference/html/production-ready.html" class="bare">http://docs.spring.io/spring-boot/docs/current/reference/html/production-ready.html</a></cite>
</div>
</div>
<div class="paragraph">
<p>Built into Spring boot is a module called <code>spring-boot-actuator</code> that provides these endpoints.
The endpoints are disabled by default so the first step is to enabled them.</p>
</div>
<hr>
<div class="paragraph">
<p>If you open up <code>grails-app/conf/application.yml</code> you will find a block of configuration that looks like this:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment"># Spring Actuator Endpoints are Disabled by Default</span>
<span class="key">endpoints</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You simply have to enable the actuator endpoints by setting <strong><code>enabled: true</code></strong></p>
</div>
<div class="listingblock">
<div class="title">/grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">endpoints</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>


<h1 id="runningTheApp">4 Running the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/runningTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To run the application use the <code>./gradlew bootRun</code> command which will start the application on port 8080.</p>
</div>
<div class="paragraph">
<p>After enabling the actuator endpoints, when you run the application you can go to the <code>/info</code> endpoint at <a href="http://localhost:8080/info" class="bare">http://localhost:8080/info</a>
and you should see some JSON formatted info like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="error">a</span><span class="error">p</span><span class="error">p</span>: {
        <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">complete</span><span class="delimiter">&quot;</span></span>,
        <span class="error">g</span><span class="error">r</span><span class="error">a</span><span class="error">i</span><span class="error">l</span><span class="error">s</span><span class="error">V</span><span class="error">e</span><span class="error">r</span><span class="error">s</span><span class="error">i</span><span class="error">o</span><span class="error">n</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">3.2.6</span><span class="delimiter">&quot;</span></span>,
        <span class="error">v</span><span class="error">e</span><span class="error">r</span><span class="error">s</span><span class="error">i</span><span class="error">o</span><span class="error">n</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.1</span><span class="delimiter">&quot;</span></span>
    },
    <span class="error">g</span><span class="error">i</span><span class="error">t</span>: {
        <span class="error">c</span><span class="error">o</span><span class="error">m</span><span class="error">m</span><span class="error">i</span><span class="error">t</span>: {
            <span class="error">t</span><span class="error">i</span><span class="error">m</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2017-02-16T10:31-0600</span><span class="delimiter">&quot;</span></span>,
            <span class="error">i</span><span class="error">d</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2f27f2c</span><span class="delimiter">&quot;</span></span>
        },
        <span class="error">b</span><span class="error">r</span><span class="error">a</span><span class="error">n</span><span class="error">c</span><span class="error">h</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">master</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>


<h1 id="configuration">5 Configuration</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/configuration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You may not have wanted to enable <em>all</em> of the default actuator endpoints.
If you wanted to just enable the <code>info</code> endpoint you&#8217;ll want to set <code>endpoints.info.enabled=true</code> via config and leave <code>endpoints.enabled=false</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="comment"># Spring Actuator Endpoints are Disabled by Default</span>
<span class="key">endpoints</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">false</span></span>
    <span class="key">info</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
You should be aware that enabling the <em>all</em> off the actuator endpoints might open up several endpoints that you may not want to exposed.
Some of the endpoints expose sensitive information and you may have to secure or disable them. Consult the documentation for more info <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html" class="bare">http://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html</a>
</td>
</tr>
</table>
</div>


<h2 id="configuringGitInfoContributor">5.1 Configuring the commit info shown</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/configuringGitInfoContributor.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You may have noticed that the <code>/info</code> endpoint is only a subset of the properties in <code>git.properties</code> such as the abbreviated sha, commit time and branch.
You can display the full git properties via configuration by setting <code>management.info.git.mode=full</code></p>
</div>
<div class="paragraph">
<p>You&#8217;ll set these values in <code>grails-app/conf/application.yml</code></p>
</div>
<div class="listingblock">
<div class="title">/complete/grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">management</span>:
    <span class="key">info</span>:
        <span class="key">git</span>:
            <span class="key">mode</span>: <span class="string"><span class="content">full</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then when you restart the application and access the <code>/info</code> endpoint at <a href="http://localhost:8080/info" class="bare">http://localhost:8080/info</a> you should see something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="error">a</span><span class="error">p</span><span class="error">p</span>: {
        <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">complete</span><span class="delimiter">&quot;</span></span>,
        <span class="error">g</span><span class="error">r</span><span class="error">a</span><span class="error">i</span><span class="error">l</span><span class="error">s</span><span class="error">V</span><span class="error">e</span><span class="error">r</span><span class="error">s</span><span class="error">i</span><span class="error">o</span><span class="error">n</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">3.2.6</span><span class="delimiter">&quot;</span></span>,
        <span class="error">v</span><span class="error">e</span><span class="error">r</span><span class="error">s</span><span class="error">i</span><span class="error">o</span><span class="error">n</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">0.1</span><span class="delimiter">&quot;</span></span>
    },
    <span class="error">g</span><span class="error">i</span><span class="error">t</span>: {
        <span class="error">c</span><span class="error">o</span><span class="error">m</span><span class="error">m</span><span class="error">i</span><span class="error">t</span>: {
            <span class="error">m</span><span class="error">e</span><span class="error">s</span><span class="error">s</span><span class="error">a</span><span class="error">g</span><span class="error">e</span>: {
                <span class="error">f</span><span class="error">u</span><span class="error">l</span><span class="error">l</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Enabling Spring Actuator Endpoints</span><span class="delimiter">&quot;</span></span>,
                <span class="error">s</span><span class="error">h</span><span class="error">o</span><span class="error">r</span><span class="error">t</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Enabling Spring Actuator Endpoints</span><span class="delimiter">&quot;</span></span>
            },
            <span class="error">t</span><span class="error">i</span><span class="error">m</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">2017-02-16T11:46-0600</span><span class="delimiter">&quot;</span></span>,
            <span class="error">i</span><span class="error">d</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1695eb2c925e486acb962acf771f813a36568719</span><span class="delimiter">&quot;</span></span>,
            <span class="error">i</span><span class="error">d</span><span class="error">.</span><span class="error">a</span><span class="error">b</span><span class="error">b</span><span class="error">r</span><span class="error">e</span><span class="error">v</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1695eb2</span><span class="delimiter">&quot;</span></span>,
            <span class="error">u</span><span class="error">s</span><span class="error">e</span><span class="error">r</span>: {
                <span class="error">e</span><span class="error">m</span><span class="error">a</span><span class="error">i</span><span class="error">l</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">colin.harrington@gmail.com</span><span class="delimiter">&quot;</span></span>,
                <span class="error">n</span><span class="error">a</span><span class="error">m</span><span class="error">e</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Colin Harrington</span><span class="delimiter">&quot;</span></span>
            }
        },
        <span class="error">b</span><span class="error">r</span><span class="error">a</span><span class="error">n</span><span class="error">c</span><span class="error">h</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">master</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check the documentation for more configuration <a href="http://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html#production-ready-application-info-git" class="bare">http://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html#production-ready-application-info-git</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Under the hood there this behavior is handled by the <a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/GitInfoContributor.java">GitInfoContributor</a>.
The <a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/endpoint/InfoEndpoint.java">InfoEndpoint</a> is extensible and will aggregate all enabled beans implementing <code>org.springframework.boot.actuate.info.InfoContributor</code>
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>Moreover, we can add a <strong>functional test</strong> to verify that Git information appears in the rest response.</p>
</div>
<div class="paragraph">
<p>Add <code>grails-datastore-rest-client</code> plugin to your <code>dependencies</code> block</p>
</div>
<div class="listingblock">
<div class="title">/complete/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails:grails-datastore-rest-client</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/complete/src/integration-test/groovy/demo/InfoSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.plugins.rest.client.RestBuilder</span>
<span class="keyword">import</span> <span class="include">grails.testing.mixin.integration.Integration</span>
<span class="keyword">import</span> <span class="include">grails.transaction.Rollback</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@Integration</span>
<span class="type">class</span> <span class="class">InfoSpec</span> <span class="directive">extends</span> Specification {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test git commit info appears in JSON</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        RestBuilder rest = <span class="keyword">new</span> RestBuilder()

        <span class="key">when</span>:
        <span class="keyword">def</span> resp = rest.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:</span><span class="inline"><span class="inline-delimiter">${</span>serverPort<span class="inline-delimiter">}</span></span><span class="content">/info</span><span class="delimiter">&quot;</span></span>) {
            header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>)
        }

        <span class="key">then</span>:
        resp.statusCode.value() == <span class="integer">200</span>
        resp.json
        resp.json.git
        resp.json.git.commit
        resp.json.git.commit.message
        resp.json.git.commit.time
        resp.json.git.commit.id
        resp.json.git.commit.user
        resp.json.git.branch
    }
}</code></pre>
</div>
</div>


<h2 id="perEnvironmentConfig">5.2 Environment Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/perEnvironmentConfig.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Adding git commit information to your application is handy for debugging and transparency.  The default simple mode only exposes the sha, time and branch name.
There are some organizations who would would prefer to restrict commit info even further in their more sensitive environments.</p>
</div>
<div class="paragraph">
<p>One approach is to leverage <a href="http://docs.grails.org/latest/guide/conf.html#environments">per-environment configuration</a>
to enable/disable and configure the endpoints differently according to the environment.
For example if you only wanted simple mode enabled in production you might use the following config:</p>
</div>
<div class="listingblock">
<div class="title">/complete/grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">environments</span>:
    <span class="key">production</span>:
        <span class="key">management</span>:
            <span class="key">info</span>:
                <span class="key">git</span>:
                    <span class="key">mode</span>: <span class="string"><span class="content">simple</span></span></code></pre>
</div>
</div>


<h2 id="secured">5.3 Secure your endpoints if neccesary</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/secured.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In addition to the environment specific configuration, some organizations may want to restrict usage to only authenticated users or a specific set of roles.
This can be accomplished by plugging into your security plugin.  We&#8217;ll use Spring Security as a canonical example.
The <code>/info</code> endpoint isn&#8217;t a Grails controller so if you use the default annotation based approach you&#8217;ll have to configure <code>grails.plugin.springsecurity.controllerAnnotations.staticRules</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.plugin.springsecurity.controllerAnnotations.staticRules = [
   [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>,               <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
   [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/error</span><span class="delimiter">'</span></span>,          <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
   [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/index</span><span class="delimiter">'</span></span>,          <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
   <span class="comment">// ...</span>
   [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/info</span><span class="delimiter">'</span></span>,           <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_ADMIN</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">isFullyAuthenticated()</span><span class="delimiter">'</span></span>]]
]</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p>The <a href="https://grails-plugins.github.io/grails-spring-security-core/v3/index.html#requestmapInstances">RequestMaps</a>
or <a href="https://grails-plugins.github.io/grails-spring-security-core/v3/index.html#configGroovyMap">simple map</a>
security configuration approaches use the request&#8217;s url so they won&#8217;t need anything special handling.
Consult the Spring <a href="https://grails-plugins.github.io/grails-spring-security-core/">Security Core&#8217;s plugin documentation</a> for more.</p>
</div>


<h1 id="tldr">6 tl;dr (Too long; didn't read)</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/adding-commit-info/edit/master/src/main/docs/guide/tldr.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Summary:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the <a href="https://plugins.gradle.org/plugin/com.gorylenko.gradle-git-properties">gradle-git-properties plugin</a></p>
</li>
<li>
<p>Enable actuator endpoint via <code>endpoints.info.enabled=true</code> or <code>endpoints.enabled=true</code></p>
</li>
<li>
<p><a href="#configuration">Configure</a> and <a href="#secured">Secure</a> the endpoint as desired</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
<li>
<p>Enjoy knowing exactly which version of code is running (<em>profit!</em>)</p>
</li>
</ul>
</div>

                                        </div>
                                    </td>
                                    <td id="col2">
                                        <div class="local clearfix">
                                            <div class="local-title" style="text-align: right"><a href="https://travis-ci.org/grails-guides/adding-commit-info"><img src="https://travis-ci.org/grails-guides/adding-commit-info.svg?branch=master" /></a></div>            

                                            <div class="local-title">
                                                <a href="https://github.com/grails-guides/adding-commit-info">
                                                    <svg height="35" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="35" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></a> &nbsp;&nbsp;Get the Code
                                                </div>
                                                <div class="menu">
                                                    <div class="input-group">                        
                                                        <button href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/adding-commit-info.git'" class="codeButton">SSH</button>
                                                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/adding-commit-info.git'" class="codeButton">HTTPS</button>
                                                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/adding-commit-info'" class="codeButton">Subversion</button>
                                                    </div>

                                                    <div class="input-group">                    
                                                        <!-- Target -->
                                                        <input id="github-url" value="git@github.com:grails-guides/adding-commit-info.git" type="text" />

                                                        <!-- Trigger -->
                                                        <button class="clipbtn" type="button" data-clipboard-target="#github-url">

                                                            <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
                                                        </button>       

                                                    </div>
                                                    <div class="input-group">
                                                      <a href="https://github.com/grails-guides/adding-commit-info/archive/master.zip" class="downloadButton">Download ZIP</a>
                                                  </div>
                                              </div>
                                              
                                              <div id="table-of-content">
                                                <h2>Table of Contents</h2>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>1</strong><span>Getting Started</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>1.1</strong><span>What you will need</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#howto"><strong>1.2</strong><span>How to complete the guide</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#history"><strong>2</strong><span>History</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#earlyDays"><strong>2.1</strong><span>Early approaches</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#applicationProperties"><strong>2.2</strong><span>application.properties</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#buildInfoPlugin"><strong>2.3</strong><span>Build Info Plugin</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#writingTheApp"><strong>3</strong><span>Writing the Application</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#gradlePlugin"><strong>3.1</strong><span>Gradle Plugin</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#actuator"><strong>3.2</strong><span>Spring Boot Actuator endpoints</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#runningTheApp"><strong>4</strong><span>Running the Application</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#configuration"><strong>5</strong><span>Configuration</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#configuringGitInfoContributor"><strong>5.1</strong><span>Configuring the commit info shown</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#perEnvironmentConfig"><strong>5.2</strong><span>Environment Configuration</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#secured"><strong>5.3</strong><span>Secure your endpoints if neccesary</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#tldr"><strong>6</strong><span>tl;dr (Too long; didn't read)</span></a></div>
                                                
                            <div style="clear:both" ></div>
                        </div>
                                            
                    </div>
                </td>
            </tr>
        </table>

        <div id="footer">
            Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing. 
            
        </div>

            <!-- END CONTENT -->
          </div>
        </div>
      </div>
    </div>

<script type="text/javascript">
    new Clipboard('.clipbtn');
</script>
<script type="text/javascript" src="../js/docs.js"></script>
<script type="text/javascript" src="../js/classie.js"></script>        
<script type="text/javascript" src="../js/sidebarEffects.js"></script>
<script type="text/javascript" src="../js/navbar.js"></script> 
<style type="text/css">
    #colset {
        background-color: #f5f5f5;
    }
    .grailsnavbar {
        padding-right: 0;
    }
    #fork-me {
        display: none;
    }
</style>       
    </body>
</html>
