<!DOCTYPE html>
<html>
<head>
    <meta name='google-site-verification' content='REYQ1_I6HGowAE7LOLVqfQbnKaB4IfFpMlGzMbJj55Q' />
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link rel='icon' href='../img/micronaut-favicon.ico' />
    <meta charset='UTF-8' />
    <title>Error Handling | Micronaut Guides | Micronaut Framework</title>
    <meta name='description' content='Error Handling. Learn about Error handling in Micronaut.' />
    <link rel="stylesheet" href="../css/highlight/agate.css">
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel='stylesheet' href='../css/main.css' />
    <link rel='stylesheet' href='../css/screen.css' />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js'></script>
</head>
<body class='guide'>
<div id="navigation">
    <div class="navTitle">
        <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="../img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <a href="http://guides.micronaut.io">Micronaut Guides</a>
                <span> &rarr; </span>
                <a href="http://guides.micronaut.io/micronaut-error-handling/guide/index.html">Error Handling</a>
            </li>
        </ul>

    </div>
</div>

<div class='fullwidth'><article class="guide">
    <aside>
        <a href="https://travis-ci.org/micronaut-guides/micronaut-error-handling"><img src="https://travis-ci.org/micronaut-guides/micronaut-error-handling.svg?branch=master"></a>

        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/micronaut-guides/micronaut-error-handling&quot;"><img height="15" src="../img/github_white.svg" alt="Github"/><span>&nbsp;Get the Code</span></button>


        <ul class="githublinks">
            <li><button type="button" class="btn btn-default" href="#" onclick="document.getElementById('github-url').value='git@github.com:micronaut-guides/micronaut-error-handling.git'" class="codeButton">SSH</button></li>
            <li><button type="button" class="btn btn-default" onclick="document.getElementById('github-url').value='https://github.com/micronaut-guides/micronaut-error-handling.git'" class="codeButton">HTTPS</button></li>
        </ul>
        <div class="input-group">
            <!-- Target -->
            <input id="github-url" value="git@github.com:micronaut-guides/micronaut-error-handling.git" type="text" />
            <!-- Trigger -->
            <button type="button" class="clippy btn btn-default" type="button" data-clipboard-target="#github-url">
                <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
            </button>
        </div>
        <script>var clipboard = new Clipboard('.clippy');</script>
        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/micronaut-guides/micronaut-error-handling/archive/master.zip&quot;">Download ZIP</button>
        
        <div id="table-of-content">
            <h3>Table of Contents</h3>
            
            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>1</strong><span>Getting Started</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>1.1</strong><span>What you will need</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#solution"><strong>1.2</strong><span>Solution</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#writingTheApp"><strong>2</strong><span>Writing the App</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#globalerror"><strong>2.1</strong><span>Global @Error</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#localerror"><strong>2.2</strong><span>Local @Error</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#exceptionhandler"><strong>2.3</strong><span>ExceptionHandler</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#graal"><strong>3</strong><span>Generate a Micronaut app's Native Image with GraalVM</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#graalchanges"><strong>3.1</strong><span>Micronaut + GraalVM changes</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#graalnativeimage"><strong>3.2</strong><span>Native Image generation</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#graalreflectjson"><strong>3.3</strong><span>Provide Reflection Config</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#graaldocker"><strong>3.4</strong><span>Native Image generation with Docker</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#nextSteps"><strong>4</strong><span>Next Steps</span></a></div>
            
            <div style="clear:both" ></div>
        </div>
        
    </aside>
    <header>
        <h1>Error Handling</h1>
        <p>Learn about Error handling in Micronaut.</p>
        <p><strong>Authors:</strong> Sergio del Amo</p>
        <p><strong>Micronaut Version:</strong> 1.2.7</p>
    </header>
    

<h1 id="gettingStarted">1 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-error-handling/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this guide, you will learn the different options to handle errors in Micronaut.</p>
</div>


<h2 id="requirements">1.1 What you will need</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-error-handling/edit/master/src/main/docs/guide/requirements.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.8 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
</ul>
</div>


<h2 id="solution">1.2 Solution</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-error-handling/edit/master/src/main/docs/guide/solution.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We recommend you to follow the instructions in the next sections and create the app step by step. However, you can go right to the <strong>completed example</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/micronaut-guides/micronaut-error-handling/archive/master.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the <a href="https://git-scm.com/">Git</a> repository: <code>git clone <a href="https://github.com/micronaut-guides/micronaut-error-handling.git" class="bare">https://github.com/micronaut-guides/micronaut-error-handling.git</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then, <code>cd</code> into the <code>complete</code> folder which you will find in the root project of the downloaded/cloned project.</p>
</div>


<h1 id="writingTheApp">2 Writing the App</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-error-handling/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create the microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">mn create-app example.micronaut.complete</code></pre>
</div>
</div>


<h2 id="globalerror">2.1 Global @Error</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-error-handling/edit/master/src/main/docs/guide/writingTheApp/globalerror.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We want to display a custom <code>Not Found</code> page when the user attempts to access a uri for which we have not any route defined for.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/notfound.png" alt="notfound">
</div>
</div>
<div class="paragraph">
<p>The views module provides support for view rendering on the server side and does so by rendering views on the I/O thread pool in order to avoid blocking the Netty event loop.</p>
</div>
<div class="paragraph">
<p>To use the view rendering features described in this section, add the following dependency on your classpath. For example, in build.gradle</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">implementation "io.micronaut:micronaut-views-velocity"
runtime "org.apache.velocity:velocity-engine-core:2.0"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut ships out-of-the-box with support for <a href="http://velocity.apache.org/">Apache Velocity</a>, <a href="https://www.thymeleaf.org/">Thymeleaf</a> or <a href="http://jknack.github.io/handlebars.java/">Handlebars</a>. In this guide, we use Apache Velocity.</p>
</div>
<div class="paragraph">
<p>Create a <code>notFound.vm</code> view:</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/views/notFound.vm</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Not Found&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;NOT FOUND&lt;/h1&gt;

&lt;p&gt;&lt;b&gt;The page you were looking for appears to have been moved, deleted or does not exist.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;This is most likely due to:&lt;/p&gt;

&lt;ul&gt;
    &lt;li&gt;An outdated link on another site&lt;/li&gt;
    &lt;li&gt;A typo in the address / URL&lt;/li&gt;
&lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a <code>NotFoundController</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/micronaut/NotFoundController.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.http.HttpRequest;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.HttpStatus;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Error;
import io.micronaut.http.hateoas.JsonError;
import io.micronaut.http.hateoas.Link;
import io.micronaut.views.ViewsRenderer;

import java.util.Collections;

@Controller("/notfound") <i class="conum" data-value="1"></i><b>(1)</b>
public class NotFoundController {

    private final ViewsRenderer viewsRenderer;

    public NotFoundController(ViewsRenderer viewsRenderer) { <i class="conum" data-value="2"></i><b>(2)</b>
        this.viewsRenderer = viewsRenderer;
    }

    @Error(status = HttpStatus.NOT_FOUND, global = true)  <i class="conum" data-value="3"></i><b>(3)</b>
    public HttpResponse notFound(HttpRequest request) {
        if (request.getHeaders()
                .accept()
                .stream()
                .anyMatch(mediaType -&gt; mediaType.getName().contains(MediaType.TEXT_HTML))) { <i class="conum" data-value="4"></i><b>(4)</b>
            return HttpResponse.ok(viewsRenderer.render("notFound", Collections.emptyMap()))
                    .contentType(MediaType.TEXT_HTML);
        }

        JsonError error = new JsonError("Page Not Found")
                .link(Link.SELF, Link.of(request.getUri()));

        return HttpResponse.&lt;JsonError&gt;notFound()
                .body(error); <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <code>@Controller</code> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject an available <a href="https://micronaut-projects.github.io/micronaut-views/latest/api/index.html">ViewRenderer</a> bean to render an HTML view.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The Error declares which <code>HttpStatus</code> error code to handle (in this case 404). We declare the method as a global error handler due to <code>global = true</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If the request <code>Accept</code> HTTP Header contains <code>text/html</code>, we respond an HTML View.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>By default, we respond JSON.</td>
</tr>
</table>
</div>


<h2 id="localerror">2.2 Local @Error</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-error-handling/edit/master/src/main/docs/guide/writingTheApp/localerror.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut&#8217;s validation is built on with the standard framework – JSR 380, also known as Bean Validation 2.0.</p>
</div>
<div class="paragraph">
<p>Hibernate Validator is a reference implementation of the validation API. Starting with Micronaut 1.2, Micronaut
<a href="https://docs.micronaut.io/latest/guide/index.html#beanValidation">has built-in support for validation beans</a> that
are annotated with <code>javax.validation</code> annotations.</p>
</div>
<div class="paragraph">
<p>Add the next snippet to <code>build.gradle</code></p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">implementation "io.micronaut:micronaut-validation"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then create a view to display a form:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/createbook.png" alt="createbook">
</div>
</div>
<div class="listingblock">
<div class="title">src/main/resources/views/bookscreate.vm</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-html" data-lang="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Create Book&lt;/title&gt;
    &lt;style type="text/css"&gt;
        form fieldset li {
            list-style-type: none;
        }
        #errors span { color: red; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Create Book&lt;/h1&gt;
&lt;form action="/books/save" method="post"&gt;
    &lt;fieldset&gt;
        &lt;ol&gt;
            &lt;li&gt;
                &lt;label for="title"&gt;Title&lt;/label&gt;
                &lt;input type="text" id="title" name="title" value="$title"/&gt;
            &lt;/li&gt;
            &lt;li&gt;
                &lt;label for="pages"&gt;Pages&lt;/label&gt;
                &lt;input type="text" id="pages" name="pages" value="$pages"/&gt;
            &lt;/li&gt;
            &lt;li&gt;
                &lt;input type="submit" value="Save"/&gt;
            &lt;/li&gt;
        &lt;/ol&gt;
    &lt;/fieldset&gt;
&lt;/form&gt;
#if( $errors )
    &lt;ul id="errors"&gt;
        #foreach( $error in $errors )
            &lt;li&gt;&lt;span&gt;$error&lt;/span&gt;&lt;/li&gt;
        #end
    &lt;/ul&gt;
#end
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a controller to map the form submission:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/micronaut/BookController.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.http.HttpRequest;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.MediaType;
import io.micronaut.http.annotation.Body;
import io.micronaut.http.annotation.Consumes;
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Error;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Post;
import io.micronaut.http.annotation.Produces;
import io.micronaut.views.View;

import javax.validation.ConstraintViolationException;
import javax.validation.Valid;
import java.util.HashMap;
import java.util.Map;
import java.util.Optional;

@Controller("/books") <i class="conum" data-value="1"></i><b>(1)</b>
public class BookController {

    @View("bookscreate") <i class="conum" data-value="2"></i><b>(2)</b>
    @Get("/create") <i class="conum" data-value="3"></i><b>(3)</b>
    public Map&lt;String, Object&gt; create() {
        return createModelWithBlankValues();
    }

    @Consumes(MediaType.APPLICATION_FORM_URLENCODED) <i class="conum" data-value="4"></i><b>(4)</b>
    @Post("/save") <i class="conum" data-value="5"></i><b>(5)</b>
    public HttpResponse save(@Valid @Body CommandBookSave cmd) { <i class="conum" data-value="6"></i><b>(6)</b>
        return HttpResponse.ok();
    }

    private Map&lt;String, Object&gt; createModelWithBlankValues() {
        final Map&lt;String, Object&gt; model = new HashMap&lt;&gt;();
        model.put("title", "");
        model.put("pages", "");
        return model;
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <code>@Controller</code> annotation mapped to the path <code>/books</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>@View</code> annotation to indicate the view name which should be used to render a view for the route.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can specify the HTTP verb that a controller’s action responds to. To respond to a GET request, use the <code>io.micronaut.http.annotation.Get</code> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>@Consumes</code> annotation takes a <code>String[]</code> of supported media types for an incoming request.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>@Post</code> annotation is used to map the index method to all requests that use an HTTP POST</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Add <code>@Valid</code> to any method parameter which requires validation. We use a POJO to encapsulate the form submission.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create the POJO encapsulating the submission:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/micronaut/BookController.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.core.annotation.Introspected;

import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;
import javax.validation.constraints.Positive;

@Introspected <i class="conum" data-value="1"></i><b>(1)</b>
public class CommandBookSave {
    @NotBlank <i class="conum" data-value="2"></i><b>(2)</b>
    private String title;

    @NotNull <i class="conum" data-value="3"></i><b>(3)</b>
    @Positive <i class="conum" data-value="4"></i><b>(4)</b>
    private Integer pages;

    public CommandBookSave() {
    }

    public String getTitle() {
        return title;
    }

    public void setTitle(String title) {
        this.title = title;
    }

    public Integer getPages() {
        return pages;
    }

    public void setPages(Integer pages) {
        this.pages = pages;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@Introspected</code> to generate the Bean Metainformation at compile time.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>title</code> is required and must be not blank.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>pages</code> is required.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>pages</code> must be greater than 0.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the form submission fails, we want to display the errors in the UI as the next image illustrates:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/createbookserrors.png" alt="createbookserrors">
</div>
</div>
<div class="paragraph">
<p>An easy way to achieve it is to capture the <code>javax.validation.ConstraintViolationException</code> exception in a local <code>@Error</code> handler. Modify <code>BookController.java</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/micronaut/BookController.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">...
class BookController {
...
..
    private final MessageSource messageSource;

    public BookController(MessageSource messageSource) { <i class="conum" data-value="1"></i><b>(1)</b>
        this.messageSource = messageSource;
    }
...
.
    @View("bookscreate")
    @Error(exception = ConstraintViolationException.class) <i class="conum" data-value="2"></i><b>(2)</b>
    public Map&lt;String, Object&gt; onSavedFailed(HttpRequest request, ConstraintViolationException ex) { <i class="conum" data-value="3"></i><b>(3)</b>
        final Map&lt;String, Object&gt; model = createModelWithBlankValues();
        model.put("errors", messageSource.violationsMessages(ex.getConstraintViolations()));
        Optional&lt;CommandBookSave&gt; cmd = request.getBody(CommandBookSave.class);
        cmd.ifPresent(bookSave -&gt; populateModel(model, bookSave));
        return model;
    }

    private void populateModel(Map&lt;String, Object&gt; model, CommandBookSave bookSave) {
        model.put("title", bookSave.getTitle());
        model.put("pages", bookSave.getPages());
    }


..
...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Constructor injection</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>By default <code>@Error</code> annotations are local. We specify the exception which we want to handle.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can access the original <code>HttpRequest</code> which triggered the exception.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create a <code>javax.inject.Singleton</code> to encapsulate the generation of a list of messages from a <code>Set</code> of <code>ConstraintViolation</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/micronaut/MessageSource.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import javax.inject.Singleton;
import javax.validation.ConstraintViolation;
import javax.validation.Path;
import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;

@Singleton
public class MessageSource {

    public List&lt;String&gt; violationsMessages(Set&lt;ConstraintViolation&lt;?&gt;&gt; violations) {
        return violations.stream()
                .map(MessageSource::violationMessage)
                .collect(Collectors.toList());
    }

    private static String violationMessage(ConstraintViolation violation) {
        StringBuilder sb = new StringBuilder();
        Path.Node lastNode = lastNode(violation.getPropertyPath());
        if (lastNode != null) {
            sb.append(lastNode.getName());
            sb.append(" ");
        }
        sb.append(violation.getMessage());
        return sb.toString();
    }

    private static Path.Node lastNode(Path path) {
        Path.Node lastNode = null;
        for (final Path.Node node : path) {
            lastNode = node;
        }
        return lastNode;
    }
}</code></pre>
</div>
</div>


<h2 id="exceptionhandler">2.3 ExceptionHandler</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-error-handling/edit/master/src/main/docs/guide/writingTheApp/exceptionhandler.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Another mechanism to handle global exception is to use a <code>ExceptionHandler</code>.</p>
</div>
<div class="paragraph">
<p>Modify the controller and add a method to throw an exception:</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/micronaut/BookController.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">@Controller("/books") <i class="conum" data-value="1"></i><b>(1)</b>
public class BookController {
...
..
.
    @Produces(MediaType.TEXT_PLAIN)
    @Get("/stock/{isbn}")
    public Integer stock(String isbn) {
        throw new OutOfStockException();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <code>@Controller</code> annotation mapped to the path <code>/books</code></td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/micronaut/OutOfStockException.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

public class OutOfStockException extends RuntimeException {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Implement a ExceptionHandler; a generic hook for handling exceptions that occurs during the execution of an HTTP request.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/example/micronaut/OutOfStockExceptionHandler.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java" data-lang="java">package example.micronaut;

import io.micronaut.context.annotation.Requires;
import io.micronaut.http.HttpRequest;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.annotation.Produces;
import io.micronaut.http.server.exceptions.ExceptionHandler;
import javax.inject.Singleton;

@Produces
@Singleton <i class="conum" data-value="1"></i><b>(1)</b>
@Requires(classes = {OutOfStockException.class, ExceptionHandler.class})  <i class="conum" data-value="2"></i><b>(2)</b>
public class OutOfStockExceptionHandler implements ExceptionHandler&lt;OutOfStockException, HttpResponse&gt; { <i class="conum" data-value="3"></i><b>(3)</b>

    @Override
    public HttpResponse handle(HttpRequest request, OutOfStockException exception) {
        return HttpResponse.ok(0); <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>To register a Singleton in Micronaut’s application context, annotate your class with <code>javax.inject.Singleton</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This bean loads if <code>OutOfStockException</code>, <code>ExceptionHandler</code> are available.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify the <code>Throwable</code> to handle.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Return 200 OK with a body of 0; no stock.</td>
</tr>
</table>
</div>


<h1 id="graal">3 Generate a Micronaut app's Native Image with GraalVM</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-error-handling/edit/master/src/main/docs/guide/graal.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to use <a href="https://www.graalvm.org">GraalVM</a>, the polyglot embeddable virtual machine, to generate a Native image
of our Micronaut application.</p>
</div>
<div class="paragraph">
<p>Native images compiled with GraalVM ahead-of-time improve the startup time and reduce the memory footprint of JVM-based
applications.</p>
</div>


<h2 id="graalchanges">3.1 Micronaut + GraalVM changes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-error-handling/edit/master/src/main/docs/guide/graal/graalchanges.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut itself does not rely on reflection or dynamic classloading so works automatically with GraalVM native.</p>
</div>
<div class="paragraph">
<p>First, add Micronaut Graal&#8217;s annotation processor that helps to handle generating the <code>reflection-config.json</code> metadata
that is automatically picked up by the <code>native-image</code> tool:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">dependencies {
...
..
.
    annotationProcessor "io.micronaut:micronaut-graal"
}</code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>GraalVM Native Image allows you to ahead-of-time compile Java code to a standalone executable, called a native image.
This executable includes the application, the libraries, the JDK and does not run on the Java VM, but includes necessary
components like memory management and thread scheduling from a different virtual machine, called “Substrate VM”. Substrate
VM is the name for the runtime components (like the deoptimizer, garbage collector, thread scheduling etc.). The resulting
program has faster startup time and lower runtime memory overhead compared to a Java VM.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>We need to add a dependency to <code>svm</code>:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">dependencies {
...
..
.
    implementation("io.micronaut:micronaut-graal")
    compileOnly "org.graalvm.nativeimage:svm:19.3.0"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To simplify building the image you need to create a <code>native-image.properties</code> file.
The convention is to use the folder <code>src/main/resources/META-INF/native-image</code> and then a folder following the maven coordinates of the application. For our example <code>example.micronaut/micronautguide</code>.</p>
</div>
<div class="paragraph">
<p>Add a <code>native-image.properties</code> inside  <code>src/main/resources/META-INF/native-image/example.micronaut/micronautguide</code> folder.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/META-INF/native-image/example.micronaut/micronautguide/native-image.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">Args = -H:IncludeResources=logback.xml|application.yml|.*/*.vm \
       -H:Name=micronautguide \
       -H:Class=example.micronaut.Application</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>-H:IncludeResources</code> argument allows you to tweak which static resources to include. You can use regular expressions.</p>
</li>
<li>
<p>The <code>-H:Name</code> argument specifies the name of the native image that will be generated.</p>
</li>
<li>
<p>The <code>-H:Class</code> argument specifies the entry point of your application (the class that defines a static void main method.</p>
</li>
</ul>
</div>


<h2 id="graalnativeimage">3.2 Native Image generation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-error-handling/edit/master/src/main/docs/guide/graal/graalnativeimage.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The easiest way to install GraalVM is to use <a href="https://sdkman.io">SDKMan.io</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ sdk list java
================================================================================
Available Java Versions
================================================================================
 Vendor        | Use | Version      | Dist    | Status     | Identifier
--------------------------------------------------------------------------------
....
 GraalVM       |     | 19.3.0.r11   | grl     | installed  | 19.3.0.r11-grl
               |     | 19.3.0.r8    | grl     | installed  | 19.3.0.r8-grl
               |     | 19.2.1       | grl     |            | 19.2.1-grl
               |     | 19.1.1       | grl     |            | 19.1.1-grl
               |     | 19.0.2       | grl     |            | 19.0.2-grl


# For Java 8
$ sdk install java 19.3.0.r8-grl

# For Java 11
$ sdk install java 19.3.0.r11-grl</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to install the <code>native-image</code> component which is not installed by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ gu install native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>To generate the native image you need to generate the FAT JAR first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./gradlew assemble</code></pre>
</div>
</div>
<div class="paragraph">
<p>Invoke <code>native-image</code>. It may take a minute to complete.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ which java
/Users/sdelamo/.sdkman/candidates/java/19.3.0.r8-grl/bin/java</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ native-image --no-server -cp build/libs/complete-0.1-all.jar
[micronautguide:39362]    classlist:   3,884.97 ms
[micronautguide:39362]        (cap):   5,919.80 ms
[micronautguide:39362]        setup:   7,222.88 ms
[micronautguide:39362]   (typeflow):  14,037.78 ms
[micronautguide:39362]    (objects):  17,689.40 ms
[micronautguide:39362]   (features):   1,751.37 ms
[micronautguide:39362]     analysis:  35,421.99 ms
[micronautguide:39362]     (clinit):     978.01 ms
[micronautguide:39362]     universe:   2,114.65 ms
[micronautguide:39362]      (parse):   2,327.75 ms
[micronautguide:39362]     (inline):   2,153.46 ms
[micronautguide:39362]    (compile):  13,066.94 ms
[micronautguide:39362]      compile:  19,714.97 ms
[micronautguide:39362]        image:   3,509.84 ms
[micronautguide:39362]        write:   1,114.96 ms
[micronautguide:39362]      [total]:  73,294.82 ms</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>--no-server</code> options tells to not use server-based image building.</p>
</div>
<div class="paragraph">
<p>You can invoke the generated native image <code>micronautguide</code>. Startup will be really fast.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"> $ ./micronautguide -Xmx68m
07:42:20.792 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 21ms. Server Running: http://localhost:8080</code></pre>
</div>
</div>


<h2 id="graalreflectjson">3.3 Provide Reflection Config</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-error-handling/edit/master/src/main/docs/guide/graal/graalreflectjson.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>After you run the native image, execute a curl request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">curl -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8' localhost:8080/foo
{"message":"Internal Server Error: Velocity could not be initialized!"}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We expected to retrieve the <code>Not Found</code> HTML page however we get an exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./micronautguide
13:19:04.792 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 18ms. Server Running: http://localhost:8080
13:19:08.712 [pool-2-thread-2] ERROR org.apache.velocity - The specified class for ResourceManager (org.apache.velocity.runtime.resource.ResourceManagerImpl) does not exist or is not accessible to the current classloader.
13:19:08.712 [pool-2-thread-2] ERROR org.apache.velocity - Could not auto-initialize Velocity
org.apache.velocity.exception.VelocityException: The specified class for ResourceManager (org.apache.velocity.runtime.resource.ResourceManagerImpl) does not exist or is not accessible to the current classloader.
	....</code></pre>
</div>
</div>
<div class="paragraph">
<p>We need to provide a reflection configuration file for <a href="https://velocity.apache.org">Velocity</a>.</p>
</div>
<div class="paragraph">
<p>Fortunately, GraalVM native image module provides a tracing agent to simplify GraalVM Native Image configuration.</p>
</div>
<div class="paragraph">
<p>Create folder to save the configuration files</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ mkdir config-files</code></pre>
</div>
</div>
<div class="paragraph">
<p>Stop the native image and run the app with the tracing agent.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ java -jar  -agentlib:native-image-agent=config-output-dir=config-files build/libs/complete-0.1-all.jar
$ 13:24:58.938 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 1185ms. Server Running: http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the app starts, run the curl request again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"> % curl -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8' localhost:8080/foo
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Not Found&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;NOT FOUND&lt;/h1&gt;

&lt;p&gt;&lt;b&gt;The page you were looking for appears to have been moved, deleted or does not exist.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;This is most likely due to:&lt;/p&gt;

&lt;ul&gt;
    &lt;li&gt;An outdated link on another site&lt;/li&gt;
    &lt;li&gt;A typo in the address / URL&lt;/li&gt;
&lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;%</code></pre>
</div>
</div>
<div class="paragraph">
<p>Stop the app and inspect the folder <code>config-files</code>. Several files have been created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">jni-config.json
proxy-config.json
reflect-config.json
resource-config.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy entries from the file <code>reflect-config.json</code>, which match the package <code>org.apache.velocity</code>, to a new file named <code>src/main/graal/reflect.json</code>.</p>
</div>
<div class="paragraph">
<p>The file will look like:</p>
</div>
<div class="listingblock">
<div class="title">src/main/graal/reflect.json</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json" data-lang="json">[
{
  "name":"org.apache.velocity.runtime.ParserPoolImpl",
  "methods":[{"name":"&lt;init&gt;","parameterTypes":[] }]
},
{
  "name":"org.apache.velocity.runtime.directive.Break",
  "methods":[{"name":"&lt;init&gt;","parameterTypes":[] }]
},
{
  "name":"org.apache.velocity.runtime.directive.Define",
  "methods":[{"name":"&lt;init&gt;","parameterTypes":[] }]
},
{
  "name":"org.apache.velocity.runtime.directive.Evaluate",
  "methods":[{"name":"&lt;init&gt;","parameterTypes":[] }]
},
{
  "name":"org.apache.velocity.runtime.directive.Foreach",
  "methods":[{"name":"&lt;init&gt;","parameterTypes":[] }]
},
{
  "name":"org.apache.velocity.runtime.directive.Include",
  "methods":[{"name":"&lt;init&gt;","parameterTypes":[] }]
},
{
  "name":"org.apache.velocity.runtime.directive.Macro",
  "methods":[{"name":"&lt;init&gt;","parameterTypes":[] }]
},
{
  "name":"org.apache.velocity.runtime.directive.Parse",
  "methods":[{"name":"&lt;init&gt;","parameterTypes":[] }]
},
{
  "name":"org.apache.velocity.runtime.directive.Stop",
  "methods":[{"name":"&lt;init&gt;","parameterTypes":[] }]
},
{
  "name":"org.apache.velocity.runtime.resource.ResourceCacheImpl",
  "methods":[{"name":"&lt;init&gt;","parameterTypes":[] }]
},
{
  "name":"org.apache.velocity.runtime.resource.ResourceManagerImpl",
  "methods":[{"name":"&lt;init&gt;","parameterTypes":[] }]
},
{
  "name":"org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader",
  "methods":[{"name":"&lt;init&gt;","parameterTypes":[] }]
},
{
  "name":"org.apache.velocity.util.introspection.ConversionHandlerImpl",
  "methods":[{"name":"&lt;init&gt;","parameterTypes":[] }]
},
{
  "name":"org.apache.velocity.util.introspection.UberspectImpl",
  "methods":[{"name":"&lt;init&gt;","parameterTypes":[] }]
}
]</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>src/main/graal/reflect.json</code> will be automatically picked up by Micronaut Graal annotation processor.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Generate the native image again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./gradlew clean
$ ./gradlew assemble
$ native-image --no-server -cp build/libs/complete-0.1-all.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the native image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./micronautguide
13:38:43.134 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 19ms. Server Running: http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, the curl request is successful:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"> % curl -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8' localhost:8080/foo
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Not Found&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;NOT FOUND&lt;/h1&gt;
....</code></pre>
</div>
</div>


<h2 id="graaldocker">3.4 Native Image generation with Docker</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-error-handling/edit/master/src/main/docs/guide/graal/graaldocker.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Alternatively, you can use <code>Dockerfile</code>  to construct the native image and a script <code>docker-build.sh</code> to run it:</p>
</div>
<div class="listingblock">
<div class="title">Dockerfile</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">FROM oracle/graalvm-ce:19.3.0-java8 as graalvm
COPY . /home/app/micronautguide
WORKDIR /home/app/micronautguide
RUN gu install native-image
RUN native-image --no-server -cp build/libs/complete-*-all.jar

FROM frolvlad/alpine-glibc
EXPOSE 8080
COPY --from=graalvm /home/app/micronautguide /app/micronautguide
ENTRYPOINT ["/app/micronautguide","-Xmx68m"]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">docker-build.sh</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">Unresolved directive in build/resources/micronaut-guides-master/src/main/docs/common-graal-docker.adoc - include::/home/travis/build/micronaut-guides/micronaut-error-handling/complete/../complete/docker-build.sh[]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ ./gradlew assemble

$ ./docker-build.sh
Sending build context to Docker daemon  64.67MB
Step 1/9 : FROM oracle/graalvm-ce:19.3.0-java8 as graalvm
 ---&gt; d625000893c9
Step 2/9 : COPY . /home/app/micronautguide
 ---&gt; 4c0daf50c6f3
Step 3/9 : WORKDIR /home/app/micronautguide
 ---&gt; Running in e07cf22b668a
Removing intermediate container e07cf22b668a
 ---&gt; d3699ea8e284
Step 4/9 : RUN gu install native-image
 ---&gt; Running in 71edf17b9a11
Downloading: Component catalog from www.graalvm.org
Processing Component: Native Image
Downloading: Component native-image: Native Image  from github.com
Installing new component: Native Image (org.graalvm.native-image, version 19.3.0)
Refreshed alternative links in /usr/bin/
Removing intermediate container 71edf17b9a11
 ---&gt; ee26c71bbd1e
Step 5/9 : RUN native-image --no-server --static -cp build/libs/complete-*-all.jar
 ---&gt; Running in d2cd451f33be
[micronautguide:28]    classlist:   8,773.36 ms
[micronautguide:28]        (cap):   1,044.04 ms
[micronautguide:28]        setup:   2,748.03 ms
[micronautguide:28]   (typeflow):  20,611.56 ms
[micronautguide:28]    (objects):  20,377.15 ms
[micronautguide:28]   (features):   2,168.30 ms
[micronautguide:28]     analysis:  45,559.16 ms
[micronautguide:28]     (clinit):   1,141.31 ms
[micronautguide:28]     universe:   2,719.10 ms
[micronautguide:28]      (parse):   2,808.15 ms
[micronautguide:28]     (inline):   3,094.66 ms
[micronautguide:28]    (compile):  25,648.31 ms
[micronautguide:28]      compile:  34,018.50 ms
[micronautguide:28]        image:   3,811.46 ms
[micronautguide:28]        write:     643.59 ms
[micronautguide:28]      [total]:  99,095.08 ms
Removing intermediate container d2cd451f33be
 ---&gt; 429a467e2fdd
Step 6/9 : FROM frolvlad/alpine-glibc
 ---&gt; 38dd85a430e8
Step 7/9 : EXPOSE 8080
 ---&gt; Using cache
 ---&gt; 643f9d29e3f8
Step 8/9 : COPY --from=graalvm /home/app/micronautguide/micronautguide /app/micronautguide
 ---&gt; 0d41749e3ceb
Step 9/9 : ENTRYPOINT ["/app/micronautguide"]
 ---&gt; Running in 31b4c6c21e68
Removing intermediate container 31b4c6c21e68
 ---&gt; 3ff1de337ef4
Successfully built 3ff1de337ef4
Successfully tagged micronautguide:latest


To run the docker container execute:
    $ docker run -p 8080:8080 micronautguide</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use docker to run the image with the app&#8217;s native-image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash"> docker run -p 8080:8080 micronautguide
06:58:26.977 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 27ms. Server Running: http://f8143044b1ee:8080</code></pre>
</div>
</div>


<h1 id="nextSteps">4 Next Steps</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-error-handling/edit/master/src/main/docs/guide/nextSteps.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Explore more features with <a href="http://guides.micronaut.io">Micronaut Guides</a>.</p>
</div>

</article>
</div>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115754405-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-115754405-1');
</script>
</body>
</html>
