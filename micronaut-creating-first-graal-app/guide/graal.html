<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>5 Adding Graal support null</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Creating your first Micronaut Graal application
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/gettingStarted.html"><strong>1</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/writingTheApp.html"><strong>2</strong><span>Writing the App</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/service.html"><strong>3</strong><span>Service</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/controller.html"><strong>4</strong><span>Controller</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/graal.html"><strong>5</strong><span>Adding Graal support</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/nextSteps.html"><strong>6</strong><span>Next steps</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/controller.html">&lt;&lt; <strong>4</strong><span>Controller</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/nextSteps.html"><strong>6</strong><span>Next steps</span> >></a></div>
                


                <div class="project">
                    <h1>5 Adding Graal support</h1>

                    <p><strong>Version:</strong> null</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#installGraal"><strong>5.1</strong><span>Installing Graal</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#creatingGraalImage"><strong>5.2</strong><span>Creating Graal native image</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="graal">5 Adding Graal support</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-creating-first-graal-app/edit/master/src/main/docs/guide/graal.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://www.graalvm.org">GraalVM</a> is a new universal virtual machine from Oracle that supports a polyglot runtime
 environment and the ability to compile Java applications down to native machine code.</p>
</div>
<div class="paragraph">
<p>Any Micronaut application can be run using the GraalVM JVM, however special support has been added to Micronaut to
 support running Micronaut applications using
 <a href="https://www.graalvm.org/docs/reference-manual/aot-compilation/">GraalVM&#8217;s <code>nativeimage</code> tool</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use of GraalVM&#8217;s <code>nativeimage</code> tool is only supported in Java or Kotlin projects. Groovy relies heavily on
reflection which is only partially supported by GraalVM.
</td>
</tr>
</table>
</div>


<h2 id="installGraal">5.1 Installing Graal</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-creating-first-graal-app/edit/master/src/main/docs/guide/graal/installGraal.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To start using GraalVM you should first install the GraalVM SDK via the
 <a href="https://www.graalvm.org/docs/getting-started/">Getting Started</a> instructions or using SDKman:</p>
</div>
<div class="listingblock">
<div class="title">Installing GraalVM 1.0.0-rc7 with SDKman</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ sdk install java 1.0.0-rc7-graal
$ sdk use java 1.0.0-rc7-graal</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the above commands install the <code>1.0.0-rc7</code> version, and may need to be altered depending on the current release
 available.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
As of this writing, GraalVM is currently only available for Linux and Mac OS X systems.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have installed the SDK you should make the <code>svm</code> dependency available via your local Maven cache. The easiest
 way to do this is via Maven&#8217;s <code>install</code> command:</p>
</div>
<div class="listingblock">
<div class="title">Installing the SVM Dependency Locally</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">$ mvn install:install-file -Dfile=${JAVA_HOME}/jre/lib/svm/builder/svm.jar \
                           -DgroupId=com.oracle.substratevm \
                           -DartifactId=svm \
                           -Dversion=GraalVM-1.0.0-rc7 \
                           -Dpackaging=jar</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t have Maven available you can install it using SDKMan: <code>sdk install maven</code>
</td>
</tr>
</table>
</div>


<h2 id="creatingGraalImage">5.2 Creating Graal native image</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-guides/micronaut-creating-first-graal-app/edit/master/src/main/docs/guide/graal/creatingGraalImage.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When we created the application we used the <code>graal-native-image</code> feature. This feature adds three important items:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <a href="https://github.com/micronaut-guides/micronaut-creating-first-graal-app/blob/master/complete/src/main/java/example/micronaut/MicronautSubstitutions.java">MicronautSubstitutions.java</a>
file needed to recompute Netty and Caffeine&#8217;s use of <code>Unsafe</code>.</p>
</li>
<li>
<p><code>svm</code> and <code>graal</code> dependencies in <code>build.gradle</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy" data-lang="groovy">    compileOnly "com.oracle.substratevm:svm:GraalVM-1.0.0-rc7"
    runtimeOnly "io.micronaut:graal"</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>build-native-image.sh</code> bash script which can be used as a template to construct the native image.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_creating_native_image">Creating native image</h4>
<div class="paragraph">
<p>To create the native image the only thing we need to do is execute the <code>build-native-image.sh</code> script. The script will
build the application fat-jar, generate the <code>reflect.json</code> file and build the native image.</p>
</div>
<div class="listingblock">
<div class="title">Building native image</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">complete $ ./build-native-image.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>A native image named <code>complete</code> will be generated. Once the native image is created we can start it:</p>
</div>
<div class="listingblock">
<div class="title">Executing the native image</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">complete $ ./complete
11:20:28.881 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 14ms. Server Running: http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see that the application starts in only 14ms.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sending_a_request">Sending a request</h4>
<div class="paragraph">
<p>You can run a few cURL requests to test the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash" data-lang="bash">complete $ time curl localhost:8080/conferences/random
{"name":"Oracle Code One"}
real    0m0.016s
user    0m0.005s
sys     0m0.004s

complete $ time curl localhost:8080/conferences/random
{"name":"GR8Conf EU"}
real    0m0.014s
user    0m0.005s
sys     0m0.004s</code></pre>
</div>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/controller.html">&lt;&lt; <strong>4</strong><span>Controller</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/nextSteps.html"><strong>6</strong><span>Next steps</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing. 
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
