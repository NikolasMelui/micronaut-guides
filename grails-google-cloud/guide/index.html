<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Deploy a Grails app to Google Cloud</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/guide.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />        
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>

        <link rel="stylesheet" type="text/css" href="../css/font-awesome.min.css" />        
        <link rel="stylesheet" type="text/css" href="../css/navbar.css" />
        <link rel="stylesheet" type="text/css" href="../css/stMenu.css" />      

    </head>

    <body class="body" onload="addJsClass();">

    <a href="https://github.com/grails/grails-core" target="_blank">
      <div id="fork-me">
        <p>Fork me on Github</p>
      </div>
    </a>
    <div id="st-container" class="st-container st-effect-9">
      <nav class="st-menu st-effect-9" id="menu-12">
        <h2 class="icon icon-lab">Socialize</h2>
        <ul>
          <li><a href="http://grails.org/mailing-lists.html" class="icon"><span class="fa fa-envelope"></span> Discuss on the Mailing List</a></li>
          <li><a href="http://slack-signup.grails.org" class="icon"><span class="fa fa-slack"></span> Discuss on Slack</a></li>
          <li><a href="https://twitter.com/grailsframework" class="icon"><span class="fa fa-twitter"></span> Grails on Twitter</a></li>
          <li><a href="http://grails.org/events.html" class="icon"><span class="fa fa-calendar"></span> Events and conferences</a></li>
          <li><a href="https://github.com/grails/grails-core" class="icon"><span class="fa fa-github"></span> Source code on GitHub</a></li>
          <li><a href="http://grails.org/contribute.html#reporting-issues" class="icon"><span class="fa fa-bug"></span> Report issues on Github</a></li>
          <li><a href="http://stackoverflow.com/questions/tagged/grails" class="icon"><span class="fa fa-stack-overflow"></span> Stack Overflow questions</a></li>
        </ul>
      </nav>
      <div class="st-pusher">
        <div class="st-content">
          <div class="st-content">
            <div class="grailsnavbar grailsnavbar-default">
              <div class="grailsnavbar-container">
                <div class="grailsnavbar-header">
                  <a class="grailsnavbar-brand" href="index.html"><i class="fa grails-icon"><img src="../img/grails-cupsonly-logo-white.svg"></i> Grails</a>
                </div>
                <a id="nav-icon" href="javascript:toggleNavIcon();">
                  <span></span>
                  <span></span>
                  <span></span>
                </a>
                <div class="grailsnavbar-collapse collapse">
                  <ul id="grailsnavbar-nav" class="grailsnavbar-nav grailsnavbar-right closemobile">
                    <li><a href="http://grails.org/learn.html">Learn</a></li>
                    <li><a href="http://guides.grails.org">Guides</a></li>
                    <li><a href="http://grails.org/documentation.html">Documentation</a></li>
                    <li><a href="http://grails.org/download.html">Download</a></li>
                    <li><a href="http://plugins.grails.org">Plugins</a></li>
                    <li><a href="http://grails.org/community.html">Community</a></li>
                    <li><a href="http://grails.org/support.html">Support</a></li>
                    <li><a data-effect="st-effect-9" class="st-trigger" href="#">Socialize</a></li>
                    <li><a href="http://grails.org/search.html"><i class="fa fa-search"></i></a></li>
                  </ul>
                </div>
              </div>
            </div>
            <!-- CONTENT -->
<table id="colset" border="0" cellpadding="0" cellspacing="0">
                                <tr>
                                    <td id="col1">
                                        <div id="main" class="corner-all">

                                            <div class="project">
                                                <h1>Deploy a Grails app to Google Cloud</h1>
                                                <p></p>
                                                <p>Learn how to deploy a Grails 3 application to Google App Engine Java Flexible Environment, integrate with Google Cloud Storage and Google Cloud SQL</p>
                                                <p><strong>Authors:</strong> Sergio del Amo, Mathew Moss</p>
                                                <p><strong>Grails Version:</strong> 3.3.0</p>

                                            </div>

                                            

<h1 id="gettingStarted">1 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this guide, you are going to deploy a Grails 3 application
to <a href="https://cloud.google.com/appengine/docs/flexible/">Google App Engine Flexible Environment</a>, upload
images to <a href="https://cloud.google.com/storage/">Google Cloud Storage</a>
and use a MySQL database provided by <a href="https://cloud.google.com/sql/">Cloud SQL</a>.</p>
</div>


<h2 id="requirements">1.1 What you will need</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/requirements.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.7 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
</ul>
</div>


<h2 id="howto">1.2 How to complete the guide</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/howto.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/grails-guides/grails-google-cloud/archive/master.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the <a href="https://git-scm.com/">Git</a> repository:<br>
<code>git clone <a href="https://github.com/grails-guides/grails-google-cloud.git" class="bare">https://github.com/grails-guides/grails-google-cloud.git</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Grails guides repositories contain two folders:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initial</code>  Initial project. Often a simple Grails app with additional some code to give you a head-start.</p>
</li>
<li>
<p><code>complete</code> A completed example. It is the result of working through the steps presented by the guide and applying those changes to the <code>initial</code> folder.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To complete the guide, go to the <code>initial</code> folder</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cd</code> into <code>grails-guides/grails-google-cloud/initial</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and follow the instructions in the next sections.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can go right to the <strong>completed example</strong> if you <code>cd</code> into <code>grails-guides/grails-google-cloud/complete</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Although you can go right to the completed example, in order to deploy the app
you would need to complete several configuration steps in Google Cloud:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="index.html#googleCloud">Section 3</a> Signup for Cloud SDK and install Cloud SDK.</p>
</li>
<li>
<p><a href="index.html#appEngine">Section 4</a> Initialize an App Engine application within the current Google Cloud project.</p>
</li>
<li>
<p><a href="index.html#cloudSQL">Section 5</a> Create a Mysql Database in an instance of Cloud SQL.</p>
</li>
<li>
<p><a href="index.html#cloudStorage">Section 6</a> Enable Cloud Datastore API for the project</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Moreover, You would need to modify your <code>application.yml</code> configuration to point to the correct
Cloud SQL database and Cloud Storage Bucket. Checkout the guide steps for more details.</p>
</div>


<h1 id="writingTheApp">2 Writing the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This guide uses paid services; you may need to enable Billing in Google Cloud to complete some steps in this guide.
</td>
</tr>
</table>
</div>


<h2 id="domainClass">2.1 Domain Class</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/domainClass.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We want to persist some test data in a Cloud SQL database.
We are going to use a Grails Domain Class to map Book instances to a MySQL table.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A domain class fulfills the M in the Model View Controller (MVC) pattern and represents a persistent entity that is
mapped onto an underlying database table. In Grails a domain is a class that lives in the grails-app/domain directory.</p>
</div>
</blockquote>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/demo/Book.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.compiler.GrailsCompileStatic</span>

<span class="annotation">@GrailsCompileStatic</span>
<span class="type">class</span> <span class="class">Book</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">String</span> featuredImageUrl
    <span class="predefined-type">String</span> fileName

    <span class="directive">static</span> constraints = {
        name <span class="key">unique</span>: <span class="predefined-constant">true</span>
        featuredImageUrl <span class="key">nullable</span>: <span class="predefined-constant">true</span>
        fileName <span class="key">nullable</span>: <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>


<h2 id="seedData">2.2 Seed Data</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/seedData.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When the application starts we are going to add some seed data. In particular, we persist a list of books.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/init/demo/BootStrap.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.compiler.GrailsCompileStatic</span>

<span class="annotation">@GrailsCompileStatic</span>
<span class="type">class</span> <span class="class">BootStrap</span> {

    <span class="keyword">def</span> init = { servletContext -&gt;
        <span class="predefined-type">Book</span>.saveAll(
            <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails 3: A Practical Guide to Application Development</span><span class="delimiter">'</span></span>),
            <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Falando de Grails</span><span class="delimiter">'</span></span>,),
            <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">The Definitive Guide to Grails 2</span><span class="delimiter">'</span></span>),
            <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails in Action</span><span class="delimiter">'</span></span>),
            <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails 2: A Quick-Start Guide</span><span class="delimiter">'</span></span>),
            <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Programming Grails</span><span class="delimiter">'</span></span>)
        )
    }
    <span class="keyword">def</span> destroy = {
    }
}</code></pre>
</div>
</div>


<h2 id="displayBooks">2.3 Display Books</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/displayBooks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As the home page of the application, we want to display the books persisted when the application started ( in <code>BootStrap.groovy</code>)</p>
</div>
<div class="paragraph">
<p>We map the home page to be resolved by <code>BookController</code>.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/UrlMappings.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">book</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have modified slightly the output of Grails static scaffolding command <code>generate-all</code>
to provide CRUD functionality for the domain class <code>Book</code>.</p>
</div>
<div class="paragraph">
<p>You can find the code: <code>BookController</code>, <code>BookGormService</code> and GSP views in <a href="#appendixA">the appendix</a>.</p>
</div>


<h1 id="googleCloud">3 Cloud SDK</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/googleCloud.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Signup for <a href="https://console.cloud.google.com">Google Cloud Platform</a> and create a new project:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/createproject_1.png" alt="createproject 1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/createproject_2.png" alt="createproject 2">
</div>
</div>
<div class="paragraph">
<p>Install <a href="https://cloud.google.com/sdk/downloads">Cloud SDK</a> for your operating system.</p>
</div>
<div class="paragraph">
<p>After you have installed the SDK, run the init command in your terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gcloud init</code></pre>
</div>
</div>
<div class="paragraph">
<p>It will prompt you to select the Google account and the project which you want to use.</p>
</div>


<h1 id="appEngine">4 Google App Engine</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/appEngine.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to deploy the Grails application developed in this guide to the <a href="https://cloud.google.com/appengine/docs/flexible/">Google App Engine Flexible Environment</a></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>App Engine allows developers to focus on doing what they do best: writing code. Based on Google Compute Engine,
the App Engine flexible environment automatically scales your app up and down while balancing the load. Microservices,
authorization, SQL and NoSQL databases, traffic splitting, logging, versioning, security scanning, and content delivery networks are all supported natively.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Run the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gcloud app create</code></pre>
</div>
</div>
<div class="paragraph">
<p>to initialize an App Engine application within the current Google Cloud project.</p>
</div>


<h2 id="gapGradlePlugin">4.1 Google App Engine Gradle Plugin</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/gapGradlePlugin.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To deploy to App Engine, we are going to use the <a href="https://github.com/GoogleCloudPlatform/app-gradle-plugin">Google App Engine Gradle Plugin</a>.</p>
</div>
<div class="paragraph">
<p>We need to modify <code>build.gradle</code></p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    repositories {
        mavenLocal()
        maven { url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.grails.org/grails/core</span><span class="delimiter">&quot;</span></span> }
    }
    dependencies {
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails:grails-gradle-plugin:</span><span class="inline"><span class="inline-delimiter">$</span>grailsVersion</span><span class="delimiter">&quot;</span></span>
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">com.bertramlabs.plugins:asset-pipeline-gradle:2.14.2</span><span class="delimiter">&quot;</span></span>
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:hibernate5:</span><span class="inline"><span class="inline-delimiter">${</span>gormVersion-<span class="string"><span class="delimiter">&quot;</span><span class="content">.RELEASE</span><span class="delimiter">&quot;</span></span><span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        classpath <span class="string"><span class="delimiter">'</span><span class="content">com.google.cloud.tools:appengine-gradle-plugin:1.1.1</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add the plugin as a buildscript dependency.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eclipse</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">idea</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">war</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.grails-web</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.grails-gsp</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">asset-pipeline</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">codenarc</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">com.google.cloud.tools.appengine</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Apply the plugin.</td>
</tr>
</table>
</div>


<h2 id="applicationDeploymentConfiguration">4.2 Application Deployment Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/applicationDeploymentConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To deploy to Google App Engine, we need to add the file <code>src/main/appengine/app.yaml</code></p>
</div>
<div class="paragraph">
<p>It describes the application&#8217;s deployment configuration:</p>
</div>
<div class="listingblock">
<div class="title">src/main/appengine/app.yaml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">runtime</span>: java
<span class="key">env</span>: flex

<span class="key">runtime_config</span>:
    <span class="key">jdk</span>: openjdk8
    <span class="key">server</span>: jetty9

<span class="key">health_check</span>:
    <span class="key">enable_health_check</span>: False

<span class="key">resources</span>:
    <span class="key">cpu</span>: <span class="integer">1</span>
    <span class="key">memory_gb</span>: <span class="float">2.3</span>

<span class="key">manual_scaling</span>:
  <span class="key">instances</span>: <span class="integer">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>app.yaml</code> specifies the runtime used by the app, and sets <code>env: flex</code>,
specifying that the app uses the <a href="https://cloud.google.com/appengine/docs/flexible/">flexible environment</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The minimal <code>app.yaml</code> application configuration file shown above is sufficient for a simple Grails application.
Depending on the size, complexity, and features that your application uses, you may need to change and extend this basic
configuration file. For more information on what can be configured via <code>app.yaml</code>, please see the
<a href="https://cloud.google.com/appengine/docs/flexible/java/configuring-your-app-with-app-yaml">Configuring Your App with app.yaml</a>
guide.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on how the Java runtime works, see <a href="https://cloud.google.com/appengine/docs/flexible/java/dev-jetty9">Java 8 / Jetty 9.3 Runtime</a>.</p>
</div>


<h2 id="springBootJetty">4.3 SpringBoot Jetty</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/springBootJetty.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As shown in the previous app engine configuration file, we are using Jetty.</p>
</div>
<div class="paragraph">
<p>Following SpringBoot&#8217;s documentation, we need to do the following changes to
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto-embedded-servlet-containers.html">deploy to Jetty instead of Tomcat</a></p>
</div>
<div class="paragraph">
<p>Replace tomcat:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">provided <span class="string"><span class="delimiter">'</span><span class="content">org.springframework.boot:spring-boot-starter-tomcat</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>with jetty:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">provided <span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.boot:spring-boot-starter-jetty</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We need to exclude the tomcat-juli dependency as well. Add:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">configurations {
  compile.exclude <span class="key">module</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">tomcat-juli</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>


<h1 id="cloudSQL">5 Cloud SQL</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/cloudSQL.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Grails application developed during this guide is going to use a MySQL database created with <a href="https://cloud.google.com/sql/">Cloud SQL</a></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Cloud SQL is a fully-managed database service that makes it easy to set up, maintain, manage, and administer your relational PostgreSQL BETA and MySQL databases in the cloud. Cloud SQL offers high performance, scalability, and convenience. Hosted on Google Cloud Platform, Cloud SQL provides a database infrastructure for applications running anywhere.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>If you have not enabled Cloud SQL API already, Go to your project dashboard and enable it.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/enable-cloud-sql-api.png" alt="enable cloud sql api">
</div>
</div>
<div class="paragraph">
<p>We are going to <a href="https://console.cloud.google.com/sql">create a new instance of Cloud SQL</a>
associated to the same project we created before.</p>
</div>
<div class="paragraph">
<p>Go to the Cloud SQL section of the console:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/select-sql-in-the-left-navigation.png" alt="select sql in the left navigation">
</div>
</div>
<div class="paragraph">
<p>Next screenshots illustrate the process:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql_3.png" alt="cloudsql 3">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql_4.png" alt="cloudsql 4">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql_5.png" alt="cloudsql 5">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql_6.png" alt="cloudsql 6">
</div>
</div>
<div class="paragraph">
<p>Once the instance is ready, we create a database:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql_8.png" alt="cloudsql 8">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql_9.png" alt="cloudsql 9">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql_10.png" alt="cloudsql 10">
</div>
</div>


<h2 id="dataSourceGoogleCloudSQL">5.1 Datasource using Cloud SQL</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/dataSourceGoogleCloudSQL.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As described in <a href="https://cloud.google.com/appengine/docs/flexible/java/using-cloud-sql">Using Cloud SQL with a Flexible Environment</a> documentation, we need to
add several runtime dependencies and configure the production url to use the Cloud SQL MySQL database we created before.</p>
</div>
<div class="paragraph">
<p>Replace the H2 dependency with several MySQL dependencies.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">runtime <span class="string"><span class="delimiter">'</span><span class="content">mysql:mysql-connector-java:6.0.5</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
runtime <span class="string"><span class="delimiter">'</span><span class="content">com.google.cloud.sql:mysql-socket-factory-connector-j-6:1.0.2</span><span class="delimiter">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>JDBC library</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cloud SQL MySQL Socket Factory</td>
</tr>
</table>
</div>
<div class="listingblock unjust">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">dataSource</span>:
    <span class="key">pooled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">jmxExport</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">dialect</span>: <span class="string"><span class="content">org.hibernate.dialect.MySQL5InnoDBDialect</span></span>
<span class="key">environments</span>:
    <span class="key">development</span>:
        <span class="key">dataSource</span>:
            <span class="key">dbCreate</span>: <span class="string"><span class="content">create-drop</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:mysql://127.0.0.1:8889/grailsgooglecloud_dev?useTimezone=true&amp;serverTimezone=GMT</span></span>
            <span class="key">driverClassName</span>: <span class="string"><span class="content">com.mysql.jdbc.Driver</span></span>
            <span class="key">username</span>: <span class="string"><span class="content">root</span></span>
            <span class="key">password</span>: <span class="string"><span class="content">root</span></span>
    <span class="key">test</span>:
        <span class="key">dataSource</span>:
            <span class="key">dbCreate</span>: <span class="string"><span class="content">update</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:mysql://127.0.0.1:8889/grailsgooglecloud_test?useTimezone=true&amp;serverTimezone=GMT</span></span>
            <span class="key">driverClassName</span>: <span class="string"><span class="content">com.mysql.jdbc.Driver</span></span>
            <span class="key">username</span>: <span class="string"><span class="content">root</span></span>
            <span class="key">password</span>: <span class="string"><span class="content">root</span></span>
    <span class="key">production</span>:
        <span class="key">dataSource</span>:
            <span class="key">driverClassName</span>: <span class="string"><span class="content">com.mysql.jdbc.Driver</span></span>
            <span class="key">dbCreate</span>: <span class="string"><span class="content">create-drop</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:mysql://google/grailstestdb?cloudSqlInstance=test-grails-guide:europe-west1:grailstest-mysql&amp;socketFactory=com.google.cloud.sql.mysql.SocketFactory&amp;user=root&amp;password=foo123&amp;useSSL=false </span></span><i class="conum" data-value="1"></i><b>(1)</b>
            <span class="key">properties</span>:
                <span class="key">jmxEnabled</span>: <span class="string"><span class="content">true</span></span>
                <span class="key">initialSize</span>: <span class="string"><span class="content">5</span></span>
                <span class="key">maxActive</span>: <span class="string"><span class="content">50</span></span>
                <span class="key">minIdle</span>: <span class="string"><span class="content">5</span></span>
                <span class="key">maxIdle</span>: <span class="string"><span class="content">25</span></span>
                <span class="key">maxWait</span>: <span class="string"><span class="content">10000</span></span>
                <span class="key">maxAge</span>: <span class="string"><span class="content">600000</span></span>
                <span class="key">timeBetweenEvictionRunsMillis</span>: <span class="string"><span class="content">5000</span></span>
                <span class="key">minEvictableIdleTimeMillis</span>: <span class="string"><span class="content">60000</span></span>
                <span class="key">validationQuery</span>: <span class="string"><span class="content">SELECT 1</span></span>
                <span class="key">validationQueryTimeout</span>: <span class="string"><span class="content">3</span></span>
                <span class="key">validationInterval</span>: <span class="string"><span class="content">15000</span></span>
                <span class="key">testOnBorrow</span>: <span class="string"><span class="content">true</span></span>
                <span class="key">testWhileIdle</span>: <span class="string"><span class="content">true</span></span>
                <span class="key">testOnReturn</span>: <span class="string"><span class="content">false</span></span>
                <span class="key">jdbcInterceptors</span>: <span class="string"><span class="content">ConnectionState</span></span>
                <span class="key">defaultTransactionIsolation</span>: <span class="string"><span class="content">2</span></span> <span class="comment"># TRANSACTION_READ_COMMITTED</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Custom url string</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The production datasource url uses a custom url which is built with several components:</p>
</div>
<div class="paragraph">
<p><code>jdbc:mysql://google/{DATABASE_NAME}?cloudSqlInstance={INSTANCE_NAME}&amp;socketFactory=com.google.cloud.sql.mysql.SocketFactory&amp;user={USERNAME}&amp;password={PASSWORD}&amp;useSSL=false</code></p>
</div>
<div class="paragraph">
<p><strong>DATABASE_NAME</strong></p>
</div>
<div class="paragraph">
<p>Use the database name you used when you created the database.</p>
</div>
<div class="paragraph">
<p><strong>INSTANCE_NAME</strong></p>
</div>
<div class="paragraph">
<p>You can find your instance name in your Cloud SQL instance details:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/instancename.png" alt="instancename">
</div>
</div>
<div class="paragraph">
<p><strong>USERNAME / PASSWORD</strong></p>
</div>
<div class="paragraph">
<p>For this guide, we are using username: <code>root</code> and the password we entered when we created the SQL instance; see previous sections.</p>
</div>


<h1 id="cloudStorage">6 Cloud Storage</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/cloudStorage.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We allow our users to upload a book cover image. To store the images in the Cloud, we use <a href="https://cloud.google.com/storage/">Google Cloud Storage</a></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Google Cloud Storage is unified object storage for developers and enterprises, from live data serving to data analytics/ML to data archiving.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><a href="https://console.cloud.google.com/flows/enableapi?apiid=storage_api,logging,sqladmin.googleapis.com&amp;redirect=https://console.cloud.google.com&amp;_ga=1.20629880.1963584502.1488379440">Enable Cloud Datastore API</a> for the project, if you have not enabled it already.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/enable-cloud-storage.png" alt="enable cloud storage">
</div>
</div>
<div class="paragraph">
<p>You can create a Cloud Storage Bucket as illustrated in the image below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/create-bucket.png" alt="create bucket">
</div>
</div>
<div class="paragraph">
<p>You will need to configure in <code>application.yml</code> your Cloud Storage Bucket and project id:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">---
<span class="key">googlecloud</span>:
    <span class="key">projectid</span>: test-grails-guide
    <span class="key">cloudStorage</span>:
        <span class="key">bucket</span>: test-grails-guide-bucket</code></pre>
</div>
</div>
<div class="paragraph">
<p>These configuration parameters are used by the services described below.</p>
</div>
<div class="paragraph">
<p>We use a Grails Command Object and two controller actions to handle the image upload:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/FeaturedImageCommand.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.compiler.GrailsCompileStatic</span>
<span class="keyword">import</span> <span class="include">grails.validation.Validateable</span>
<span class="keyword">import</span> <span class="include">org.springframework.web.multipart.MultipartFile</span>

<span class="annotation">@GrailsCompileStatic</span>
<span class="type">class</span> <span class="class">FeaturedImageCommand</span> <span class="directive">implements</span> Validateable {
    MultipartFile featuredImageFile
    <span class="predefined-type">Long</span> id
    <span class="predefined-type">Long</span> version

    <span class="directive">static</span> constraints = {
        id <span class="key">nullable</span>: <span class="predefined-constant">false</span>
        version <span class="key">nullable</span>: <span class="predefined-constant">false</span>
        featuredImageFile  <span class="key">validator</span>: { MultipartFile val, FeaturedImageCommand obj -&gt;
            <span class="keyword">if</span> ( val == <span class="predefined-constant">null</span> ) {
                <span class="keyword">return</span> <span class="predefined-constant">false</span>
            }
            <span class="keyword">if</span> ( val.empty ) {
                <span class="keyword">return</span> <span class="predefined-constant">false</span>
            }

            [<span class="string"><span class="delimiter">'</span><span class="content">jpeg</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">jpg</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">png</span><span class="delimiter">'</span></span>].any { <span class="predefined-type">String</span> extension -&gt;
                 val.originalFilename?.toLowerCase()?.endsWith(extension)
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/BookController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
<span class="keyword">def</span> <span class="function">editFeaturedImage</span>(<span class="predefined-type">Book</span> book) {
    respond book
}
<span class="annotation">@CompileDynamic</span>
<span class="keyword">def</span> <span class="function">uploadFeaturedImage</span>(FeaturedImageCommand cmd) {

    <span class="keyword">if</span> (cmd.hasErrors()) {
        respond(cmd.errors, <span class="key">model</span>: [<span class="key">book</span>: cmd], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
        <span class="keyword">return</span>
    }

    <span class="keyword">def</span> book = uploadBookFeaturedImageService.uploadFeaturedImage(cmd)
    <span class="keyword">if</span> (book == <span class="predefined-constant">null</span>) {
        notFound()
        <span class="keyword">return</span>
    }

    <span class="keyword">if</span> (book.hasErrors()) {
        respond(book.errors, <span class="key">model</span>: [<span class="key">book</span>: book], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
        <span class="keyword">return</span>
    }

    request.withFormat {
        form multipartForm {
            flash.message = message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.updated.message</span><span class="delimiter">'</span></span>, <span class="key">args</span>: [message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">book.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book</span><span class="delimiter">'</span></span>), book.id])
            redirect book
        }
        <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span> { respond book, [<span class="key">status</span>: OK] }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our business logic is handled in <code>UploadBookFeaturedImageService.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/services/demo/UploadBookFeaturedImageService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">org.grails.plugins.googlecloud.storage.GoogleCloudStorageService</span>
<span class="keyword">import</span> <span class="include">org.joda.time.DateTime</span>
<span class="keyword">import</span> <span class="include">org.joda.time.DateTimeZone</span>
<span class="keyword">import</span> <span class="include">org.joda.time.format.DateTimeFormat</span>
<span class="keyword">import</span> <span class="include">org.joda.time.format.DateTimeFormatter</span>
<span class="keyword">import</span> <span class="include">groovy.util.logging.Slf4j</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@Slf4j</span>
<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">UploadBookFeaturedImageService</span> {

    BookGormService bookGormService

    GoogleCloudStorageService googleCloudStorageService

    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">String</span> fileSuffix() {
        DateTimeFormatter dtf = DateTimeFormat.forPattern(<span class="string"><span class="delimiter">'</span><span class="content">-YYYY-MM-dd-HHmmssSSS</span><span class="delimiter">'</span></span>)
        DateTime dt = DateTime.now(DateTimeZone.UTC)
        dt.toString(dtf)
    }

    <span class="predefined-type">Book</span> uploadFeaturedImage(FeaturedImageCommand cmd) {
        <span class="predefined-type">String</span> fileName = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>cmd.featuredImageFile.originalFilename<span class="inline-delimiter">}</span></span><span class="inline"><span class="inline-delimiter">${</span>fileSuffix()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>

        log.info <span class="string"><span class="delimiter">&quot;</span><span class="content">cloud storage file name </span><span class="inline"><span class="inline-delimiter">$</span>fileName</span><span class="delimiter">&quot;</span></span>

        <span class="predefined-type">String</span> fileUrl = googleCloudStorageService.storeMultipartFile(fileName, cmd.featuredImageFile)

        log.info <span class="string"><span class="delimiter">&quot;</span><span class="content">cloud storage media url </span><span class="inline"><span class="inline-delimiter">$</span>fileUrl</span><span class="delimiter">&quot;</span></span>

        <span class="keyword">def</span> book = bookGormService.updateFeaturedImageUrl(cmd.id, cmd.version, fileName, fileUrl)
        <span class="keyword">if</span> ( !book || book.hasErrors() ) {
            googleCloudStorageService.deleteFile(fileName)
        }
        book
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code which interacts with Cloud Storage is encapsulated in a service:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/services/org/grails/plugins/googlecloud/storage/GoogleCloudStorageService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.grails.plugins.googlecloud.storage

<span class="keyword">import</span> <span class="include">com.google.cloud.storage.Acl</span>
<span class="keyword">import</span> <span class="include">com.google.cloud.storage.BlobId</span>
<span class="keyword">import</span> <span class="include">com.google.cloud.storage.BlobInfo</span>
<span class="keyword">import</span> <span class="include">com.google.cloud.storage.Storage</span>
<span class="keyword">import</span> <span class="include">com.google.cloud.storage.StorageOptions</span>
<span class="keyword">import</span> <span class="include">grails.config.Config</span>
<span class="keyword">import</span> <span class="include">grails.core.support.GrailsConfigurationAware</span>
<span class="keyword">import</span> <span class="include">org.springframework.web.multipart.MultipartFile</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">'</span><span class="content">GrailsStatelessService</span><span class="delimiter">'</span></span>)
<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">GoogleCloudStorageService</span> <span class="directive">implements</span> GrailsConfigurationAware {

    Storage storage = StorageOptions.defaultInstance.service

    <span class="comment">// Google Cloud Platform project ID.</span>
    <span class="predefined-type">String</span> projectId

    <span class="comment">// Cloud Storage Bucket</span>
    <span class="predefined-type">String</span> bucket

    <span class="annotation">@Override</span>
    <span class="type">void</span> setConfiguration(Config co) {
        projectId = co.getRequiredProperty(<span class="string"><span class="delimiter">'</span><span class="content">googlecloud.projectid</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
        bucket = co.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">googlecloud.cloudStorage.bucket</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>, projectId)
    }

    <span class="predefined-type">String</span> storeMultipartFile(<span class="predefined-type">String</span> fileName, MultipartFile multipartFile) {
        storeInputStream(fileName, multipartFile.inputStream)
    }

    <span class="predefined-type">String</span> storeInputStream(<span class="predefined-type">String</span> fileName, <span class="predefined-type">InputStream</span> inputStream) {
        BlobInfo blobInfo = storage.create(readableBlobInfo(bucket, fileName), inputStream)
        blobInfo.mediaLink
    }

    <span class="predefined-type">String</span> storeBytes(<span class="predefined-type">String</span> fileName, <span class="type">byte</span><span class="type">[]</span> bytes) {
        BlobInfo blobInfo = storage.create(readableBlobInfo(bucket, fileName), bytes)
        blobInfo.mediaLink
    }

    <span class="directive">private</span> <span class="directive">static</span> BlobInfo readableBlobInfo(<span class="predefined-type">String</span> bucket, <span class="predefined-type">String</span> fileName) {
        BlobInfo.newBuilder(bucket, fileName)
                <span class="comment">// Modify access list to allow all users with link to read file</span>
                .setAcl([<span class="predefined-type">Acl</span>.of(<span class="predefined-type">Acl</span>.User.ofAllUsers(), <span class="predefined-type">Acl</span>.Role.READER)])
                .build()
    }

    <span class="type">boolean</span> deleteFile(<span class="predefined-type">String</span> fileName) {
        BlobId blobId = BlobId.of(bucket, fileName)
        storage.delete(blobId)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the upload of an image to Google Cloud is successful, we save the reference to the media url in our domain class.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/services/demo/BookGormService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">'</span><span class="content">LineLength</span><span class="delimiter">'</span></span>)
<span class="predefined-type">Book</span> updateFeaturedImageUrl(<span class="predefined-type">Long</span> id, <span class="predefined-type">Long</span> version, <span class="predefined-type">String</span> fileName, <span class="predefined-type">String</span> featuredImageUrl, <span class="type">boolean</span> flush = <span class="predefined-constant">false</span>) {
    <span class="predefined-type">Book</span> book = <span class="predefined-type">Book</span>.get(id)
    <span class="keyword">if</span> ( !book ) {
        <span class="keyword">return</span> <span class="predefined-constant">null</span>
    }
    book.version = version
    book.fileName = fileName
    book.featuredImageUrl = featuredImageUrl
    book.save(<span class="key">flush</span>: flush)
    book
}</code></pre>
</div>
</div>


<h1 id="deployingTheApp">7 Deploying the App</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/deployingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To deploy the app to Google App Engine run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./gradlew appengineDeploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>Initial deployment may take a while. When finished, you will be able to access your app:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/welcometograils.png" alt="Welcome to Grails">
</div>
</div>
<div class="paragraph">
<p>If you go to the <a href="https://console.cloud.google.com/appengine/versions">Versions</a> section in the App Engine administration panel, you will see the deployed app.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/versions.png" alt="versions">
</div>
</div>


<h1 id="logging">8 Logging</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/logging.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For the version which you would like to inspect, select <em>Logs</em> in the diagnose dropdown:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/logs.png" alt="logs">
</div>
</div>
<div class="paragraph">
<p><strong>Application log messages written to stdout and stderr are automatically collected and can be viewed in the Logs Viewer.</strong></p>
</div>
<div class="paragraph">
<p>We are going to create a controller and log with level INFO and verify the log statement is visible in the Log Viewer.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/LegalController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>
<span class="keyword">import</span> <span class="include">groovy.util.logging.Slf4j</span>

<span class="annotation">@CompileStatic</span>
<span class="annotation">@Slf4j</span>
<span class="type">class</span> <span class="class">LegalController</span> {
    <span class="keyword">def</span> <span class="function">index</span>() {
        log.info <span class="string"><span class="delimiter">'</span><span class="content">inside legal controller</span><span class="delimiter">'</span></span>
        render <span class="string"><span class="delimiter">'</span><span class="content">Legal Terms</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We configure logback:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/logback.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.util.BuildSettings</span>
<span class="keyword">import</span> <span class="include">grails.util.Environment</span>
<span class="keyword">import</span> <span class="include">org.springframework.boot.logging.logback.ColorConverter</span>
<span class="keyword">import</span> <span class="include">org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter</span>

<span class="keyword">import</span> <span class="include">java.nio.charset.Charset</span>

conversionRule <span class="string"><span class="delimiter">'</span><span class="content">clr</span><span class="delimiter">'</span></span>, ColorConverter
conversionRule <span class="string"><span class="delimiter">'</span><span class="content">wex</span><span class="delimiter">'</span></span>, WhitespaceThrowableProxyConverter

<span class="comment">// See http://logback.qos.ch/manual/groovy.html for details on configuration</span>
appender(<span class="string"><span class="delimiter">'</span><span class="content">STDOUT</span><span class="delimiter">'</span></span>, ConsoleAppender) {
    encoder(PatternLayoutEncoder) {
        charset = <span class="predefined-type">Charset</span>.forName(<span class="string"><span class="delimiter">'</span><span class="content">UTF-8</span><span class="delimiter">'</span></span>)

        pattern =
                <span class="string"><span class="delimiter">'</span><span class="content">%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} </span><span class="delimiter">'</span></span> + <span class="comment">// Date</span>
                        <span class="string"><span class="delimiter">'</span><span class="content">%clr(%5p) </span><span class="delimiter">'</span></span> + <span class="comment">// Log level</span>
                        <span class="string"><span class="delimiter">'</span><span class="content">%clr(---){faint} %clr([%15.15t]){faint} </span><span class="delimiter">'</span></span> + <span class="comment">// Thread</span>
                        <span class="string"><span class="delimiter">'</span><span class="content">%clr(%-40.40logger{39}){cyan} %clr(:){faint} </span><span class="delimiter">'</span></span> + <span class="comment">// Logger</span>
                        <span class="string"><span class="delimiter">'</span><span class="content">%m%n%wex</span><span class="delimiter">'</span></span> <span class="comment">// Message</span>
    }
}

<span class="keyword">def</span> targetDir = BuildSettings.TARGET_DIR
<span class="keyword">if</span> (Environment.isDevelopmentMode() &amp;&amp; targetDir != <span class="predefined-constant">null</span>) {
    appender(<span class="string"><span class="delimiter">&quot;</span><span class="content">FULL_STACKTRACE</span><span class="delimiter">&quot;</span></span>, FileAppender) {
        file = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>targetDir<span class="inline-delimiter">}</span></span><span class="content">/stacktrace.log</span><span class="delimiter">&quot;</span></span>
        append = <span class="predefined-constant">true</span>
        encoder(PatternLayoutEncoder) {
            pattern = <span class="string"><span class="delimiter">&quot;</span><span class="content">%level %logger - %msg%n</span><span class="delimiter">&quot;</span></span>
        }
    }
    logger(<span class="string"><span class="delimiter">&quot;</span><span class="content">StackTrace</span><span class="delimiter">&quot;</span></span>, ERROR, [<span class="string"><span class="delimiter">'</span><span class="content">FULL_STACKTRACE</span><span class="delimiter">'</span></span>], <span class="predefined-constant">false</span>)
}
root(ERROR, [<span class="string"><span class="delimiter">'</span><span class="content">STDOUT</span><span class="delimiter">'</span></span>])
logger <span class="string"><span class="delimiter">'</span><span class="content">demo</span><span class="delimiter">'</span></span>, INFO, [<span class="string"><span class="delimiter">'</span><span class="content">STDOUT</span><span class="delimiter">'</span></span>], <span class="predefined-constant">false</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Log INFO level statements of classes under package <code>demo</code> to <code>stdout</code> with additivity <code>false</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you redeploy the app to App Engine and access the <code>/legal</code> end point, you will see the logging statements in Log Viewer.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/logstatement.png" alt="logstatement">
</div>
</div>
<div class="paragraph">
<p>Check <a href="https://cloud.google.com/appengine/docs/flexible/java/writing-application-logs">Writing Application Logs</a> documentation to
read more about logs in the Flexible Environment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Write your application logs using stdout for output and stderr for errors. Note that this does not provide log levels
that you can use for filtering in the Logs Viewer; however, the Logs Viewer does provide other filtering, such as text, timestamp, etc.
</td>
</tr>
</table>
</div>


<h1 id="learnMore">9 Learn More</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/learnMore.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you want to learn more about Google Cloud and Grails integration, checkout a more complete sample app.</p>
</div>
<div class="paragraph">
<p>The <a href="https://grails-samples.github.io/google-bookshelf/">Google Cloud Bookshelf with Grails</a>
application shows how to use a variety of Google Cloud Platform products, including some of the services
described in this guides and other services such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Google <a href="https://cloud.google.com/vision/">Cloud Vision API</a></p>
</li>
<li>
<p>Google <a href="https://cloud.google.com/translate">Cloud Translation API</a></p>
</li>
<li>
<p>Authentication using <a href="https://developers.google.com/identity/">Google Identity Platform</a></p>
</li>
</ul>
</div>


<h1 id="helpWithGrails">10 Help With Grails</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/helpWithGrails.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<h3 style="color: #333;">OCI sponsored the creation of this Guide. OCI offers several <a href="https://objectcomputing.com/products/grails/consulting-support/">Grails services</a>:</h3>

<img src="../img/oci-grails-services.svg"/>

<h3>Free consultation </h3>

<!-- This is the code that is needed to run the form -->

<!--Copy and paste into the document's head or body.-->

<script type="text/javascript">

    /** This section is only needed once per page if manually copying **/
    if (typeof MauticSDKLoaded == 'undefined') {
        var MauticSDKLoaded = true;
        var head            = document.getElementsByTagName('head')[0];
        var script          = document.createElement('script');
        script.type         = 'text/javascript';
        script.src          = 'https://mautic.objectcomputing.com/media/js/mautic-form.js';
        script.onload       = function() {
            MauticSDK.onLoad();
        };
        head.appendChild(script);
        var MauticDomain = 'https://mautic.objectcomputing.com';
        var MauticLang   = {
            'submittingMessage': "Please wait..."
        }
    }
</script>

<!--Copy and paste into the document's body.-->

<style type="text/css" scoped>
    .mauticform_wrapper { max-width: 600px; margin: 10px auto; }
    .mauticform-innerform {}
    .mauticform-post-success {}
    .mauticform-name { font-weight: bold; font-size: 1.5em; margin-bottom: 3px; }
    .mauticform-description { margin-top: 2px; margin-bottom: 10px; }
    .mauticform-error { margin-bottom: 10px; color: red; }
    .mauticform-message { margin-bottom: 10px;color: green; }
    .mauticform-row { display: block; margin-bottom: 20px; }
    .mauticform-label { font-size: 1.1em; display: block; font-weight: bold; margin-bottom: 5px; }
    .mauticform-row.mauticform-required .mauticform-label:after { color: #e32; content: " *"; display: inline; }
    .mauticform-helpmessage { display: block; font-size: 0.9em; margin-bottom: 3px; }
    .mauticform-errormsg { display: block; color: red; margin-top: 2px; }
    .mauticform-selectbox, .mauticform-input, .mauticform-textarea { width: 100%; padding: 0.5em 0.5em; border: 1px solid #CCC; background: #fff; box-shadow: 0px 0px 0px #fff inset; border-radius: 4px; box-sizing: border-box; }
    .mauticform-checkboxgrp-row {}
    .mauticform-checkboxgrp-label { font-weight: normal; }
    .mauticform-checkboxgrp-checkbox {}
    .mauticform-radiogrp-row {}
    .mauticform-radiogrp-label { font-weight: normal; }
    .mauticform-radiogrp-radio {}
    .mauticform-button-wrapper .mauticform-button.btn-default, .mauticform-pagebreak-wrapper .mauticform-pagebreak.btn-default { font-size: 14px; color: #fff;background-color: #feb672 ;border-color: #dddddd; padding: 15px 30px;}
    .mauticform-button-wrapper .mauticform-button, .mauticform-pagebreak-wrapper .mauticform-pagebreak { display: inline-block;margin-bottom: 0;font-weight: 600;text-align: center;vertical-align: middle;cursor: pointer;background-image: none;border: 1px solid transparent;white-space: nowrap;padding: 6px 12px;font-size: 13px;line-height: 1.3856;border-radius: none;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}
    .mauticform-button-wrapper .mauticform-button.btn-default[disabled], .mauticform-pagebreak-wrapper .mauticform-pagebreak.btn-default[disabled] { background-color:#feb672; border-color: #dddddd; opacity: 0.75; cursor: not-allowed; font-size: 14px; color: #fff; padding: 15px 30px;}
    .mauticform-pagebreak-wrapper .mauticform-button-wrapper {  display: inline; }
</style>
<div id="mauticform_wrapper_grailsorgconsultationform" class="mauticform_wrapper">
    <form autocomplete="false" role="form" method="post" action="https://mautic.objectcomputing.com/form/submit?formId=3" id="mauticform_grailsorgconsultationform" data-mautic-form="grailsorgconsultationform">

        <div class="mauticform-innerform">

          <div class="mauticform-page-wrapper mauticform-page-1" data-mautic-form-page="1">

            <div id="mauticform_grailsorgconsultationform_first_name"  data-validate="first_name" data-validation-type="text" class="mauticform-row mauticform-text mauticform-field-1 mauticform-required col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_first_name" name="mauticform[first_name]" value="" placeholder="First Name *" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_last_name"  data-validate="last_name" data-validation-type="text" class="mauticform-row mauticform-text mauticform-field-2 mauticform-required col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_last_name" name="mauticform[last_name]" value="" placeholder="Last Name *" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_email"  data-validate="email" data-validation-type="email" class="mauticform-row mauticform-email mauticform-field-3 mauticform-required col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_email" name="mauticform[email]" value="" placeholder="Email *" class="mauticform-input" type="email" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_phone"  class="mauticform-row mauticform-tel mauticform-field-4 col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_phone" name="mauticform[phone]" value="" placeholder="Phone" class="mauticform-input" type="tel" />
                <span class="mauticform-errormsg" style="display: none;"></span>
            </div>

            <div id="mauticform_grailsorgconsultationform_company"  class="mauticform-row mauticform-text mauticform-field-5 col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_company" name="mauticform[company]" value="" placeholder="Company" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;"></span>
            </div>

            <div id="mauticform_grailsorgconsultationform_submit"  class="mauticform-row mauticform-button-wrapper mauticform-field-6" style="">
                <button type="submit" name="mauticform[submit]" id="mauticform_input_grailsorgconsultationform_submit" name="mauticform[submit]" value="" class="mauticform-button btn btn-default" value="1" style="border: none; margin-left: 14px;">SUBMIT</button>
            </div>
            </div>
        </div>

        <input type="hidden" name="mauticform[formId]" id="mauticform_grailsorgconsultationform_id" value="3"/>
        <input type="hidden" name="mauticform[return]" id="mauticform_grailsorgconsultationform_return" value=""/>
        <input type="hidden" name="mauticform[formName]" id="mauticform_grailsorgconsultationform_name" value="grailsorgconsultationform"/>
</form>
</div>

<!--The code below is the message that appears when someone hits submit. Feel free to style this how you see fit for Grails.org. All CSS is handled in the above code.-->

<div class="mauticform-error" id="mauticform_grailsorgconsultationform_error"></div>
<div class="mauticform-message" id="mauticform_grailsorgconsultationform_message"></div>

<h3 style="color: #333;">The <a href="https://objectcomputing.com/products/grails/consulting-support/">OCI Grails Team</a>
includes Grails co-founders, <b>Jeff Scott Brown and Graeme Rocher</b>.
Check our <a href="https://objectcomputing.com/training/catalog/grails/">Grails courses</a> and learn from the engineers who developed,
matured and maintain Grails.</h3>

<img src="../img/ocigrailsteam.png" style="max-width: 748px; width: 100%;" alt="Grails OCI Team">


<h1 id="appendixA">11 Appendix A - Scaffolding</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/appendixA.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_book_controller">Book Controller</h3>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/BookController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo


<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.CREATED</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.OK</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.NOT_FOUND</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileDynamic</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>
<span class="keyword">import</span> <span class="include">grails.transaction.Transactional</span>


<span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">'</span><span class="content">LineLength</span><span class="delimiter">'</span></span>)
<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">BookController</span> {

<span class="directive">static</span> allowedMethods = [
        <span class="key">index</span>: <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>,
        <span class="key">show</span>: <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>,
        <span class="key">edit</span>: <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>,
        <span class="key">create</span>: <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>,
        <span class="key">editFeaturedImage</span>: <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>,
        <span class="key">save</span>: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>,
        <span class="key">update</span>: <span class="string"><span class="delimiter">'</span><span class="content">PUT</span><span class="delimiter">'</span></span>,
        <span class="key">uploadFeaturedImage</span>: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>,
        <span class="key">delete</span>: <span class="string"><span class="delimiter">'</span><span class="content">DELETE</span><span class="delimiter">'</span></span>,
]

UploadBookFeaturedImageService uploadBookFeaturedImageService

BookGormService bookGormService

<span class="annotation">@CompileDynamic</span>
<span class="keyword">def</span> <span class="function">index</span>(<span class="predefined-type">Integer</span> max) {
    params.max = <span class="predefined-type">Math</span>.min(max ?: <span class="integer">10</span>, <span class="integer">100</span>)
    <span class="keyword">def</span> (l, total) = bookGormService.list(params)
    respond l, <span class="key">model</span>: [<span class="key">bookCount</span>: total]
}

<span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
<span class="keyword">def</span> <span class="function">show</span>(<span class="predefined-type">Book</span> book) {
    respond book
}

<span class="annotation">@SuppressWarnings</span>([<span class="string"><span class="delimiter">'</span><span class="content">FactoryMethodName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">GrailsMassAssignment</span><span class="delimiter">'</span></span>])
<span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
<span class="keyword">def</span> <span class="function">create</span>() {
    respond <span class="keyword">new</span> <span class="predefined-type">Book</span>(params)
}

<span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
<span class="keyword">def</span> <span class="function">edit</span>(<span class="predefined-type">Book</span> book) {
    respond book
}

<span class="annotation">@CompileDynamic</span>
<span class="keyword">def</span> <span class="function">save</span>(NameCommand cmd) {
    <span class="keyword">if</span> (cmd == <span class="predefined-constant">null</span>) {
        notFound()
        <span class="keyword">return</span>
    }

    <span class="keyword">if</span> (cmd.hasErrors()) {
        respond cmd.errors, <span class="key">model</span>: [<span class="key">book</span>: cmd], <span class="key">view</span>:<span class="string"><span class="delimiter">'</span><span class="content">create</span><span class="delimiter">'</span></span>
        <span class="keyword">return</span>
    }

    <span class="keyword">def</span> book = bookGormService.save(cmd)

    <span class="keyword">if</span> ( book == <span class="predefined-constant">null</span> ) {
        notFound()
        <span class="keyword">return</span>
    }

    <span class="keyword">if</span> ( book.hasErrors() ) {
        respond book.errors, <span class="key">model</span>: [<span class="key">book</span>: book], <span class="key">view</span>:<span class="string"><span class="delimiter">'</span><span class="content">create</span><span class="delimiter">'</span></span>
        <span class="keyword">return</span>
    }

    request.withFormat {
        form multipartForm {
            flash.message = message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.created.message</span><span class="delimiter">'</span></span>, <span class="key">args</span>: [message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">book.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book</span><span class="delimiter">'</span></span>), book.id])
            redirect book
        }
        <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span> { respond book, [<span class="key">status</span>: CREATED] }
    }
}

<span class="annotation">@CompileDynamic</span>
<span class="keyword">def</span> <span class="function">update</span>(NameUpdateCommand cmd) {
    <span class="keyword">if</span> (cmd == <span class="predefined-constant">null</span>) {
        notFound()
        <span class="keyword">return</span>
    }

    <span class="keyword">if</span> (cmd.hasErrors()) {
        respond cmd.errors, <span class="key">model</span>: [<span class="key">book</span>: cmd], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">edit</span><span class="delimiter">'</span></span>
        <span class="keyword">return</span>
    }

    <span class="keyword">def</span> book = bookGormService.update(cmd)

    <span class="keyword">if</span> ( book == <span class="predefined-constant">null</span>) {
        notFound()
        <span class="keyword">return</span>
    }

    <span class="keyword">if</span> ( book.hasErrors() ) {
        respond book.errors, <span class="key">model</span>: [<span class="key">book</span>: book], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">edit</span><span class="delimiter">'</span></span>
        <span class="keyword">return</span>
    }

    request.withFormat {
        form multipartForm {
            flash.message = message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.updated.message</span><span class="delimiter">'</span></span>, <span class="key">args</span>: [message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">book.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book</span><span class="delimiter">'</span></span>), book.id])
            redirect book
        }
        <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span> { respond book, [<span class="key">status</span>: OK] }
    }
}

<span class="annotation">@CompileDynamic</span>
<span class="keyword">def</span> <span class="function">delete</span>() {

    <span class="predefined-type">Long</span> bookId = params.long(<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>)

    <span class="keyword">if</span> ( !bookId ) {
        notFound()
        <span class="keyword">return</span>
    }

    bookGormService.deleteById(bookId)

    request.withFormat {
        form multipartForm {
            flash.message = message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.deleted.message</span><span class="delimiter">'</span></span>, <span class="key">args</span>: [message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">book.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book</span><span class="delimiter">'</span></span>), bookId])
            redirect <span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>, <span class="key">method</span>: <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>
        }
        <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span> { render <span class="key">status</span>: NO_CONTENT }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_book_services">Book Services</h3>
<div class="listingblock">
<div class="title">grails-app/services/demo/BookGormService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.transaction.Transactional</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileDynamic</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@Transactional</span>
<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">BookGormService</span> {

    <span class="comment">// tag::list[]</span>
    <span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
    <span class="predefined-type">List</span> list(<span class="predefined-type">Map</span> params) {
        [<span class="predefined-type">Book</span>.list(params), <span class="predefined-type">Book</span>.count()]
    }
    <span class="comment">// end::list[]</span>

    <span class="comment">// tag::save[]</span>
    <span class="annotation">@CompileDynamic</span>
    <span class="predefined-type">Book</span> save(NameCommand cmd) {
        <span class="keyword">def</span> book = <span class="keyword">new</span> <span class="predefined-type">Book</span>()
        book.properties = cmd.properties
        book.save()
    }
    <span class="comment">// end::save[]</span>

    <span class="comment">// tag::update[]</span>
    <span class="annotation">@CompileDynamic</span>
    <span class="predefined-type">Book</span> update(NameUpdateCommand cmd) {
        <span class="predefined-type">Book</span> book = <span class="predefined-type">Book</span>.get(cmd.id)
        book.properties = cmd.properties
        book.save()
    }
    <span class="comment">// end::update[]</span>

    <span class="comment">// tag::deleteById[]</span>
    <span class="type">void</span> deleteById(<span class="predefined-type">Long</span> bookId) {
        <span class="keyword">def</span> book = <span class="predefined-type">Book</span>.get(bookId)
        book?.delete()
    }
    <span class="comment">// end::deleteById[]</span>

    <span class="comment">// tag::updateFeaturedImageUrl[]</span>
    <span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">'</span><span class="content">LineLength</span><span class="delimiter">'</span></span>)
    <span class="predefined-type">Book</span> updateFeaturedImageUrl(<span class="predefined-type">Long</span> id, <span class="predefined-type">Long</span> version, <span class="predefined-type">String</span> fileName, <span class="predefined-type">String</span> featuredImageUrl, <span class="type">boolean</span> flush = <span class="predefined-constant">false</span>) {
        <span class="predefined-type">Book</span> book = <span class="predefined-type">Book</span>.get(id)
        <span class="keyword">if</span> ( !book ) {
            <span class="keyword">return</span> <span class="predefined-constant">null</span>
        }
        book.version = version
        book.fileName = fileName
        book.featuredImageUrl = featuredImageUrl
        book.save(<span class="key">flush</span>: flush)
        book
    }
    <span class="comment">// end::updateFeaturedImageUrl[]</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_book_gsps">Book GSPs</h3>
<div class="listingblock">
<div class="title">grails-app/views/book/index.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta name=<span class="string"><span class="delimiter">&quot;</span><span class="content">layout</span><span class="delimiter">&quot;</span></span> content=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;<span class="key">g</span>:set var=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityName</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">book.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;title&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.list.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">title&gt;</span></span><span class="error">
</span>    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">head&gt;</span></span><span class="error">
</span>    &lt;body&gt;
        &lt;a href=<span class="string"><span class="delimiter">&quot;</span><span class="content">#list-book</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">skip</span><span class="delimiter">&quot;</span></span> <span class="class">tabindex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.link.skip.label</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Skip to content&amp;hellip;</span><span class="delimiter">&quot;</span></span>/&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">a&gt;</span></span><span class="error">
</span>        &lt;div <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nav</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">navigation</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;ul&gt;
                &lt;li&gt;&lt;a <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span> <span class="class">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>createLink(<span class="key">uri</span>: <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.home.label</span><span class="delimiter">&quot;</span></span>/&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">a&gt;&lt;</span><span class="delimiter">/</span></span>li&gt;
                &lt;li&gt;&lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.new.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;&lt;</span><span class="delimiter">/</span></span>li&gt;
            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">ul&gt;</span></span><span class="error">
</span>        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>        &lt;div id=<span class="string"><span class="delimiter">&quot;</span><span class="content">list-book</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content scaffold-list</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;h1&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.list.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">h1&gt;</span></span><span class="error">
</span>            &lt;<span class="key">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>flash.message<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
                &lt;div <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>&gt;<span class="error">$</span>{flash.message}&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;</span></span><span class="error">
</span>            &lt;<span class="key">f</span>:table collection=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>bookList<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> properties=<span class="string"><span class="delimiter">&quot;</span><span class="content">['name']</span><span class="delimiter">&quot;</span></span>/&gt;
            &lt;div <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pagination</span><span class="delimiter">&quot;</span></span>&gt;
                &lt;<span class="class">g</span>:paginate total=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>bookCount ?: <span class="integer">0</span><span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">body&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">html&gt;</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/views/book/show.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta name=<span class="string"><span class="delimiter">&quot;</span><span class="content">layout</span><span class="delimiter">&quot;</span></span> content=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;<span class="key">g</span>:set var=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityName</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">book.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;title&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.show.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">title&gt;</span></span><span class="error">
</span>    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">head&gt;</span></span><span class="error">
</span>    &lt;body&gt;
        &lt;a href=<span class="string"><span class="delimiter">&quot;</span><span class="content">#show-book</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">skip</span><span class="delimiter">&quot;</span></span> <span class="class">tabindex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.link.skip.label</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Skip to content&amp;hellip;</span><span class="delimiter">&quot;</span></span>/&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">a&gt;</span></span><span class="error">
</span>        &lt;div <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nav</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">navigation</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;ul&gt;
                &lt;li&gt;&lt;a <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span> <span class="class">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>createLink(<span class="key">uri</span>: <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.home.label</span><span class="delimiter">&quot;</span></span>/&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">a&gt;&lt;</span><span class="delimiter">/</span></span>li&gt;
                &lt;li&gt;&lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.list.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;&lt;</span><span class="delimiter">/</span></span>li&gt;
                &lt;li&gt;&lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.new.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;&lt;</span><span class="delimiter">/</span></span>li&gt;
            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">ul&gt;</span></span><span class="error">
</span>        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>        &lt;div id=<span class="string"><span class="delimiter">&quot;</span><span class="content">show-book</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content scaffold-show</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;<span class="key">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>flash.message<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
            &lt;div <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>&gt;<span class="error">$</span>{flash.message}&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;</span></span><span class="error">
</span>            &lt;h1&gt;&lt;<span class="key">f</span>:display bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span> property=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">h1&gt;</span></span><span class="error">
</span>            &lt;<span class="key">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>book.featuredImageUrl<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
                &lt;img src=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>book.featuredImageUrl<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> width=<span class="string"><span class="delimiter">&quot;</span><span class="content">400</span><span class="delimiter">&quot;</span></span>/&gt;
            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;</span></span><span class="error">
</span>            &lt;<span class="key">g</span>:form resource=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.book<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> method=<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE</span><span class="delimiter">&quot;</span></span>&gt;
                &lt;fieldset <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buttons</span><span class="delimiter">&quot;</span></span>&gt;
                    &lt;<span class="class">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">edit</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">editFeaturedImage</span><span class="delimiter">&quot;</span></span> resource=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.book<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">book.featuredImageUrl.edit.label</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Edit Featured Image</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;</span></span><span class="error">
</span>                    &lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">edit</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">edit</span><span class="delimiter">&quot;</span></span> resource=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.book<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.button.edit.label</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Edit</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;</span></span><span class="error">
</span>                    &lt;input <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">delete</span><span class="delimiter">&quot;</span></span> <span class="class">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.button.delete.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Delete</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> onclick=<span class="string"><span class="delimiter">&quot;</span><span class="content">return confirm('</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.button.delete.confirm.message</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Are you sure?</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="content">');</span><span class="delimiter">&quot;</span></span> /&gt;
                &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">fieldset&gt;</span></span><span class="error">
</span>            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:form&gt;</span></span><span class="error">
</span>        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">body&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">html&gt;</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/views/book/edit.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta name=<span class="string"><span class="delimiter">&quot;</span><span class="content">layout</span><span class="delimiter">&quot;</span></span> content=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;<span class="key">g</span>:set var=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityName</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">book.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;title&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.edit.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">title&gt;</span></span><span class="error">
</span>    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">head&gt;</span></span><span class="error">
</span>    &lt;body&gt;
        &lt;a href=<span class="string"><span class="delimiter">&quot;</span><span class="content">#edit-book</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">skip</span><span class="delimiter">&quot;</span></span> <span class="class">tabindex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.link.skip.label</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Skip to content&amp;hellip;</span><span class="delimiter">&quot;</span></span>/&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">a&gt;</span></span><span class="error">
</span>        &lt;div <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nav</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">navigation</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;ul&gt;
                &lt;li&gt;&lt;a <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span> <span class="class">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>createLink(<span class="key">uri</span>: <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.home.label</span><span class="delimiter">&quot;</span></span>/&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">a&gt;&lt;</span><span class="delimiter">/</span></span>li&gt;
                &lt;li&gt;&lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.list.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;&lt;</span><span class="delimiter">/</span></span>li&gt;
                &lt;li&gt;&lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.new.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;&lt;</span><span class="delimiter">/</span></span>li&gt;
            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">ul&gt;</span></span><span class="error">
</span>        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>        &lt;div id=<span class="string"><span class="delimiter">&quot;</span><span class="content">edit-book</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content scaffold-edit</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;h1&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.edit.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">h1&gt;</span></span><span class="error">
</span>            &lt;<span class="key">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>flash.message<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
            &lt;div <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>&gt;<span class="error">$</span>{flash.message}&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;</span></span><span class="error">
</span>            &lt;<span class="key">g</span>:hasErrors bean=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.book<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
            &lt;ul <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errors</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">alert</span><span class="delimiter">&quot;</span></span>&gt;
                &lt;<span class="key">g</span>:eachError bean=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.book<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> var=<span class="string"><span class="delimiter">&quot;</span><span class="content">error</span><span class="delimiter">&quot;</span></span>&gt;
                &lt;li &lt;<span class="key">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>error <span class="keyword">in</span> org.springframework.validation.FieldError<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;data-field-id=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>error.field<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;&gt;&lt;g:message error=&quot;</span><span class="inline"><span class="inline-delimiter">${</span>error<span class="inline-delimiter">}</span></span><span class="content">&quot;</span><span class="delimiter">/</span></span>&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">li&gt;</span></span><span class="error">
</span>                &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:eachError&gt;</span></span><span class="error">
</span>            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">ul&gt;</span></span><span class="error">
</span>            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:hasErrors&gt;</span></span><span class="error">
</span>            &lt;<span class="key">g</span>:form resource=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.book<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> method=<span class="string"><span class="delimiter">&quot;</span><span class="content">PUT</span><span class="delimiter">&quot;</span></span>&gt;
                &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.book?.version<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
                &lt;fieldset <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form</span><span class="delimiter">&quot;</span></span>&gt;
                    &lt;<span class="class">f</span>:all bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span> except=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageUrl</span><span class="delimiter">&quot;</span></span>/&gt;
                &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">fieldset&gt;</span></span><span class="error">
</span>                &lt;fieldset <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buttons</span><span class="delimiter">&quot;</span></span>&gt;
                    &lt;<span class="class">input</span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">save</span><span class="delimiter">&quot;</span></span> <span class="class">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.button.update.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Update</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
                &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">fieldset&gt;</span></span><span class="error">
</span>            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:form&gt;</span></span><span class="error">
</span>        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">body&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">html&gt;</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/views/book/create.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta name=<span class="string"><span class="delimiter">&quot;</span><span class="content">layout</span><span class="delimiter">&quot;</span></span> content=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;<span class="key">g</span>:set var=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityName</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">book.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Hotel</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;title&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.create.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">title&gt;</span></span><span class="error">
</span>    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">head&gt;</span></span><span class="error">
</span>    &lt;body&gt;
        &lt;a href=<span class="string"><span class="delimiter">&quot;</span><span class="content">#create-book</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">skip</span><span class="delimiter">&quot;</span></span> <span class="class">tabindex</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-1</span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.link.skip.label</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Skip to content&amp;hellip;</span><span class="delimiter">&quot;</span></span>/&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">a&gt;</span></span><span class="error">
</span>        &lt;div <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nav</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">navigation</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;ul&gt;
                &lt;li&gt;&lt;a <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span> <span class="class">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>createLink(<span class="key">uri</span>: <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.home.label</span><span class="delimiter">&quot;</span></span>/&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">a&gt;&lt;</span><span class="delimiter">/</span></span>li&gt;
                &lt;li&gt;&lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.list.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;&lt;</span><span class="delimiter">/</span></span>li&gt;
            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">ul&gt;</span></span><span class="error">
</span>        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>        &lt;div id=<span class="string"><span class="delimiter">&quot;</span><span class="content">create-book</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">content scaffold-create</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;h1&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.create.label</span><span class="delimiter">&quot;</span></span> args=<span class="string"><span class="delimiter">&quot;</span><span class="content">[entityName]</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">h1&gt;</span></span><span class="error">
</span>            &lt;<span class="key">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>flash.message<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
            &lt;div <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>&gt;<span class="error">$</span>{flash.message}&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;</span></span><span class="error">
</span>            &lt;<span class="key">g</span>:hasErrors bean=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.book<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
            &lt;ul <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errors</span><span class="delimiter">&quot;</span></span> <span class="class">role</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">alert</span><span class="delimiter">&quot;</span></span>&gt;
                &lt;<span class="key">g</span>:eachError bean=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.book<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> var=<span class="string"><span class="delimiter">&quot;</span><span class="content">error</span><span class="delimiter">&quot;</span></span>&gt;
                &lt;li &lt;<span class="key">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>error <span class="keyword">in</span> org.springframework.validation.FieldError<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;data-field-id=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>error.field<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;&gt;&lt;g:message error=&quot;</span><span class="inline"><span class="inline-delimiter">${</span>error<span class="inline-delimiter">}</span></span><span class="content">&quot;</span><span class="delimiter">/</span></span>&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">li&gt;</span></span><span class="error">
</span>                &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:eachError&gt;</span></span><span class="error">
</span>            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">ul&gt;</span></span><span class="error">
</span>            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:hasErrors&gt;</span></span><span class="error">
</span>            &lt;<span class="key">g</span>:form action=<span class="string"><span class="delimiter">&quot;</span><span class="content">save</span><span class="delimiter">&quot;</span></span>&gt;
                &lt;fieldset <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">form</span><span class="delimiter">&quot;</span></span>&gt;
                    &lt;<span class="class">f</span>:all bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span> except=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageUrl, fileName</span><span class="delimiter">&quot;</span></span>/&gt;
                &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">fieldset&gt;</span></span><span class="error">
</span>                &lt;fieldset <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buttons</span><span class="delimiter">&quot;</span></span>&gt;
                    &lt;<span class="class">g</span>:submitButton name=<span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">save</span><span class="delimiter">&quot;</span></span> <span class="class">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.button.create.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Create</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
                &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">fieldset&gt;</span></span><span class="error">
</span>            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:form&gt;</span></span><span class="error">
</span>        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">body&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">html&gt;</span></span></code></pre>
</div>
</div>
</div>

                                        </div>
                                    </td>
                                    <td id="col2">
                                        <div class="local clearfix">
                                            <div class="local-title" style="text-align: right"><a href="https://travis-ci.org/grails-guides/grails-google-cloud"><img src="https://travis-ci.org/grails-guides/grails-google-cloud.svg?branch=master" /></a></div>            

                                            <div class="local-title">
                                                <a href="https://github.com/grails-guides/grails-google-cloud">
                                                    <svg height="35" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="35" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></a> &nbsp;&nbsp;Get the Code
                                                </div>
                                                <div class="menu">
                                                    <div class="input-group">                        
                                                        <button href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/grails-google-cloud.git'" class="codeButton">SSH</button>
                                                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-google-cloud.git'" class="codeButton">HTTPS</button>
                                                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-google-cloud'" class="codeButton">Subversion</button>
                                                    </div>

                                                    <div class="input-group">                    
                                                        <!-- Target -->
                                                        <input id="github-url" value="git@github.com:grails-guides/grails-google-cloud.git" type="text" />

                                                        <!-- Trigger -->
                                                        <button class="clipbtn" type="button" data-clipboard-target="#github-url">

                                                            <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
                                                        </button>       

                                                    </div>
                                                    <div class="input-group">
                                                      <a href="https://github.com/grails-guides/grails-google-cloud/archive/master.zip" class="downloadButton">Download ZIP</a>
                                                  </div>
                                              </div>
                                              
                                              <div id="table-of-content">
                                                <h2>Table of Contents</h2>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>1</strong><span>Getting Started</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>1.1</strong><span>What you will need</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#howto"><strong>1.2</strong><span>How to complete the guide</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#writingTheApp"><strong>2</strong><span>Writing the Application</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#domainClass"><strong>2.1</strong><span>Domain Class</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#seedData"><strong>2.2</strong><span>Seed Data</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#displayBooks"><strong>2.3</strong><span>Display Books</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#googleCloud"><strong>3</strong><span>Cloud SDK</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#appEngine"><strong>4</strong><span>Google App Engine</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#gapGradlePlugin"><strong>4.1</strong><span>Google App Engine Gradle Plugin</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#applicationDeploymentConfiguration"><strong>4.2</strong><span>Application Deployment Configuration</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#springBootJetty"><strong>4.3</strong><span>SpringBoot Jetty</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#cloudSQL"><strong>5</strong><span>Cloud SQL</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#dataSourceGoogleCloudSQL"><strong>5.1</strong><span>Datasource using Cloud SQL</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#cloudStorage"><strong>6</strong><span>Cloud Storage</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#deployingTheApp"><strong>7</strong><span>Deploying the App</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#logging"><strong>8</strong><span>Logging</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#learnMore"><strong>9</strong><span>Learn More</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#helpWithGrails"><strong>10</strong><span>Help With Grails</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#appendixA"><strong>11</strong><span>Appendix A - Scaffolding</span></a></div>
                                                
                            <div style="clear:both" ></div>
                        </div>
                                            
                    </div>
                </td>
            </tr>
        </table>

        <div id="footer">
            Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing.
            
        </div>

            <!-- END CONTENT -->
          </div>
        </div>
      </div>
    </div>

<script type="text/javascript">
    new Clipboard('.clipbtn');
</script>
<script type="text/javascript" src="../js/docs.js"></script>
<script type="text/javascript" src="../js/classie.js"></script>        
<script type="text/javascript" src="../js/sidebarEffects.js"></script>
<script type="text/javascript" src="../js/navbar.js"></script> 
<style type="text/css">
    #colset {
        background-color: #f5f5f5;
    }
    .grailsnavbar {
        padding-right: 0;
    }
    #fork-me {
        display: none;
    }
</style>       
    </body>
</html>
