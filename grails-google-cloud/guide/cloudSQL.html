<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>5 Cloud SQL</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/guide.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />            
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Grails Framework Guide 
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/gettingStarted.html"><strong>1</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/writingTheApp.html"><strong>2</strong><span>Writing the Application</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/googleCloud.html"><strong>3</strong><span>Cloud SDK</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/appEngine.html"><strong>4</strong><span>Google App Engine</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cloudSQL.html"><strong>5</strong><span>Cloud SQL</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cloudStorage.html"><strong>6</strong><span>Cloud Storage</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/deployingTheApp.html"><strong>7</strong><span>Deploying the App</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/logging.html"><strong>8</strong><span>Logging</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/learnMore.html"><strong>9</strong><span>Learn More</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/helpWithGrails.html"><strong>10</strong><span>Help With Grails</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/appendixA.html"><strong>11</strong><span>Appendix A - Scaffolding</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/appEngine.html">&lt;&lt; <strong>4</strong><span>Google App Engine</span></a></div>
                

                
                    <div class="toc-item next-right"><a href="../guide/cloudStorage.html"><strong>6</strong><span>Cloud Storage</span> >></a></div>
                


                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#dataSourceGoogleCloudSQL"><strong>5.1</strong><span>Datasource using Cloud SQL</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="cloudSQL">5 Cloud SQL</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/cloudSQL.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Grails application developed during this guide is going to use a MySQL database created with <a href="https://cloud.google.com/sql/">Cloud SQL</a></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Cloud SQL is a fully-managed database service that makes it easy to set up, maintain, manage, and administer your relational PostgreSQL BETA and MySQL databases in the cloud. Cloud SQL offers high performance, scalability, and convenience. Hosted on Google Cloud Platform, Cloud SQL provides a database infrastructure for applications running anywhere.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>If you have not enabled Cloud SQL API already, Go to your project dashboard and enable it.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/enable-cloud-sql-api.png" alt="enable cloud sql api">
</div>
</div>
<div class="paragraph">
<p>We are going to <a href="https://console.cloud.google.com/sql">create a new instance of Cloud SQL</a>
associated to the same project we created before.</p>
</div>
<div class="paragraph">
<p>Go to the Cloud SQL section of the console:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/select-sql-in-the-left-navigation.png" alt="select sql in the left navigation">
</div>
</div>
<div class="paragraph">
<p>Next screenshots illustrate the process:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql_3.png" alt="cloudsql 3">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql_4.png" alt="cloudsql 4">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql_5.png" alt="cloudsql 5">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql_6.png" alt="cloudsql 6">
</div>
</div>
<div class="paragraph">
<p>Once the instance is ready, we create a database:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql_8.png" alt="cloudsql 8">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql_9.png" alt="cloudsql 9">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql_10.png" alt="cloudsql 10">
</div>
</div>


<h2 id="dataSourceGoogleCloudSQL">5.1 Datasource using Cloud SQL</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/dataSourceGoogleCloudSQL.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As described in <a href="https://cloud.google.com/appengine/docs/flexible/java/using-cloud-sql">Using Cloud SQL with a Flexible Environment</a> documentation, we need to
add several runtime dependencies and configure the production url to use the Cloud SQL MySQL database we created before.</p>
</div>
<div class="paragraph">
<p>Replace the H2 dependency with several MySQL dependencies.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">runtime <span class="string"><span class="delimiter">'</span><span class="content">mysql:mysql-connector-java:6.0.5</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
runtime <span class="string"><span class="delimiter">'</span><span class="content">com.google.cloud.sql:mysql-socket-factory-connector-j-6:1.0.2</span><span class="delimiter">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>JDBC library</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Cloud SQL MySQL Socket Factory</td>
</tr>
</table>
</div>
<div class="listingblock unjust">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">dataSource</span>:
    <span class="key">pooled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">jmxExport</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">dialect</span>: <span class="string"><span class="content">org.hibernate.dialect.MySQL5InnoDBDialect</span></span>
<span class="key">environments</span>:
    <span class="key">development</span>:
        <span class="key">dataSource</span>:
            <span class="key">dbCreate</span>: <span class="string"><span class="content">create-drop</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:mysql://127.0.0.1:8889/grailsgooglecloud_dev?useTimezone=true&amp;serverTimezone=GMT</span></span>
            <span class="key">driverClassName</span>: <span class="string"><span class="content">com.mysql.jdbc.Driver</span></span>
            <span class="key">username</span>: <span class="string"><span class="content">root</span></span>
            <span class="key">password</span>: <span class="string"><span class="content">root</span></span>
    <span class="key">test</span>:
        <span class="key">dataSource</span>:
            <span class="key">dbCreate</span>: <span class="string"><span class="content">update</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:mysql://127.0.0.1:8889/grailsgooglecloud_test?useTimezone=true&amp;serverTimezone=GMT</span></span>
            <span class="key">driverClassName</span>: <span class="string"><span class="content">com.mysql.jdbc.Driver</span></span>
            <span class="key">username</span>: <span class="string"><span class="content">root</span></span>
            <span class="key">password</span>: <span class="string"><span class="content">root</span></span>
    <span class="key">production</span>:
        <span class="key">dataSource</span>:
            <span class="key">driverClassName</span>: <span class="string"><span class="content">com.mysql.jdbc.Driver</span></span>
            <span class="key">dbCreate</span>: <span class="string"><span class="content">create-drop</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:mysql://google/grailstestdb?cloudSqlInstance=test-grails-guide:europe-west1:grailstest-mysql&amp;socketFactory=com.google.cloud.sql.mysql.SocketFactory&amp;user=root&amp;password=foo123&amp;useSSL=false </span></span><i class="conum" data-value="1"></i><b>(1)</b>
            <span class="key">properties</span>:
                <span class="key">jmxEnabled</span>: <span class="string"><span class="content">true</span></span>
                <span class="key">initialSize</span>: <span class="string"><span class="content">5</span></span>
                <span class="key">maxActive</span>: <span class="string"><span class="content">50</span></span>
                <span class="key">minIdle</span>: <span class="string"><span class="content">5</span></span>
                <span class="key">maxIdle</span>: <span class="string"><span class="content">25</span></span>
                <span class="key">maxWait</span>: <span class="string"><span class="content">10000</span></span>
                <span class="key">maxAge</span>: <span class="string"><span class="content">600000</span></span>
                <span class="key">timeBetweenEvictionRunsMillis</span>: <span class="string"><span class="content">5000</span></span>
                <span class="key">minEvictableIdleTimeMillis</span>: <span class="string"><span class="content">60000</span></span>
                <span class="key">validationQuery</span>: <span class="string"><span class="content">SELECT 1</span></span>
                <span class="key">validationQueryTimeout</span>: <span class="string"><span class="content">3</span></span>
                <span class="key">validationInterval</span>: <span class="string"><span class="content">15000</span></span>
                <span class="key">testOnBorrow</span>: <span class="string"><span class="content">true</span></span>
                <span class="key">testWhileIdle</span>: <span class="string"><span class="content">true</span></span>
                <span class="key">testOnReturn</span>: <span class="string"><span class="content">false</span></span>
                <span class="key">jdbcInterceptors</span>: <span class="string"><span class="content">ConnectionState</span></span>
                <span class="key">defaultTransactionIsolation</span>: <span class="string"><span class="content">2</span></span> <span class="comment"># TRANSACTION_READ_COMMITTED</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Custom url string</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The production datasource url uses a custom url which is built with several components:</p>
</div>
<div class="paragraph">
<p><code>jdbc:mysql://google/{DATABASE_NAME}?cloudSqlInstance={INSTANCE_NAME}&amp;socketFactory=com.google.cloud.sql.mysql.SocketFactory&amp;user={USERNAME}&amp;password={PASSWORD}&amp;useSSL=false</code></p>
</div>
<div class="paragraph">
<p><strong>DATABASE_NAME</strong></p>
</div>
<div class="paragraph">
<p>Use the database name you used when you created the database.</p>
</div>
<div class="paragraph">
<p><strong>INSTANCE_NAME</strong></p>
</div>
<div class="paragraph">
<p>You can find your instance name in your Cloud SQL instance details:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/instancename.png" alt="instancename">
</div>
</div>
<div class="paragraph">
<p><strong>USERNAME / PASSWORD</strong></p>
</div>
<div class="paragraph">
<p>For this guide, we are using username: <code>root</code> and the password we entered when we created the SQL instance; see previous sections.</p>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/appEngine.html">&lt;&lt; <strong>4</strong><span>Google App Engine</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/cloudStorage.html"><strong>6</strong><span>Cloud Storage</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title" style="text-align: right"><a href="https://travis-ci.org/grails-guides/grails-google-cloud"><img src="https://travis-ci.org/grails-guides/grails-google-cloud.svg?branch=master" /></a></div>            
                 <div class="local-title">
                    <a href="https://github.com/grails-guides/grails-google-cloud">
                    <svg height="35" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="35" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></a> &nbsp;&nbsp;Get the Code
                </div>
                <div class="menu">
                    <div class="input-group">                        
                        <button href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/grails-google-cloud.git'" class="codeButton">SSH</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-google-cloud.git'" class="codeButton">HTTPS</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-google-cloud'" class="codeButton">Subversion</button>
                    </div>
       
                    <div class="input-group">                    
                        <!-- Target -->
                        <input id="github-url" value="git@github.com:grails-guides/grails-google-cloud.git" type="text" />

                        <!-- Trigger -->
                        <button class="clipbtn" type="button" data-clipboard-target="#github-url">

                            <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
                        </button>       

                    </div>
                    <div class="input-group">
                      <a href="https://github.com/grails-guides/grails-google-cloud/archive/master.zip" class="downloadButton">Download ZIP</a>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing.
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
