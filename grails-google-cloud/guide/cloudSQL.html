<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>9 Cloud SQL</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/guide.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />            
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Grails Framework Guide 
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/training.html"><strong>1</strong><span>Grails Training</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/gettingStarted.html"><strong>2</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/costs.html"><strong>3</strong><span>Costs</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/whatYouWillNeed.html"><strong>4</strong><span>What you will need</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/howToComplete.html"><strong>5</strong><span>How to Complete</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/writingTheApp.html"><strong>6</strong><span>Writing the application</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cloudSDK.html"><strong>7</strong><span>Cloud SDK</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/googleAppEngine.html"><strong>8</strong><span>Google App Engine</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cloudSQL.html"><strong>9</strong><span>Cloud SQL</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cloudStorage.html"><strong>10</strong><span>Cloud Storage</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/deployingTheApp.html"><strong>11</strong><span>Deploying the app</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/logging.html"><strong>12</strong><span>Logging</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/cleaningUp.html"><strong>13</strong><span>Cleaning Up</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/learnMore.html"><strong>14</strong><span>Learn More</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/helpWithGrails.html"><strong>15</strong><span>Help With Grails</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/googleAppEngine.html">&lt;&lt; <strong>8</strong><span>Google App Engine</span></a></div>
                

                
                    <div class="toc-item next-right"><a href="../guide/cloudStorage.html"><strong>10</strong><span>Cloud Storage</span> >></a></div>
                


                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#createCloudSQLInstance"><strong>9.1</strong><span>Create Cloud SQL Instance</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#datasourceUsingCloudSQL"><strong>9.2</strong><span>Datasource using Cloud SQL</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="cloudSQL">9 Cloud SQL</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/cloudSQL.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The Grails application developed during this guide is going to use a
MySQL database created with <a href="https://cloud.google.com/sql/">Cloud SQL</a></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Cloud SQL is a fully-managed database service that makes it easy to set up, maintain, manage, and administer your relational PostgreSQL BETA and MySQL databases in the cloud. Cloud SQL offers high performance, scalability, and convenience. Hosted on Google Cloud Platform, Cloud SQL provides a database infrastructure for applications running anywhere.</p>
</div>
</blockquote>
</div>
<div class="sect1">
<h2 id="_enable_cloud_sql_api">Enable Cloud SQL API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have not enabled <strong>Cloud SQL</strong> and <strong>Cloud SQL API</strong> already, go to your project
dashboard and enable them.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-1.png" alt="cloudsql 1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-2.png" alt="cloudsql 2">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-3.png" alt="cloudsql 3">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-4.png" alt="cloudsql 4">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsqlapi-1.png" alt="cloudsqlapi 1">
</div>
</div>
</div>
</div>


<h2 id="createCloudSQLInstance">9.1 Create Cloud SQL Instance</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/createCloudSQLInstance.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to <a href="https://console.cloud.google.com/sql">create a new instance of Cloud SQL</a>
associated to the same project we created before.</p>
</div>
<div class="paragraph">
<p>Go to the Cloud SQL section of the console:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-5.png" alt="cloudsql 5">
</div>
</div>
<div class="paragraph">
<p>Next screenshots illustrate the process:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-6.png" alt="cloudsql 6">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-7.png" alt="cloudsql 7">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-8.png" alt="cloudsql 8">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-9.png" alt="cloudsql 9">
</div>
</div>
<div class="paragraph">
<p>Once the instance is ready, we create a database:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-10.png" alt="cloudsql 10">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-11.png" alt="cloudsql 11">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-12.png" alt="cloudsql 12">
</div>
</div>


<h2 id="datasourceUsingCloudSQL">9.2 Datasource using Cloud SQL</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-google-cloud/edit/master/src/main/docs/guide/datasourceUsingCloudSQL.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As described in Using <a href="https://cloud.google.com/appengine/docs/flexible/java/using-cloud-sql">Cloud SQL</a>
with a Flexible Environment documentation, we need to add several runtime dependencies and configure
the production url to use the Cloud SQL MySQL database we created before.</p>
</div>
<div class="paragraph">
<p>Add MySQL dependencies; JDBC library and Cloud SQL MySQL Socket Factory.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    runtime <span class="string"><span class="delimiter">'</span><span class="content">mysql:mysql-connector-java:6.0.5</span><span class="delimiter">'</span></span>
    runtime <span class="string"><span class="delimiter">'</span><span class="content">com.google.cloud.sql:mysql-socket-factory-connector-j-6:1.0.3</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace the <code>production</code> environment <code>datasource</code> configuration to point to the
Cloud SQL MySQL database in <code>application.yml</code></p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">environments</span>:
    <span class="key">production</span>:
        <span class="key">dataSource</span>:
            <span class="key">dialect</span>: <span class="string"><span class="content">org.hibernate.dialect.MySQL5InnoDBDialect</span></span>
            <span class="key">driverClassName</span>: <span class="string"><span class="content">com.mysql.cj.jdbc.Driver</span></span>
            <span class="key">dbCreate</span>: <span class="string"><span class="content">update</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:mysql://google/grailsgooglecloud?socketFactory=com.google.cloud.sql.mysql.SocketFactory&amp;cloudSqlInstance=inner-topic-174815:us-central1:grailsgooglecloud&amp;useSSL=true</span></span>
            <span class="key">username</span>: <span class="string"><span class="content">root</span></span>
            <span class="key">password</span>: <span class="string"><span class="content">grailsgooglecloud</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The production datasource url uses a custom url which is built with several components:</p>
</div>
<div class="paragraph">
<p><code>jdbc:mysql://google/{DATABASE_NAME}?socketFactory=com.google.cloud.sql.mysql.SocketFactory&amp;cloudSqlInstance={INSTANCE_NAME}&amp;useSSL=true</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>DATABASE_NAME</strong> Use the database name you used when you created the database.</p>
</li>
<li>
<p><strong>INSTANCE_NAME</strong> You can find your instance name in your Cloud SQL instance details:</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/cloudsql-13.png" alt="cloudsql 13">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>USERNAME / PASSWORD</strong> For this guide, we are using username: <code>root</code> and
the password we entered when we created the SQL instance; see previous sections.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory">Cloud SQL Socket Factory for JDBC drivers Github Repository</a>
contains a tool in <code>examples/getting-started</code> that can help generate the JDBC
URL and verify that connectivity can be established.</p>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/googleAppEngine.html">&lt;&lt; <strong>8</strong><span>Google App Engine</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/cloudStorage.html"><strong>10</strong><span>Cloud Storage</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title" style="text-align: right"><a href="https://travis-ci.org/grails-guides/grails-google-cloud"><img src="https://travis-ci.org/grails-guides/grails-google-cloud.svg?branch=master" /></a></div>            
                 <div class="local-title">
                    <a href="https://github.com/grails-guides/grails-google-cloud">
                    <svg height="35" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="35" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></a> &nbsp;&nbsp;Get the Code
                </div>
                <div class="menu">
                    <div class="input-group">                        
                        <button href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/grails-google-cloud.git'" class="codeButton">SSH</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-google-cloud.git'" class="codeButton">HTTPS</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-google-cloud'" class="codeButton">Subversion</button>
                    </div>
       
                    <div class="input-group">                    
                        <!-- Target -->
                        <input id="github-url" value="git@github.com:grails-guides/grails-google-cloud.git" type="text" />

                        <!-- Trigger -->
                        <button class="clipbtn" type="button" data-clipboard-target="#github-url">

                            <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
                        </button>       

                    </div>
                    <div class="input-group">
                      <a href="https://github.com/grails-guides/grails-google-cloud/archive/master.zip" class="downloadButton">Download ZIP</a>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing.
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
