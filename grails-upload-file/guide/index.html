<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>How to upload a file with Grails 3</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/guide.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />        
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>

        <link rel="stylesheet" type="text/css" href="../css/font-awesome.min.css" />        
        <link rel="stylesheet" type="text/css" href="../css/navbar.css" />
        <link rel="stylesheet" type="text/css" href="../css/stMenu.css" />      

    </head>

    <body class="body" onload="addJsClass();">

    <a href="https://github.com/grails/grails-core" target="_blank">
      <div id="fork-me">
        <p>Fork me on Github</p>
      </div>
    </a>
    <div id="st-container" class="st-container st-effect-9">
      <nav class="st-menu st-effect-9" id="menu-12">
        <h2 class="icon icon-lab">Socialize</h2>
        <ul>
          <li><a href="http://grails.org/mailing-lists.html" class="icon"><span class="fa fa-envelope"></span> Discuss on the Mailing List</a></li>
          <li><a href="http://slack-signup.grails.org" class="icon"><span class="fa fa-slack"></span> Discuss on Slack</a></li>
          <li><a href="https://twitter.com/grailsframework" class="icon"><span class="fa fa-twitter"></span> Grails on Twitter</a></li>
          <li><a href="http://grails.org/events.html" class="icon"><span class="fa fa-calendar"></span> Events and conferences</a></li>
          <li><a href="https://github.com/grails/grails-core" class="icon"><span class="fa fa-github"></span> Source code on GitHub</a></li>
          <li><a href="http://grails.org/contribute.html#reporting-issues" class="icon"><span class="fa fa-bug"></span> Report issues on Github</a></li>
          <li><a href="http://stackoverflow.com/questions/tagged/grails" class="icon"><span class="fa fa-stack-overflow"></span> Stack Overflow questions</a></li>
        </ul>
      </nav>
      <div class="st-pusher">
        <div class="st-content">
          <div class="st-content">
            <div class="grailsnavbar grailsnavbar-default">
              <div class="grailsnavbar-container">
                <div class="grailsnavbar-header">
                  <a class="grailsnavbar-brand" href="index.html"><i class="fa grails-icon"><img src="../img/grails-cupsonly-logo-white.svg"></i> Grails</a>
                </div>
                <a id="nav-icon" href="javascript:toggleNavIcon();">
                  <span></span>
                  <span></span>
                  <span></span>
                </a>
                <div class="grailsnavbar-collapse collapse">
                  <ul id="grailsnavbar-nav" class="grailsnavbar-nav grailsnavbar-right closemobile">
                    <li><a href="http://grails.org/learn.html">Learn</a></li>
                    <li><a href="http://guides.grails.org">Guides</a></li>
                    <li><a href="http://grails.org/documentation.html">Documentation</a></li>
                    <li><a href="http://grails.org/download.html">Download</a></li>
                    <li><a href="http://plugins.grails.org">Plugins</a></li>
                    <li><a href="http://grails.org/community.html">Community</a></li>
                    <li><a href="http://grails.org/support.html">Support</a></li>
                    <li><a data-effect="st-effect-9" class="st-trigger" href="#">Socialize</a></li>
                    <li><a href="http://grails.org/search.html"><i class="fa fa-search"></i></a></li>
                  </ul>
                </div>
              </div>
            </div>
            <!-- CONTENT -->
<table id="colset" border="0" cellpadding="0" cellspacing="0">
                                <tr>
                                    <td id="col1">
                                        <div id="main" class="corner-all">

                                            <div class="project">
                                                <h1>How to upload a file with Grails 3</h1>
                                                <p></p>
                                                <p>Learn how to upload files with Grails 3; transfer them to a folder, save them as byte[] in the database or upload them to AWS S3.</p>
                                                <p><strong>Authors:</strong> Sergio del Amo</p>
                                                <p><strong>Grails Version:</strong> 3.3.0</p>

                                            </div>

                                            

<h1 id="gettingStarted">1 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this guide, you are going to write three different domain classes. Moreover, you are going to write controllers, services, and views associated with them.</p>
</div>
<div class="paragraph">
<p>We are going to explore different ways to save the uploaded files; byte[] in the database, local folder or remote server (AWS S3).</p>
</div>
<div class="paragraph">
<p>We are going to use a Command Object to allow only images ( JPG or PNG ) uploads.</p>
</div>


<h2 id="requirements">1.1 What you will need</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/requirements.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.7 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
</ul>
</div>


<h2 id="howto">1.2 How to complete the guide</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/howto.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/grails-guides/grails-upload-file/archive/master.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the <a href="https://git-scm.com/">Git</a> repository:<br>
<code>git clone <a href="https://github.com/grails-guides/grails-upload-file.git" class="bare">https://github.com/grails-guides/grails-upload-file.git</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Grails guides repositories contain two folders:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initial</code>  Initial project. Often a simple Grails app with additional some code to give you a head-start.</p>
</li>
<li>
<p><code>complete</code> A completed example. It is the result of working through the steps presented by the guide and applying those changes to the <code>initial</code> folder.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To complete the guide, go to the <code>initial</code> folder</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cd</code> into <code>grails-guides/grails-upload-file/initial</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and follow the instructions in the next sections.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can go right to the <strong>completed example</strong> if you <code>cd</code> into <code>grails-guides/grails-upload-file/complete</code>
</td>
</tr>
</table>
</div>


<h1 id="writingTheApp">2 Writing the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to create an app to list tourism resources; hotels, restaurants, and points of interest.</p>
</div>
<div class="paragraph">
<p>In the next sections, you are going to see in more detail those domain classes.</p>
</div>


<h2 id="featuredImageCommand">2.1 Featured Image Command Object</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/featuredImageCommand.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Each of our application entities ( hotels, restaurants and point of interest )  will have a featured image.</p>
</div>
<div class="paragraph">
<p>To encapsulate the validation of the file being upload; we use a <a href="http://guides.grails.org/command-objects-and-forms/guide/index.html">Grails Command Object</a></p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/demo/FeaturedImageCommand.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.validation.Validateable</span>
<span class="keyword">import</span> <span class="include">org.springframework.web.multipart.MultipartFile</span>

<span class="type">class</span> <span class="class">FeaturedImageCommand</span> <span class="directive">implements</span> Validateable {
    MultipartFile featuredImageFile
    <span class="predefined-type">Long</span> id
    <span class="predefined-type">Integer</span> version

    <span class="directive">static</span> constraints = {
        id <span class="key">nullable</span>: <span class="predefined-constant">false</span>
        version <span class="key">nullable</span>: <span class="predefined-constant">false</span>
        featuredImageFile  <span class="key">validator</span>: { val, obj -&gt;
            <span class="keyword">if</span> ( val == <span class="predefined-constant">null</span> ) {
                <span class="keyword">return</span> <span class="predefined-constant">false</span>
            }
            <span class="keyword">if</span> ( val.empty ) {
                <span class="keyword">return</span> <span class="predefined-constant">false</span>
            }

            [<span class="string"><span class="delimiter">'</span><span class="content">jpeg</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">jpg</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">png</span><span class="delimiter">'</span></span>].any { extension -&gt; <i class="conum" data-value="1"></i><b>(1)</b>
                 val.originalFilename?.toLowerCase()?.endsWith(extension)
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Only files ending with JPG or PNG are allowed</td>
</tr>
</table>
</div>


<h2 id="increaseFileSize">2.2 Increase allowed file size</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/increaseFileSize.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 3&#8217;s default file size is 128000 (~128KB).</p>
</div>
<div class="paragraph">
<p>We are going to allow 25MB files uploads.</p>
</div>
<div class="paragraph">
<p>25 * 1024 * 1024 = 26.214.400 bytes</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">grails</span>:
 <span class="key">controllers</span>:
  <span class="key">upload</span>:
    <span class="key">maxFileSize</span>: <span class="integer">26214400</span>
    <span class="key">maxRequestSize</span>: <span class="integer">26214400</span></code></pre>
</div>
</div>


<h1 id="restaurant">3 Restaurant - Upload and save as byte[]</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/restaurant.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This part of the Guide illustrates how to upload a file to a Grails server
app and store the file&#8217;s bytes in the database.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/bytearray.png" alt="bytearray">
</div>
</div>


<h2 id="restaurantDomainClass">3.1 Restaurant Domain Class</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/restaurantDomainClass.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create a domain class for <code>Restaurant</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./grailsw create-domain-class Restaurant
| Created grails-app/domain/demo/Restaurant.groovy
| Created src/test/groovy/demo/RestaurantSpec.groovy</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/grails-app/domain/demo/Restaurant.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="type">class</span> <span class="class">Restaurant</span> {
    <span class="predefined-type">String</span> name
    <span class="type">byte</span><span class="type">[]</span> featuredImageBytes <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="predefined-type">String</span> featuredImageContentType <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">static</span> constraints = {
        featuredImageBytes <span class="key">nullable</span>: <span class="predefined-constant">true</span>
        featuredImageContentType <span class="key">nullable</span>: <span class="predefined-constant">true</span>
    }

    <span class="directive">static</span> mapping = {
        featuredImageBytes <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">featured_image_bytes</span><span class="delimiter">'</span></span>, <span class="key">sqlType</span>: <span class="string"><span class="delimiter">'</span><span class="content">longblob</span><span class="delimiter">'</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use a domain class property to store the bytes of the image in the database</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Content-Type of the image. E.g. 'image/jpeg'</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Images may be big files; we use the mapping closure to configure the sqlType</td>
</tr>
</table>
</div>


<h2 id="restaurantScaffolding">3.2 Restaurant Static Scaffolding</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/restaurantScaffolding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We have used static scaffolding to generate the CRUD ( Create, Read, Update, Delete) functionality.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./grailsw generate-all Restaurant</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, we have done a code refactoring of the generated controller <code>RestaurantController</code> and we have extracted
the transactional GORM behavior to a service <code>RestaurantGormService</code>.</p>
</div>
<div class="paragraph">
<p>In order to keep this guide code listings short, we don&#8217;t include those code snippets. However,
you can <a href="https://github.com/grails-guides/grails-upload-file/archive/master.zip">download</a> and unzip the source or clone this guide repository <a href="https://git-scm.com/">Git</a>: <code>git clone <a href="https://github.com/grails-guides/grails-upload-file.git" class="bare">https://github.com/grails-guides/grails-upload-file.git</a></code>
You can find the finished guide with all the project code at <code>grails-guides/grails-upload-file/complete</code></p>
</div>


<h2 id="restaurantView">3.3 Restaurant Views</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/restaurantView.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to modify the generated views slightly to include functionality which enables to upload a featured image.</p>
</div>
<div class="paragraph">
<p>In the restaurant&#8217;s listing, display only the restaurant&#8217;s name in the table. Checkout the <a href="http://grails3-plugins.github.io/fields/snapshot/ref/Tags/table.html">Fields Plugin f:table</a> documentation.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/restaurant/index.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:table collection=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>restaurantList<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> properties=<span class="string"><span class="delimiter">&quot;</span><span class="content">['name']</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit and create form will not allow users to set featured image&#8217;s content type or byte[]</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/restaurant/create.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:all bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">restaurant</span><span class="delimiter">&quot;</span></span> except=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageBytes,featuredImageContentType</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/restaurant/edit.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:all bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">restaurant</span><span class="delimiter">&quot;</span></span> except=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageBytes,featuredImageContentType</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the show restaurant page, add a button which takes the user to a featured image edit page.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/restaurant/show.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">edit</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">editFeaturedImage</span><span class="delimiter">&quot;</span></span> resource=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.restaurant<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">restaurant.featuredImageUrl.edit.label</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Edit Featured Image</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>editFeaturedImage</code> Controller&#8217;s action is identical to edit action:</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/demo/RestaurantController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
<span class="keyword">def</span> <span class="function">editFeaturedImage</span>(Restaurant restaurant) {
    respond restaurant
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>editFeaturedImage</code> GSP is identical to <code>edit</code> GSP but it uses an <code>g:uploadForm</code> instead of a <code>g:form</code></p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/restaurant/editFeaturedImage.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:uploadForm name=<span class="string"><span class="delimiter">&quot;</span><span class="content">uploadFeaturedImage</span><span class="delimiter">&quot;</span></span> action=<span class="string"><span class="delimiter">&quot;</span><span class="content">uploadFeaturedImage</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.restaurant?.id<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.restaurant?.version<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;input type=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageFile</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;fieldset <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buttons</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;<span class="class">input</span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">save</span><span class="delimiter">&quot;</span></span> <span class="class">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">restaurant.featuredImage.upload.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Upload</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">fieldset&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:uploadForm&gt;</span></span></code></pre>
</div>
</div>


<h2 id="restaurantUploadFeaturedImageService">3.4 Upload Featured Image Service</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/restaurantUploadFeaturedImageService.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <code>uploadFeatureImage</code> controller&#8217;s action uses the previously described command
object to validate the upload form submission. If it does not find validation errors, it invokes a service.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/demo/RestaurantController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.OK</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.NOT_FOUND</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.NO_CONTENT</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.CREATED</span>
<span class="keyword">import</span> <span class="include">grails.transaction.Transactional</span>

<span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">'</span><span class="content">LineLength</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">RestaurantController</span> {

    <span class="directive">static</span> allowedMethods = [
            <span class="key">save</span>: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>,
            <span class="key">update</span>: <span class="string"><span class="delimiter">'</span><span class="content">PUT</span><span class="delimiter">'</span></span>,
            <span class="key">uploadFeaturedImage</span>: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>,
            <span class="key">delete</span>: <span class="string"><span class="delimiter">'</span><span class="content">DELETE</span><span class="delimiter">'</span></span>,
    <span class="keyword">def</span> <span class="function">uploadFeaturedImage</span>(FeaturedImageCommand cmd) {
        <span class="keyword">if</span> (cmd == <span class="predefined-constant">null</span>) {
            notFound()
            <span class="keyword">return</span>
        }

        <span class="keyword">if</span> (cmd.hasErrors()) {
            respond(cmd.errors, <span class="key">model</span>: [<span class="key">restaurant</span>: cmd], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
            <span class="keyword">return</span>
        }

        <span class="keyword">def</span> restaurant = uploadRestaurantFeaturedImageService.uploadFeatureImage(cmd)

        <span class="keyword">if</span> (restaurant == <span class="predefined-constant">null</span>) {
            notFound()
            <span class="keyword">return</span>
        }

        <span class="keyword">if</span> (restaurant.hasErrors()) {
            respond(restaurant.errors, <span class="key">model</span>: [<span class="key">restaurant</span>: restaurant], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
            <span class="keyword">return</span>
        }

        request.withFormat {
            form multipartForm {
                flash.message = message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.updated.message</span><span class="delimiter">'</span></span>, <span class="key">args</span>: [message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">restaurant.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Restaurant</span><span class="delimiter">'</span></span>), restaurant.id])
                redirect restaurant
            }
            <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span> { respond restaurant, [<span class="key">status</span>: OK] }
        }
    }

                redirect <span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>, <span class="key">method</span>: <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Service extracts the content type and byte[] and saves them in the database.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/services/demo/UploadRestaurantFeaturedImageService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="type">class</span> <span class="class">UploadRestaurantFeaturedImageService</span> {

    <span class="keyword">def</span> restaurantGormService

    Restaurant uploadFeatureImage(FeaturedImageCommand cmd) {
        <span class="type">byte</span><span class="type">[]</span> bytes = cmd.featuredImageFile.bytes
        <span class="predefined-type">String</span> contentType = cmd.featuredImageFile.contentType
        restaurantGormService.updateRestaurantFeaturedImage(cmd.id, cmd.version, bytes, contentType)
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/grails-app/services/demo/RestaurantGormService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@Transactional</span>
    Restaurant updateRestaurantFeaturedImage(<span class="predefined-type">Long</span> restaurantId, <span class="predefined-type">Integer</span> version, <span class="type">byte</span><span class="type">[]</span> bytes, <span class="predefined-type">String</span> contentType) {
        Restaurant restaurant = Restaurant.get(restaurantId)
        <span class="keyword">if</span> ( !restaurant ) {
          <span class="keyword">return</span> <span class="predefined-constant">null</span>
        }
        restaurant.version = version
        restaurant.featuredImageBytes = bytes
        restaurant.featuredImageContentType = contentType
        restaurant.save()
        restaurant
    }</code></pre>
</div>
</div>


<h2 id="loadByteArrayImage">3.5 Load byte array Image</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/loadByteArrayImage.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create an action which renders the restaurant&#8217;s featured image:</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/demo/RestaurantController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
    <span class="keyword">def</span> <span class="function">featuredImage</span>(Restaurant restaurant) {
        <span class="keyword">if</span> (restaurant == <span class="predefined-constant">null</span> || restaurant.featuredImageBytes == <span class="predefined-constant">null</span>) {
            transactionStatus.setRollbackOnly()
            notFound()
            <span class="keyword">return</span>
        }
        render <span class="key">file</span>: restaurant.featuredImageBytes, <span class="key">contentType</span>: restaurant.featuredImageContentType
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>g:createLink</code> GSP tag to reference the previous controller action in the <em>img</em> <em>src</em> attribute.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/restaurant/show.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">            &lt;h1&gt;&lt;<span class="key">f</span>:display bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">restaurant</span><span class="delimiter">&quot;</span></span> property=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">h1&gt;</span></span><span class="error">
</span>            &lt;<span class="key">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.restaurant.featuredImageBytes<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
                &lt;img src=<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;g:createLink controller=</span><span class="delimiter">&quot;</span></span>restaurant<span class="string"><span class="delimiter">&quot;</span><span class="content"> action=</span><span class="delimiter">&quot;</span></span>featuredImage<span class="string"><span class="delimiter">&quot;</span><span class="content"> id=</span><span class="delimiter">&quot;</span></span><span class="error">$</span>{<span class="local-variable">this</span>.restaurant.id}<span class="string"><span class="delimiter">&quot;</span><span class="content">/&gt;</span><span class="delimiter">&quot;</span></span> width=<span class="string"><span class="delimiter">&quot;</span><span class="content">400</span><span class="delimiter">&quot;</span></span>/&gt;
            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;</span></span></code></pre>
</div>
</div>


<h1 id="pointOfInterest">4 Point of Interest - Upload and transfer</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/pointOfInterest.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this part of this guide, we have separated the Grails application from the uploaded images.
We use <a href="https://www.mamp.info">MAMP</a> to run a local apache server at port 8888 pointing to the folder data.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/transfer.png" alt="transfer">
</div>
</div>


<h2 id="pointOfInterestDomainClass">4.1 Point of Interest Domain Class</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/pointOfInterestDomainClass.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./grailsw create-domain-class PointOfInterest
| Created grails-app/domain/demo/PointOfInterest.groovy
| Created src/test/groovy/demo/PointOfInterestSpec.groovy</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/grails-app/domain/demo/PointOfInterest.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="type">class</span> <span class="class">PointOfInterest</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">String</span> featuredImageUrl

    <span class="directive">static</span> constraints = {
        featuredImageUrl <span class="key">nullable</span>: <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>


<h2 id="pointOfInterestScaffolding">4.2 Point of Interest Static Scaffolding</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/pointOfInterestScaffolding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We have used static scaffolding to generate the CRUD ( Create, Read, Update, Delete) functionality.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./grailsw generate-all PointOfInterest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, we have done a code refactoring of the generated controller <code>PointOfInterestController</code> and we have extracted
the transactional GORM behavior to a service <code>PointOfInterestGormService</code>.</p>
</div>
<div class="paragraph">
<p>In order to keep this guide code listings short, we don&#8217;t include those code snippets. However,
you can <a href="https://github.com/grails-guides/grails-upload-file/archive/master.zip">download</a> and unzip the source or clone this guide repository <a href="https://git-scm.com/">Git</a>: <code>git clone <a href="https://github.com/grails-guides/grails-upload-file.git" class="bare">https://github.com/grails-guides/grails-upload-file.git</a></code>
You can find the finished guide with all the project code at <code>grails-guides/grails-upload-file/complete</code></p>
</div>


<h2 id="pointOfInterestView">4.3 Point of Interest  Views</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/pointOfInterestView.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to modify the generated views slightly to include functionality which enables to upload a featured image.</p>
</div>
<div class="paragraph">
<p>In Point of Interest&#8217;s listing, display only the hotel&#8217;s name in the table. Checkout the <a href="http://grails3-plugins.github.io/fields/snapshot/ref/Tags/table.html">Fields Plugin f:table</a> documentation.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/pointOfInterest/index.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:table collection=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>pointOfInterestList<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> properties=<span class="string"><span class="delimiter">&quot;</span><span class="content">['name']</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit and create form will not allow users to set featured image&#8217;s url</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/pointOfInterest/create.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:all bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">pointOfInterest</span><span class="delimiter">&quot;</span></span> except=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageUrl</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/pointOfInterest/edit.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:all bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">pointOfInterest</span><span class="delimiter">&quot;</span></span> except=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageUrl</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead we add a button which takes the user to a featured image edit page.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/pointOfInterest/show.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">edit</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">editFeaturedImage</span><span class="delimiter">&quot;</span></span> resource=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.pointOfInterest<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">pointOfInterest.featuredImageUrl.edit.label</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Edit Featured Image</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>editFeaturedImage</code> Controller&#8217;s action is identical to edit action:</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/demo/PointOfInterestController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
<span class="keyword">def</span> <span class="function">editFeaturedImage</span>(PointOfInterest pointOfInterest) {
    respond pointOfInterest
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>editFeaturedImage</code> GSP is identical to <code>edit</code> GSP but it uses an <code>g:uploadForm</code> instead of a <code>g:form</code></p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/pointOfInterest/editFeaturedImage.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:uploadForm name=<span class="string"><span class="delimiter">&quot;</span><span class="content">uploadFeaturedImage</span><span class="delimiter">&quot;</span></span> action=<span class="string"><span class="delimiter">&quot;</span><span class="content">uploadFeaturedImage</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.pointOfInterest?.id<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.pointOfInterest?.version<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;input type=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageFile</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;fieldset <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buttons</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;<span class="class">input</span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">save</span><span class="delimiter">&quot;</span></span> <span class="class">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">pointOfInterest.featuredImage.upload.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Upload</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">fieldset&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:uploadForm&gt;</span></span></code></pre>
</div>
</div>


<h2 id="pointOfInterestUploadFeaturedImageService">4.4 Upload Featured Image Service</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/pointOfInterestUploadFeaturedImageService.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <code>uploadFeatureImage</code> controller&#8217;s action uses the previously described command
object to validate the upload form submission. If it does not find validation errors, it invokes a service.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/demo/PointOfInterestController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.OK</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.NOT_FOUND</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.NO_CONTENT</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.CREATED</span>
<span class="keyword">import</span> <span class="include">grails.transaction.Transactional</span>

<span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">'</span><span class="content">LineLength</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">PointOfInterestController</span> {

    <span class="directive">static</span> allowedMethods = [
            <span class="key">save</span>: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>,
            <span class="key">update</span>: <span class="string"><span class="delimiter">'</span><span class="content">PUT</span><span class="delimiter">'</span></span>,
            <span class="key">uploadFeaturedImage</span>: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>,
            <span class="key">delete</span>: <span class="string"><span class="delimiter">'</span><span class="content">DELETE</span><span class="delimiter">'</span></span>,
    <span class="keyword">def</span> <span class="function">uploadFeaturedImage</span>(FeaturedImageCommand cmd) {

        <span class="keyword">if</span> (cmd.hasErrors()) {
            respond(cmd, <span class="key">model</span>: [<span class="key">pointOfInterest</span>: cmd], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
            <span class="keyword">return</span>
        }

        <span class="keyword">def</span> pointOfInterest = uploadPointOfInterestFeaturedImageService.uploadFeatureImage(cmd)
        <span class="keyword">if</span> (pointOfInterest == <span class="predefined-constant">null</span>) {
            notFound()
            <span class="keyword">return</span>
        }

        <span class="keyword">if</span> (pointOfInterest.hasErrors()) {
            respond(pointOfInterest, <span class="key">model</span>: [<span class="key">pointOfInterest</span>: pointOfInterest], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
            <span class="keyword">return</span>
        }

        request.withFormat {
            form multipartForm {
                flash.message = message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.updated.message</span><span class="delimiter">'</span></span>, <span class="key">args</span>: [message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">pointOfInterest.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Point of Interest</span><span class="delimiter">'</span></span>), pointOfInterest.id])
                redirect pointOfInterest
            }
            <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span> { respond pointOfInterest, [<span class="key">status</span>: OK] }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We configure the local server url which will host the uploaded images and the local
folder path where we are going to save the images to.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">grails</span>:
    <span class="key">guides</span>:
        <span class="key">cdnFolder</span>: <span class="regexp"><span class="delimiter">/</span><span class="content">Users</span><span class="delimiter">/</span></span>sdelamo/Sites/GrailsGuides/UploadFiles
        <span class="key">cdnRootUrl</span>: <span class="key">http</span>:<span class="comment">//localhost:8888</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Service uses the <code>transferTo</code> method to transfer the file to a local file path.
In case of error, the service deletes the file it has previously transfered</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/services/demo/UploadPointOfInterestFeaturedImageService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.config.Config</span>
<span class="keyword">import</span> <span class="include">grails.core.support.GrailsConfigurationAware</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">'</span><span class="content">GrailsStatelessService</span><span class="delimiter">'</span></span>)
<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">UploadPointOfInterestFeaturedImageService</span> <span class="directive">implements</span> GrailsConfigurationAware {

    PointOfInterestGormService pointOfInterestGormService

    <span class="predefined-type">String</span> cdnFolder
    <span class="predefined-type">String</span> cdnRootUrl

    <span class="annotation">@Override</span>
    <span class="type">void</span> setConfiguration(Config co) {
        cdnFolder = co.getRequiredProperty(<span class="string"><span class="delimiter">'</span><span class="content">grails.guides.cdnFolder</span><span class="delimiter">'</span></span>)
        cdnRootUrl = co.getRequiredProperty(<span class="string"><span class="delimiter">'</span><span class="content">grails.guides.cdnRootUrl</span><span class="delimiter">'</span></span>)
    }

    <span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">'</span><span class="content">JavaIoPackageAccess</span><span class="delimiter">'</span></span>)
    PointOfInterest uploadFeatureImage(FeaturedImageCommand cmd) {

        <span class="predefined-type">String</span> filename = cmd.featuredImageFile.originalFilename
        <span class="keyword">def</span> folderPath = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>cdnFolder<span class="inline-delimiter">}</span></span><span class="content">/pointOfInterest/</span><span class="inline"><span class="inline-delimiter">${</span>cmd.id<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> <span class="keyword">as</span> <span class="predefined-type">String</span>
        <span class="keyword">def</span> folder = <span class="keyword">new</span> <span class="predefined-type">File</span>(folderPath)
        <span class="keyword">if</span> ( !folder.exists() ) {
            folder.mkdirs()
        }
        <span class="keyword">def</span> path = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>folderPath<span class="inline-delimiter">}</span></span><span class="content">/</span><span class="inline"><span class="inline-delimiter">${</span>filename<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> <span class="keyword">as</span> <span class="predefined-type">String</span>
        cmd.featuredImageFile.transferTo(<span class="keyword">new</span> <span class="predefined-type">File</span>(path))

        <span class="predefined-type">String</span> featuredImageUrl = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>cdnRootUrl<span class="inline-delimiter">}</span></span><span class="content">//pointOfInterest/</span><span class="inline"><span class="inline-delimiter">${</span>cmd.id<span class="inline-delimiter">}</span></span><span class="content">/</span><span class="inline"><span class="inline-delimiter">${</span>filename<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>

        <span class="keyword">def</span> poi = pointOfInterestGormService.updateFeaturedImageUrl(cmd.id, cmd.version, featuredImageUrl)

        <span class="keyword">if</span> ( !poi || poi.hasErrors() ) {
            <span class="keyword">def</span> f = <span class="keyword">new</span> <span class="predefined-type">File</span>(path)
            f.delete()
        }
        poi
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/grails-app/services/demo/PointOfInterestGormService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@Transactional</span>
    PointOfInterest updateFeaturedImageUrl(<span class="predefined-type">Long</span> pointOfInterestId, <span class="predefined-type">Integer</span> version, <span class="predefined-type">String</span> featuredImageUrl) {
        PointOfInterest poi = PointOfInterest.get(pointOfInterestId)
        <span class="keyword">if</span> ( !poi ) {
            <span class="keyword">return</span> <span class="predefined-constant">null</span>
        }
        poi.version = version
        poi.featuredImageUrl = featuredImageUrl
        poi.save()
    }</code></pre>
</div>
</div>


<h1 id="awsS3">5 Hotel - Upload to AWS S3</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/awsS3.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For <code>Hotel</code> domain class we are going to upload the file to <a href="https://aws.amazon.com/s3/">Amazon AWS S3</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/s3.png" alt="s3">
</div>
</div>
<div class="paragraph">
<p>First, Install <a href="https://github.com/agorapulse/grails-aws-sdk/tree/master/grails-aws-sdk-s3">Grails AWS SDK S3 Plugin</a></p>
</div>
<div class="paragraph">
<p>Modify you <code>build.grade</code> file</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">maven { url <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.grails.org/grails/core</span><span class="delimiter">&quot;</span></span> }
maven { url <span class="string"><span class="delimiter">'</span><span class="content">http://dl.bintray.com/agorapulse/libs</span><span class="delimiter">'</span></span> }
compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.boot:spring-boot-starter-tomcat</span><span class="delimiter">&quot;</span></span>
compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails:grails-dependencies</span><span class="delimiter">&quot;</span></span>
runtime <span class="string"><span class="delimiter">&quot;</span><span class="content">com.bertramlabs.plugins:asset-pipeline-grails:2.14.2</span><span class="delimiter">&quot;</span></span>
testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails:grails-gorm-testing-support</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We are going to upload our files to an already existing bucket.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">grails</span>:
    <span class="key">plugins</span>:
        <span class="key">awssdk</span>:
            <span class="key">s3</span>:
                <span class="key">region</span>: eu-west-<span class="integer">1</span>
                <span class="key">bucket</span>: grails-guides</code></pre>
</div>
</div>


<h2 id="hotelDomainClass">5.1 Hotel Domain Class</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/hotelDomainClass.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./grailsw create-domain-class Hotel
| Created grails-app/domain/demo/Hotel.groovy
| Created src/test/groovy/demo/HotelSpec.groovy</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/grails-app/domain/demo/Hotel.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="type">class</span> <span class="class">Hotel</span> {

    <span class="predefined-type">String</span> name
    <span class="predefined-type">String</span> featuredImageUrl <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">static</span> constraints = {
        featuredImageUrl <span class="key">nullable</span>: <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We store the AWS S3 url of the featured image</td>
</tr>
</table>
</div>


<h2 id="hotelScaffolding">5.2 Hotel Static Scaffolding</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/hotelScaffolding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We have used static scaffolding to generate the CRUD ( Create, Read, Update, Delete) functionality.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./grailsw generate-all Hotel</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, we have done a code refactoring of the generated controller <code>HotelController</code> and we have extracted
the transactional GORM behavior to a service <code>HotelGormService</code>.</p>
</div>
<div class="paragraph">
<p>In order to keep this guide code listings short, we don&#8217;t include those code snippets. However,
you can <a href="https://github.com/grails-guides/grails-upload-file/archive/master.zip">download</a> and unzip the source or clone this guide repository <a href="https://git-scm.com/">Git</a>: <code>git clone <a href="https://github.com/grails-guides/grails-upload-file.git" class="bare">https://github.com/grails-guides/grails-upload-file.git</a></code>
You can find the finished guide with all the project code at <code>grails-guides/grails-upload-file/complete</code></p>
</div>


<h2 id="hotelView">5.3 Hotel Views</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/hotelView.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to modify the generated views slightly to include functionality which enables to upload a featured image.</p>
</div>
<div class="paragraph">
<p>In Hotel&#8217;s listing, display only the hotel&#8217;s name in the table. Checkout the <a href="http://grails3-plugins.github.io/fields/snapshot/ref/Tags/table.html">Fields Plugin f:table</a> documentation.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/hotel/index.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:table collection=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>hotelList<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> properties=<span class="string"><span class="delimiter">&quot;</span><span class="content">['name']</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit and create form will not allow users to set featured image&#8217;s url</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/hotel/create.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:all bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotel</span><span class="delimiter">&quot;</span></span> except=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageUrl</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/hotel/edit.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">f</span>:all bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">hotel</span><span class="delimiter">&quot;</span></span> except=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageUrl</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead we add a button which takes the user to a featured image edit page.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/hotel/show.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:link <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">edit</span><span class="delimiter">&quot;</span></span> <span class="class">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">edit</span><span class="delimiter">&quot;</span></span> resource=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.hotel<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.button.edit.label</span><span class="delimiter">&quot;</span></span> <span class="keyword">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Edit</span><span class="delimiter">&quot;</span></span> /&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>editFeaturedImage</code> Controller&#8217;s action is identical to edit action:</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/demo/HotelController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
<span class="keyword">def</span> <span class="function">editFeaturedImage</span>(Hotel hotel) {
    respond hotel
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>editFeaturedImage</code> GSP is identical to <code>edit</code> GSP but it uses an <code>g:uploadForm</code> instead of a <code>g:form</code></p>
</div>
<div class="listingblock">
<div class="title">/grails-app/views/hotel/editFeaturedImage.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:uploadForm name=<span class="string"><span class="delimiter">&quot;</span><span class="content">uploadFeaturedImage</span><span class="delimiter">&quot;</span></span> action=<span class="string"><span class="delimiter">&quot;</span><span class="content">uploadFeaturedImage</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.hotel?.id<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;<span class="key">g</span>:hiddenField name=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">this</span>.hotel?.version<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;input type=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">featuredImageFile</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;fieldset <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">buttons</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;<span class="class">input</span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">save</span><span class="delimiter">&quot;</span></span> <span class="class">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">hotel.featuredImage.upload.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Upload</span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">fieldset&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:uploadForm&gt;</span></span></code></pre>
</div>
</div>


<h2 id="hotelUploadFeaturedImageService">5.4 Upload image to S3</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/hotelUploadFeaturedImageService.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <code>uploadFeatureImage</code> controller&#8217;s action uses the previously described command
object to validate the upload form submission. If it does not find validation errors, it invokes a service.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/controllers/demo/HotelController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.OK</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.NOT_FOUND</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.NO_CONTENT</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.CREATED</span>
<span class="keyword">import</span> <span class="include">grails.transaction.Transactional</span>

<span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">'</span><span class="content">LineLength</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">HotelController</span> {

    <span class="directive">static</span> allowedMethods = [
            <span class="key">save</span>: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>,
            <span class="key">update</span>: <span class="string"><span class="delimiter">'</span><span class="content">PUT</span><span class="delimiter">'</span></span>,
            <span class="key">uploadFeaturedImage</span>: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>,
            <span class="key">delete</span>: <span class="string"><span class="delimiter">'</span><span class="content">DELETE</span><span class="delimiter">'</span></span>,
    <span class="keyword">def</span> <span class="function">uploadFeaturedImage</span>(FeaturedImageCommand cmd) {

        <span class="keyword">if</span> (cmd.hasErrors()) {
            respond(cmd.errors, <span class="key">model</span>: [<span class="key">hotel</span>: cmd], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
            <span class="keyword">return</span>
        }

        <span class="keyword">def</span> hotel = uploadHotelFeaturedImageService.uploadFeatureImage(cmd)
        <span class="keyword">if</span> (hotel == <span class="predefined-constant">null</span>) {
            notFound()
            <span class="keyword">return</span>
        }

        <span class="keyword">if</span> (hotel.hasErrors()) {
            respond(hotel.errors, <span class="key">model</span>: [<span class="key">hotel</span>: hotel], <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">editFeaturedImage</span><span class="delimiter">'</span></span>)
            <span class="keyword">return</span>
        }

        request.withFormat {
            form multipartForm {
                flash.message = message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.updated.message</span><span class="delimiter">'</span></span>, <span class="key">args</span>: [message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">hotel.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Hotel</span><span class="delimiter">'</span></span>), hotel.id])
                redirect hotel
            }
            <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span> { respond hotel, [<span class="key">status</span>: OK] }
        }
    }
                redirect <span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>, <span class="key">method</span>: <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Service uses the <code>amazonS3Service</code> provided by the plugin to upload the
file to AWS S3. In case of error, the service deletes the file it has previously uploaded.</p>
</div>
<div class="listingblock">
<div class="title">/grails-app/services/demo/UploadHotelFeaturedImageService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.transaction.Transactional</span>

<span class="annotation">@Transactional</span>
<span class="type">class</span> <span class="class">UploadHotelFeaturedImageService</span> {

    <span class="keyword">def</span> amazonS3Service

    <span class="keyword">def</span> hotelGormService

    Hotel uploadFeatureImage(FeaturedImageCommand cmd) {

        <span class="keyword">def</span> path = <span class="string"><span class="delimiter">&quot;</span><span class="content">hotel/</span><span class="inline"><span class="inline-delimiter">${</span>cmd.id<span class="inline-delimiter">}</span></span><span class="content">/</span><span class="delimiter">&quot;</span></span> + cmd.featuredImageFile.originalFilename
        <span class="predefined-type">String</span> s3FileUrl = amazonS3Service.storeMultipartFile(path, cmd.featuredImageFile)

        <span class="keyword">def</span> hotel = hotelGormService.updateFeaturedImageUrl(cmd.id, cmd.version, s3FileUrl)
        <span class="keyword">if</span> ( !hotel || hotel.hasErrors() ) {
            amazonS3Service.deleteFile(path)
        }
        hotel
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/grails-app/services/demo/HotelGormService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="annotation">@Transactional</span>
    Hotel updateFeaturedImageUrl(<span class="predefined-type">Long</span> id, <span class="predefined-type">Integer</span> version, <span class="predefined-type">String</span> featuredImageUrl) {
        Hotel hotel = Hotel.get(id)
        <span class="keyword">if</span> ( !hotel ) {
            <span class="keyword">return</span> <span class="predefined-constant">null</span>
        }
        hotel.version = version
        hotel.featuredImageUrl = featuredImageUrl
        hotel.save()
    }</code></pre>
</div>
</div>


<h2 id="awsAccessAndSecret">5.5 Run the App with AWS Access and Secret</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/awsAccessAndSecret.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Modify <code>build.gradle</code>, we want System properties to be passed to <code>bootRun</code> Gradle task.</p>
</div>
<div class="listingblock">
<div class="title">/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    compile <span class="string"><span class="delimiter">'</span><span class="content">org.grails.plugins:aws-sdk-s3:2.1.5</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://github.com/agorapulse/grails-aws-sdk/tree/master/grails-aws-sdk-s3">AWS S3 Grails Plugin Documentation</a></p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>If you do not provide credentials, a credentials provider chain will be used that searches for credentials in this order:</p>
</div>
<div class="paragraph">
<p>Environment Variables - AWS_ACCESS_KEY_ID and AWS_SECRET_KEY
Java System Properties - aws.accessKeyId andaws.secretKey`
Instance profile credentials delivered through the Amazon EC2 metadata service (IAM role)</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Thus, we can run the app with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew bootRun -Daws.accessKeyId=XXXXX -Daws.secretKey=XXXXX</code></pre>
</div>
</div>


<h1 id="runningTheApp">6 Running the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/runningTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To run the application use the <code>./gradlew bootRun</code> command which will start the application on port 8080.</p>
</div>


<h1 id="helpWithGrails">7 Do you need help with Grails?</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-upload-file/edit/master/src/main/docs/guide/helpWithGrails.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<h3 style="color: #333;">OCI sponsored the creation of this Guide. OCI offers several <a href="https://objectcomputing.com/products/grails/consulting-support/">Grails services</a>:</h3>

<img src="../img/oci-grails-services.svg"/>

<h3>Free consultation </h3>

<!-- This is the code that is needed to run the form -->

<!--Copy and paste into the document's head or body.-->

<script type="text/javascript">

    /** This section is only needed once per page if manually copying **/
    if (typeof MauticSDKLoaded == 'undefined') {
        var MauticSDKLoaded = true;
        var head            = document.getElementsByTagName('head')[0];
        var script          = document.createElement('script');
        script.type         = 'text/javascript';
        script.src          = 'https://mautic.objectcomputing.com/media/js/mautic-form.js';
        script.onload       = function() {
            MauticSDK.onLoad();
        };
        head.appendChild(script);
        var MauticDomain = 'https://mautic.objectcomputing.com';
        var MauticLang   = {
            'submittingMessage': "Please wait..."
        }
    }
</script>

<!--Copy and paste into the document's body.-->

<style type="text/css" scoped>
    .mauticform_wrapper { max-width: 600px; margin: 10px auto; }
    .mauticform-innerform {}
    .mauticform-post-success {}
    .mauticform-name { font-weight: bold; font-size: 1.5em; margin-bottom: 3px; }
    .mauticform-description { margin-top: 2px; margin-bottom: 10px; }
    .mauticform-error { margin-bottom: 10px; color: red; }
    .mauticform-message { margin-bottom: 10px;color: green; }
    .mauticform-row { display: block; margin-bottom: 20px; }
    .mauticform-label { font-size: 1.1em; display: block; font-weight: bold; margin-bottom: 5px; }
    .mauticform-row.mauticform-required .mauticform-label:after { color: #e32; content: " *"; display: inline; }
    .mauticform-helpmessage { display: block; font-size: 0.9em; margin-bottom: 3px; }
    .mauticform-errormsg { display: block; color: red; margin-top: 2px; }
    .mauticform-selectbox, .mauticform-input, .mauticform-textarea { width: 100%; padding: 0.5em 0.5em; border: 1px solid #CCC; background: #fff; box-shadow: 0px 0px 0px #fff inset; border-radius: 4px; box-sizing: border-box; }
    .mauticform-checkboxgrp-row {}
    .mauticform-checkboxgrp-label { font-weight: normal; }
    .mauticform-checkboxgrp-checkbox {}
    .mauticform-radiogrp-row {}
    .mauticform-radiogrp-label { font-weight: normal; }
    .mauticform-radiogrp-radio {}
    .mauticform-button-wrapper .mauticform-button.btn-default, .mauticform-pagebreak-wrapper .mauticform-pagebreak.btn-default { font-size: 14px; color: #fff;background-color: #feb672 ;border-color: #dddddd; padding: 15px 30px;}
    .mauticform-button-wrapper .mauticform-button, .mauticform-pagebreak-wrapper .mauticform-pagebreak { display: inline-block;margin-bottom: 0;font-weight: 600;text-align: center;vertical-align: middle;cursor: pointer;background-image: none;border: 1px solid transparent;white-space: nowrap;padding: 6px 12px;font-size: 13px;line-height: 1.3856;border-radius: none;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}
    .mauticform-button-wrapper .mauticform-button.btn-default[disabled], .mauticform-pagebreak-wrapper .mauticform-pagebreak.btn-default[disabled] { background-color:#feb672; border-color: #dddddd; opacity: 0.75; cursor: not-allowed; font-size: 14px; color: #fff; padding: 15px 30px;}
    .mauticform-pagebreak-wrapper .mauticform-button-wrapper {  display: inline; }
</style>
<div id="mauticform_wrapper_grailsorgconsultationform" class="mauticform_wrapper">
    <form autocomplete="false" role="form" method="post" action="https://mautic.objectcomputing.com/form/submit?formId=3" id="mauticform_grailsorgconsultationform" data-mautic-form="grailsorgconsultationform">

        <div class="mauticform-innerform">

          <div class="mauticform-page-wrapper mauticform-page-1" data-mautic-form-page="1">

            <div id="mauticform_grailsorgconsultationform_first_name"  data-validate="first_name" data-validation-type="text" class="mauticform-row mauticform-text mauticform-field-1 mauticform-required col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_first_name" name="mauticform[first_name]" value="" placeholder="First Name *" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_last_name"  data-validate="last_name" data-validation-type="text" class="mauticform-row mauticform-text mauticform-field-2 mauticform-required col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_last_name" name="mauticform[last_name]" value="" placeholder="Last Name *" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_email"  data-validate="email" data-validation-type="email" class="mauticform-row mauticform-email mauticform-field-3 mauticform-required col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_email" name="mauticform[email]" value="" placeholder="Email *" class="mauticform-input" type="email" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_phone"  class="mauticform-row mauticform-tel mauticform-field-4 col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_phone" name="mauticform[phone]" value="" placeholder="Phone" class="mauticform-input" type="tel" />
                <span class="mauticform-errormsg" style="display: none;"></span>
            </div>

            <div id="mauticform_grailsorgconsultationform_company"  class="mauticform-row mauticform-text mauticform-field-5 col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_company" name="mauticform[company]" value="" placeholder="Company" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;"></span>
            </div>

            <div id="mauticform_grailsorgconsultationform_submit"  class="mauticform-row mauticform-button-wrapper mauticform-field-6" style="">
                <button type="submit" name="mauticform[submit]" id="mauticform_input_grailsorgconsultationform_submit" name="mauticform[submit]" value="" class="mauticform-button btn btn-default" value="1" style="border: none; margin-left: 14px;">SUBMIT</button>
            </div>
            </div>
        </div>

        <input type="hidden" name="mauticform[formId]" id="mauticform_grailsorgconsultationform_id" value="3"/>
        <input type="hidden" name="mauticform[return]" id="mauticform_grailsorgconsultationform_return" value=""/>
        <input type="hidden" name="mauticform[formName]" id="mauticform_grailsorgconsultationform_name" value="grailsorgconsultationform"/>
</form>
</div>

<!--The code below is the message that appears when someone hits submit. Feel free to style this how you see fit for Grails.org. All CSS is handled in the above code.-->

<div class="mauticform-error" id="mauticform_grailsorgconsultationform_error"></div>
<div class="mauticform-message" id="mauticform_grailsorgconsultationform_message"></div>

<h3 style="color: #333;">The <a href="https://objectcomputing.com/products/grails/consulting-support/">OCI Grails Team</a>
includes Grails co-founders, <b>Jeff Scott Brown and Graeme Rocher</b>.
Check our <a href="https://objectcomputing.com/training/catalog/grails/">Grails courses</a> and learn from the engineers who developed,
matured and maintain Grails.</h3>

<img src="../img/ocigrailsteam.png" style="max-width: 748px; width: 100%;" alt="Grails OCI Team">

                                        </div>
                                    </td>
                                    <td id="col2">
                                        <div class="local clearfix">
                                            <div class="local-title" style="text-align: right"><a href="https://travis-ci.org/grails-guides/grails-upload-file"><img src="https://travis-ci.org/grails-guides/grails-upload-file.svg?branch=master" /></a></div>            

                                            <div class="local-title">
                                                <a href="https://github.com/grails-guides/grails-upload-file">
                                                    <svg height="35" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="35" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></a> &nbsp;&nbsp;Get the Code
                                                </div>
                                                <div class="menu">
                                                    <div class="input-group">                        
                                                        <button href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/grails-upload-file.git'" class="codeButton">SSH</button>
                                                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-upload-file.git'" class="codeButton">HTTPS</button>
                                                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-upload-file'" class="codeButton">Subversion</button>
                                                    </div>

                                                    <div class="input-group">                    
                                                        <!-- Target -->
                                                        <input id="github-url" value="git@github.com:grails-guides/grails-upload-file.git" type="text" />

                                                        <!-- Trigger -->
                                                        <button class="clipbtn" type="button" data-clipboard-target="#github-url">

                                                            <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
                                                        </button>       

                                                    </div>
                                                    <div class="input-group">
                                                      <a href="https://github.com/grails-guides/grails-upload-file/archive/master.zip" class="downloadButton">Download ZIP</a>
                                                  </div>
                                              </div>
                                              
                                              <div id="table-of-content">
                                                <h2>Table of Contents</h2>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>1</strong><span>Getting Started</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>1.1</strong><span>What you will need</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#howto"><strong>1.2</strong><span>How to complete the guide</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#writingTheApp"><strong>2</strong><span>Writing the Application</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#featuredImageCommand"><strong>2.1</strong><span>Featured Image Command Object</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#increaseFileSize"><strong>2.2</strong><span>Increase allowed file size</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#restaurant"><strong>3</strong><span>Restaurant - Upload and save as byte[]</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#restaurantDomainClass"><strong>3.1</strong><span>Restaurant Domain Class</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#restaurantScaffolding"><strong>3.2</strong><span>Restaurant Static Scaffolding</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#restaurantView"><strong>3.3</strong><span>Restaurant Views</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#restaurantUploadFeaturedImageService"><strong>3.4</strong><span>Upload Featured Image Service</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#loadByteArrayImage"><strong>3.5</strong><span>Load byte array Image</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#pointOfInterest"><strong>4</strong><span>Point of Interest - Upload and transfer</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#pointOfInterestDomainClass"><strong>4.1</strong><span>Point of Interest Domain Class</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#pointOfInterestScaffolding"><strong>4.2</strong><span>Point of Interest Static Scaffolding</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#pointOfInterestView"><strong>4.3</strong><span>Point of Interest  Views</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#pointOfInterestUploadFeaturedImageService"><strong>4.4</strong><span>Upload Featured Image Service</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#awsS3"><strong>5</strong><span>Hotel - Upload to AWS S3</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#hotelDomainClass"><strong>5.1</strong><span>Hotel Domain Class</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#hotelScaffolding"><strong>5.2</strong><span>Hotel Static Scaffolding</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#hotelView"><strong>5.3</strong><span>Hotel Views</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#hotelUploadFeaturedImageService"><strong>5.4</strong><span>Upload image to S3</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:10px"><a href="#awsAccessAndSecret"><strong>5.5</strong><span>Run the App with AWS Access and Secret</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#runningTheApp"><strong>6</strong><span>Running the Application</span></a></div>
                                                
                                                <div class="toc-item" style="margin-left:0px"><a href="#helpWithGrails"><strong>7</strong><span>Do you need help with Grails?</span></a></div>
                                                
                            <div style="clear:both" ></div>
                        </div>
                                            
                    </div>
                </td>
            </tr>
        </table>

        <div id="footer">
            Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing.
            
        </div>

            <!-- END CONTENT -->
          </div>
        </div>
      </div>
    </div>

<script type="text/javascript">
    new Clipboard('.clipbtn');
</script>
<script type="text/javascript" src="../js/docs.js"></script>
<script type="text/javascript" src="../js/classie.js"></script>        
<script type="text/javascript" src="../js/sidebarEffects.js"></script>
<script type="text/javascript" src="../js/navbar.js"></script> 
<style type="text/css">
    #colset {
        background-color: #f5f5f5;
    }
    .grailsnavbar {
        padding-right: 0;
    }
    #fork-me {
        display: none;
    }
</style>       
    </body>
</html>
